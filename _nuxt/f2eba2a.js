(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{510:function(e,t,n){(function(t){var r;e.exports=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){if(i)return i(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){var n=t[o][1][e];return s(n||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var i=!1,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,i){var t=[],n=!0,r=!1,o=void 0;try{for(var d,l=e[Symbol.iterator]();!(n=(d=l.next()).done)&&(t.push(d.value),!i||t.length!==i);n=!0);}catch(e){r=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw o}}return t}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function o(e){return e&&e.__esModule?e:{default:e}}var d=o(e("global/window")),l=function(track,e){for(var t=track.cues,i=0;i<t.length;i++){var n=t[i];if(e>=n.adStartTime&&e<=n.adEndTime)return n}return null},c=function(e,track){var t=arguments.length<=2||void 0===arguments[2]?0:arguments[2];if(e.segments)for(var n=t,o=void 0,i=0;i<e.segments.length;i++){var c=e.segments[i];if(o||(o=l(track,n+c.duration/2)),o){if("cueIn"in c){o.endTime=n,o.adEndTime=n,n+=c.duration,o=null;continue}if(n<o.endTime){n+=c.duration;continue}o.endTime+=c.duration}else if("cueOut"in c&&((o=new d.default.VTTCue(n,n+c.duration,c.cueOut)).adStartTime=n,o.adEndTime=n+parseFloat(c.cueOut),track.addCue(o)),"cueOutCont"in c){var f=void 0,h=void 0,m=c.cueOutCont.split("/").map(parseFloat),y=r(m,2);f=y[0],h=y[1],(o=new d.default.VTTCue(n,n+c.duration,"")).adStartTime=n-f,o.adEndTime=o.adStartTime+h,track.addCue(o)}n+=c.duration}};n.default={updateAdCues:c,findAdCue:l},t.exports=n.default},{"global/window":32}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,i){return e.start(i)+"-"+e.end(i)},o=function(e,i){var t=e.toString(16);return"00".substring(0,2-t.length)+t+(i%2?" ":"")},d=function(e){return e>=32&&e<126?String.fromCharCode(e):"."},l={hexDump:function(data){for(var e=Array.prototype.slice.call(data),t=16,n="",r=0;r<e.length/t;r++)n+=e.slice(r*t,r*t+t).map(o).join("")+" "+e.slice(r*t,r*t+t).map(d).join("")+"\n";return n},tagDump:function(e){return l.hexDump(e.bytes)},textRanges:function(e){var t="",i=void 0;for(i=0;i<e.length;i++)t+=r(e,i)+" ";return t},createTransferableMessage:function(e){var t={};return Object.keys(e).forEach((function(n){var r=e[n];ArrayBuffer.isView(r)?t[n]={bytes:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}:t[n]=r})),t},initSegmentId:function(e){var t=e.byterange||{length:1/0,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")}};n.default=l,t.exports=n.default},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,GOAL_BUFFER_LENGTH_RATE:1,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,BUFFER_LOW_WATER_LINE_RATE:1},t.exports=n.default},{}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var o=r(e("global/window")),d=e("aes-decrypter"),l=e("./bin-utils"),c=function(e){e.onmessage=function(e){var data=e.data,t=new Uint8Array(data.encrypted.bytes,data.encrypted.byteOffset,data.encrypted.byteLength),n=new Uint32Array(data.key.bytes,data.key.byteOffset,data.key.byteLength/4),r=new Uint32Array(data.iv.bytes,data.iv.byteOffset,data.iv.byteLength/4);new d.Decrypter(t,n,r,(function(e,t){o.default.postMessage((0,l.createTransferableMessage)({source:data.source,decrypted:t}),[t.buffer])}))}};n.default=function(e){return new c(e)},t.exports=n.default},{"./bin-utils":2,"aes-decrypter":25,"global/window":32}],5:[function(e,n,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t,n){for(var r=!0;r;){var object=e,o=t,d=n;r=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,o);if(void 0!==desc){if("value"in desc)return desc.value;var l=desc.get;if(void 0===l)return;return l.call(d)}var c=Object.getPrototypeOf(object);if(null===c)return;e=c,t=o,n=d,r=!0,desc=c=void 0}};function d(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=d(e("./playlist-loader")),h=e("./playlist.js"),m=d(e("./segment-loader")),y=d(e("./vtt-segment-loader")),v=d(e("./ranges")),_=d("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),T=d(e("./ad-cue-tags")),S=d(e("./sync-controller")),w=e("videojs-contrib-media-sources/es5/codec-utils"),k=d(e("webwackify")),O=d(e("./decrypter-worker")),E=d(e("./config")),A=e("./util/codecs.js"),L=e("./media-groups"),P=120,I=void 0,C={videoCodec:"avc1",videoObjectTypeIndicator:".4d400d",audioProfile:"2"},U=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred"],M=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]},D=function(){var t=void 0;try{t=e.resolve("./decrypter-worker")}catch(e){}return t},x=function(e){return e.replace(/avc1\.(\d+)\.(\d+)/i,(function(e){return(0,w.translateLegacyCodecs)([e])[0]}))};r.mapLegacyAvcCodecs_=x;var R=function(e,t,n){return e+"/"+t+'; codecs="'+n.filter((function(e){return!!e})).join(", ")+'"'},B=function(e){return e.segments&&e.segments.length&&e.segments[0].map?"mp4":"mp2t"},j=function(e){var t=e.attributes||{};return t.CODECS?(0,A.parseCodecs)(t.CODECS):C},N=function(e,t){var n=B(t),r=j(t),o=t.attributes||{},d=!0,l=!1;if(!t)return[];if(e.mediaGroups.AUDIO&&o.AUDIO){var c=e.mediaGroups.AUDIO[o.AUDIO];if(c)for(var f in l=!0,d=!1,c)if(!c[f].uri){d=!0;break}}l&&!r.audioProfile&&(_.default.log.warn("Multiple audio tracks present but no audio codec string is specified. Attempting to use the default audio codec (mp4a.40.2)"),r.audioProfile=C.audioProfile);var h={};r.videoCodec&&(h.video=""+r.videoCodec+r.videoObjectTypeIndicator),r.audioProfile&&(h.audio="mp4a.40."+r.audioProfile);var m=R("audio",n,[h.audio]),y=R("video",n,[h.video]),v=R("video",n,[h.video,h.audio]);return l?!d&&h.video?[y,m]:[v,m]:h.video?[v]:[m]};r.mimeTypesForPlaylist_=N;var F=function(e){function t(e){var n=this;l(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var r=e.url,d=e.handleManifestRedirects,c=e.withCredentials,h=e.mode,v=e.tech,T=e.bandwidth,w=e.externHls,E=e.useCueTags,A=e.blacklistDuration,P=e.enableLowInitialPlaylist;if(!r)throw new Error("A non-empty playlist URL is required");I=w,this.tech_=v,this.hls_=v.hls,this.mode_=h,this.useCueTags_=E,this.blacklistDuration=A,this.enableLowInitialPlaylist=P,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:c,handleManifestRedirects:d,timeout:null},this.mediaTypes_=(0,L.createMediaTypes)(),this.mediaSource=new _.default.MediaSource({mode:h}),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_.bind(this)),this.seekable_=_.default.createTimeRanges(),this.hasPlayed_=function(){return!1},this.syncController_=new S.default(e),this.segmentMetadataTrack_=v.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.decrypter_=(0,k.default)(O.default,D());var C={hls:this.hls_,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:function(){return n.seekable()},seeking:function(){return n.tech_.seeking()},duration:function(){return n.mediaSource.duration},hasPlayed:function(){return n.hasPlayed_()},goalBufferLength:function(){return n.goalBufferLength()},bandwidth:T,syncController:this.syncController_,decrypter:this.decrypter_};this.masterPlaylistLoader_=new f.default(r,this.hls_,this.requestOptions_),this.setupMasterPlaylistLoaderListeners_(),this.mainSegmentLoader_=new m.default(_.default.mergeOptions(C,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new m.default(_.default.mergeOptions(C,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new y.default(_.default.mergeOptions(C,{loaderType:"vtt"}),e),this.setupSegmentLoaderListeners_(),U.forEach((function(e){n[e+"_"]=M.bind(n,e)})),this.masterPlaylistLoader_.load()}return c(t,e),n(t,[{key:"setupMasterPlaylistLoaderListeners_",value:function(){var e=this;this.masterPlaylistLoader_.on("loadedmetadata",(function(){var t=e.masterPlaylistLoader_.media(),n=1.5*e.masterPlaylistLoader_.targetDuration*1e3;(0,h.isLowestEnabledRendition)(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?e.requestOptions_.timeout=0:e.requestOptions_.timeout=n,t.endList&&"none"!==e.tech_.preload()&&(e.mainSegmentLoader_.playlist(t,e.requestOptions_),e.mainSegmentLoader_.load()),(0,L.setupMediaGroups)({segmentLoaders:{AUDIO:e.audioSegmentLoader_,SUBTITLES:e.subtitleSegmentLoader_,main:e.mainSegmentLoader_},tech:e.tech_,requestOptions:e.requestOptions_,masterPlaylistLoader:e.masterPlaylistLoader_,mode:e.mode_,hls:e.hls_,master:e.master(),mediaTypes:e.mediaTypes_,blacklistCurrentPlaylist:e.blacklistCurrentPlaylist.bind(e)}),e.triggerPresenceUsage_(e.master(),t);try{e.setupSourceBuffers_()}catch(t){return _.default.log.warn("Failed to create SourceBuffers",t),e.mediaSource.endOfStream("decode")}e.setupFirstPlay(),e.trigger("selectedinitialmedia")})),this.masterPlaylistLoader_.on("loadedplaylist",(function(){var t,n,r=e.masterPlaylistLoader_.media();if(!r){var o=void 0;return e.enableLowInitialPlaylist&&(o=e.selectInitialPlaylist()),o||(o=e.selectPlaylist()),e.initialMedia_=o,void e.masterPlaylistLoader_.media(e.initialMedia_)}e.useCueTags_&&e.updateAdCues_(r),e.mainSegmentLoader_.playlist(r,e.requestOptions_),e.updateDuration(),e.tech_.paused()||e.mainSegmentLoader_.load(),r.endList||(n=function(){var t=e.seekable();0!==t.length&&e.mediaSource.addSeekableRange_(t.start(0),t.end(0))},e.duration()!==1/0?(t=function t(){e.duration()===1/0?n():e.tech_.one("durationchange",t)},e.tech_.one("durationchange",t)):n())})),this.masterPlaylistLoader_.on("error",(function(){e.blacklistCurrentPlaylist(e.masterPlaylistLoader_.error)})),this.masterPlaylistLoader_.on("mediachanging",(function(){e.mainSegmentLoader_.abort(),e.mainSegmentLoader_.pause()})),this.masterPlaylistLoader_.on("mediachange",(function(){var t=e.masterPlaylistLoader_.media(),n=1.5*e.masterPlaylistLoader_.targetDuration*1e3;(0,h.isLowestEnabledRendition)(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?e.requestOptions_.timeout=0:e.requestOptions_.timeout=n,e.mainSegmentLoader_.playlist(t,e.requestOptions_),e.mainSegmentLoader_.load(),e.tech_.trigger({type:"mediachange",bubbles:!0})})),this.masterPlaylistLoader_.on("playlistunchanged",(function(){var t=e.masterPlaylistLoader_.media();e.stuckAtPlaylistEnd_(t)&&(e.blacklistCurrentPlaylist({message:"Playlist no longer updating."}),e.tech_.trigger("playliststuck"))})),this.masterPlaylistLoader_.on("renditiondisabled",(function(){e.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})})),this.masterPlaylistLoader_.on("renditionenabled",(function(){e.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})}))}},{key:"triggerPresenceUsage_",value:function(e,t){var n=e.mediaGroups||{},r=!0,o=Object.keys(n.AUDIO);for(var d in n.AUDIO)for(var label in n.AUDIO[d])n.AUDIO[d][label].uri||(r=!1);r&&this.tech_.trigger({type:"usage",name:"hls-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"hls-webvtt"}),I.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"hls-aes"}),I.Playlist.isFmp4(t)&&this.tech_.trigger({type:"usage",name:"hls-fmp4"}),o.length&&Object.keys(n.AUDIO[o[0]]).length>1&&this.tech_.trigger({type:"usage",name:"hls-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"})}},{key:"setupSegmentLoaderListeners_",value:function(){var e=this;this.mainSegmentLoader_.on("bandwidthupdate",(function(){var t=e.selectPlaylist(),n=e.masterPlaylistLoader_.media(),r=e.tech_.buffered(),o=r.length?r.end(r.length-1)-e.tech_.currentTime():0,d=e.bufferLowWaterLine();(!n.endList||e.duration()<E.default.MAX_BUFFER_LOW_WATER_LINE||t.attributes.BANDWIDTH<n.attributes.BANDWIDTH||o>=d)&&e.masterPlaylistLoader_.media(t),e.tech_.trigger("bandwidthupdate")})),this.mainSegmentLoader_.on("progress",(function(){e.trigger("progress")})),this.mainSegmentLoader_.on("error",(function(){e.blacklistCurrentPlaylist(e.mainSegmentLoader_.error())})),this.mainSegmentLoader_.on("syncinfoupdate",(function(){e.onSyncInfoUpdate_()})),this.mainSegmentLoader_.on("timestampoffset",(function(){e.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})})),this.audioSegmentLoader_.on("syncinfoupdate",(function(){e.onSyncInfoUpdate_()})),this.mainSegmentLoader_.on("ended",(function(){e.onEndOfStream()})),this.mainSegmentLoader_.on("earlyabort",(function(){e.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},P)})),this.mainSegmentLoader_.on("reseteverything",(function(){e.tech_.trigger("hls-reset")})),this.mainSegmentLoader_.on("segmenttimemapping",(function(t){e.tech_.trigger({type:"hls-segment-time-mapping",mapping:t.mapping})})),this.audioSegmentLoader_.on("ended",(function(){e.onEndOfStream()}))}},{key:"mediaSecondsLoaded_",value:function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}},{key:"load",value:function(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}},{key:"fastQualityChange_",value:function(){var e=this.selectPlaylist();e!==this.masterPlaylistLoader_.media()&&(this.masterPlaylistLoader_.media(e),this.mainSegmentLoader_.resetLoader())}},{key:"play",value:function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_()&&this.load();var e=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0)?this.tech_.setCurrentTime(e.end(e.length-1)):void 0}}},{key:"setupFirstPlay",value:function(){var e,t=this,n=this.masterPlaylistLoader_.media();if(!n||this.tech_.paused()||this.hasPlayed_())return!1;if(!n.endList){var r=(e=t.seekable()).length?_.default.browser.IE_VERSION&&"html5"===t.mode_&&0===t.tech_.readyState()?(t.tech_.one("loadedmetadata",(function(){t.trigger("firstplay"),t.tech_.setCurrentTime(e.end(0)),t.hasPlayed_=function(){return!0}})),{v:!1}):(t.trigger("firstplay"),void t.tech_.setCurrentTime(e.end(0))):{v:!1};if("object"==typeof r)return r.v}return this.hasPlayed_=function(){return!0},this.load(),!0}},{key:"handleSourceOpen_",value:function(){try{this.setupSourceBuffers_()}catch(e){return _.default.log.warn("Failed to create Source Buffers",e),this.mediaSource.endOfStream("decode")}if(this.tech_.autoplay()){var e=this.tech_.play();void 0!==e&&"function"==typeof e.then&&e.then(null,(function(e){}))}this.trigger("sourceopen")}},{key:"onEndOfStream",value:function(){var e=this.mainSegmentLoader_.ended_;this.mediaTypes_.AUDIO.activePlaylistLoader&&(e=e&&this.audioSegmentLoader_.ended_),e&&this.mediaSource.endOfStream()}},{key:"stuckAtPlaylistEnd_",value:function(e){if(!this.seekable().length)return!1;var t=this.syncController_.getExpiredTime(e,this.mediaSource.duration);if(null===t)return!1;var n=I.Playlist.playlistEnd(e,t),r=this.tech_.currentTime(),o=this.tech_.buffered();if(!o.length)return n-r<=v.default.SAFE_TIME_DELTA;var d=o.end(o.length-1);return d-r<=v.default.SAFE_TIME_DELTA&&n-d<=v.default.SAFE_TIME_DELTA}},{key:"blacklistCurrentPlaylist",value:function(e,t){void 0===e&&(e={});var n=void 0,r=void 0;if(n=e.playlist||this.masterPlaylistLoader_.media(),t=t||e.blacklistDuration||this.blacklistDuration,!n){this.error=e;try{return this.mediaSource.endOfStream("network")}catch(e){return this.trigger("error")}}var o=1===this.masterPlaylistLoader_.master.playlists.filter(h.isEnabled).length;return o?(_.default.log.warn("Problem encountered with the current HLS playlist. Trying again since it is the final playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(o)):(n.excludeUntil=Date.now()+1e3*t,this.tech_.trigger("blacklistplaylist"),this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"}),r=this.selectPlaylist(),_.default.log.warn("Problem encountered with the current HLS playlist."+(e.message?" "+e.message:"")+" Switching to another playlist."),this.masterPlaylistLoader_.media(r))}},{key:"pauseLoading",value:function(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}},{key:"setCurrentTime",value:function(e){var t=v.default.findRange(this.tech_.buffered(),e);return this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media()&&this.masterPlaylistLoader_.media().segments?t&&t.length&&"flash"!==this.mode_?e:(this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),void this.load()):0}},{key:"duration",value:function(){return this.masterPlaylistLoader_?this.mediaSource?this.mediaSource.duration:I.Playlist.duration(this.masterPlaylistLoader_.media()):0}},{key:"seekable",value:function(){return this.seekable_}},{key:"onSyncInfoUpdate_",value:function(){var e=void 0,t=void 0;if(this.masterPlaylistLoader_){var n=this.masterPlaylistLoader_.media();if(n){var r=this.syncController_.getExpiredTime(n,this.mediaSource.duration);if(null!==r&&0!==(e=I.Playlist.seekable(n,r)).length){if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(n=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),null===(r=this.syncController_.getExpiredTime(n,this.mediaSource.duration)))return;if(0===(t=I.Playlist.seekable(n,r)).length)return}t?t.start(0)>e.end(0)||e.start(0)>t.end(0)?this.seekable_=e:this.seekable_=_.default.createTimeRanges([[t.start(0)>e.start(0)?t.start(0):e.start(0),t.end(0)<e.end(0)?t.end(0):e.end(0)]]):this.seekable_=e,this.tech_.trigger("seekablechanged")}}}}},{key:"updateDuration",value:function(){var e=this,t=this.mediaSource.duration,n=I.Playlist.duration(this.masterPlaylistLoader_.media()),r=this.tech_.buffered(),o=function t(){e.mediaSource.duration=n,e.tech_.trigger("durationchange"),e.mediaSource.removeEventListener("sourceopen",t)};r.length>0&&(n=Math.max(n,r.end(r.length-1))),t!==n&&("open"!==this.mediaSource.readyState?this.mediaSource.addEventListener("sourceopen",o):o())}},{key:"dispose",value:function(){var e=this;this.decrypter_.terminate(),this.masterPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),["AUDIO","SUBTITLES"].forEach((function(t){var n=e.mediaTypes_[t].groups;for(var r in n)n[r].forEach((function(e){e.playlistLoader&&e.playlistLoader.dispose()}))})),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose()}},{key:"master",value:function(){return this.masterPlaylistLoader_.master}},{key:"media",value:function(){return this.masterPlaylistLoader_.media()||this.initialMedia_}},{key:"setupSourceBuffers_",value:function(){var e=this.masterPlaylistLoader_.media(),t=void 0;if(e&&"open"===this.mediaSource.readyState){if((t=N(this.masterPlaylistLoader_.master,e)).length<1)return this.error="No compatible SourceBuffer configuration for the variant stream:"+e.resolvedUri,this.mediaSource.endOfStream("decode");this.mainSegmentLoader_.mimeType(t[0]),t[1]&&this.audioSegmentLoader_.mimeType(t[1]),this.excludeIncompatibleVariants_(e)}}},{key:"excludeIncompatibleVariants_",value:function(e){var t=this.masterPlaylistLoader_.master,n=2,r=null,o=void 0;e.attributes.CODECS&&(o=(0,A.parseCodecs)(e.attributes.CODECS),r=o.videoCodec,n=o.codecCount),t.playlists.forEach((function(e){var t={codecCount:2,videoCodec:null};if(e.attributes.CODECS){var o=e.attributes.CODECS;t=(0,A.parseCodecs)(o),window.MediaSource&&window.MediaSource.isTypeSupported&&!window.MediaSource.isTypeSupported('video/mp4; codecs="'+x(o)+'"')&&(e.excludeUntil=1/0)}t.codecCount!==n&&(e.excludeUntil=1/0),t.videoCodec!==r&&(e.excludeUntil=1/0)}))}},{key:"updateAdCues_",value:function(e){var t=0,n=this.seekable();n.length&&(t=n.start(0)),T.default.updateAdCues(e,this.cueTagsTrack_,t)}},{key:"goalBufferLength",value:function(){var e=this.tech_.currentTime(),t=E.default.GOAL_BUFFER_LENGTH,n=E.default.GOAL_BUFFER_LENGTH_RATE,r=Math.max(t,E.default.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*n,r)}},{key:"bufferLowWaterLine",value:function(){var e=this.tech_.currentTime(),t=E.default.BUFFER_LOW_WATER_LINE,n=E.default.BUFFER_LOW_WATER_LINE_RATE,r=Math.max(t,E.default.MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*n,r)}}]),t}(_.default.EventTarget);r.MasterPlaylistController=F}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ad-cue-tags":1,"./config":3,"./decrypter-worker":4,"./media-groups":6,"./playlist-loader":9,"./playlist.js":11,"./ranges":12,"./segment-loader":16,"./sync-controller":18,"./util/codecs.js":19,"./vtt-segment-loader":20,"videojs-contrib-media-sources/es5/codec-utils":65,webwackify:76}],6:[function(e,n,r){(function(t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=n("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),d=n(e("./playlist-loader")),l=function(){},c=function(e){var t=e.default?"main":"alternative";return e.characteristics&&e.characteristics.indexOf("public.accessibility.describes-video")>=0&&(t="main-desc"),t},f=function(e,t){e.abort(),e.pause(),t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)};r.stopLoaders=f;var h=function(e,t){t.activePlaylistLoader=e,e.load()};r.startLoaders=h;var m=function(e,t){return function(){var n=t.segmentLoaders,r=n[e],o=n.main,d=t.mediaTypes[e],l=d.activeTrack(),c=d.activeGroup(l),m=d.activePlaylistLoader;f(r,d),c&&(c.playlistLoader?(r.resyncLoader(),h(c.playlistLoader,d)):m&&o.resetEverything())}};r.onGroupChanged=m;var y=function(e,t){return function(){var n=t.segmentLoaders,r=n[e],o=n.main,d=t.mediaTypes[e],l=d.activeTrack(),c=d.activeGroup(l),m=d.activePlaylistLoader;f(r,d),c&&(c.playlistLoader?m!==c.playlistLoader?(r.track&&r.track(l),r.resetEverything(),h(c.playlistLoader,d)):h(c.playlistLoader,d):o.resetEverything())}};r.onTrackChanged=y;var v={AUDIO:function(e,t){return function(){var n=t.segmentLoaders[e],r=t.mediaTypes[e],d=t.blacklistCurrentPlaylist;f(n,r);var l=r.activeTrack(),c=r.activeGroup(),h=(c.filter((function(e){return e.default}))[0]||c[0]).id,m=r.tracks[h];if(l!==m){for(var y in o.default.log.warn("Problem encountered loading the alternate audio track.Switching back to default."),r.tracks)r.tracks[y].enabled=r.tracks[y]===m;r.onTrackChanged()}else d({message:"Problem encountered loading the default audio track."})}},SUBTITLES:function(e,t){return function(){var n=t.segmentLoaders[e],r=t.mediaTypes[e];o.default.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),f(n,r);var track=r.activeTrack();track&&(track.mode="disabled"),r.onTrackChanged()}}};r.onError=v;var _={AUDIO:function(e,t,n){if(t){var r=n.tech,o=n.requestOptions,d=n.segmentLoaders[e];t.on("loadedmetadata",(function(){var e=t.media();d.playlist(e,o),(!r.paused()||e.endList&&"none"!==r.preload())&&d.load()})),t.on("loadedplaylist",(function(){d.playlist(t.media(),o),r.paused()||d.load()})),t.on("error",v[e](e,n))}},SUBTITLES:function(e,t,n){var r=n.tech,o=n.requestOptions,d=n.segmentLoaders[e],l=n.mediaTypes[e];t.on("loadedmetadata",(function(){var e=t.media();d.playlist(e,o),d.track(l.activeTrack()),(!r.paused()||e.endList&&"none"!==r.preload())&&d.load()})),t.on("loadedplaylist",(function(){d.playlist(t.media(),o),r.paused()||d.load()})),t.on("error",v[e](e,n))}};r.setupListeners=_;var T={AUDIO:function(e,t){var n=t.mode,r=t.hls,l=t.segmentLoaders[e],f=t.requestOptions,h=t.master.mediaGroups,m=t.mediaTypes[e],y=m.groups,T=m.tracks;for(var S in h[e]&&0!==Object.keys(h[e]).length&&"html5"===n||(h[e]={main:{default:{default:!0}}}),h[e])for(var w in y[S]||(y[S]=[]),h[e][S]){var k=h[e][S][w],O=void 0;if(O=k.resolvedUri?new d.default(k.resolvedUri,r,f):null,k=o.default.mergeOptions({id:w,playlistLoader:O},k),_[e](e,k.playlistLoader,t),y[S].push(k),void 0===T[w]){var track=new o.default.AudioTrack({id:w,kind:c(k),enabled:!1,language:k.language,default:k.default,label:w});T[w]=track}}l.on("error",v[e](e,t))},SUBTITLES:function(e,t){var n=t.tech,r=t.hls,l=t.segmentLoaders[e],c=t.requestOptions,f=t.master.mediaGroups,h=t.mediaTypes[e],m=h.groups,y=h.tracks;for(var T in f[e])for(var S in m[T]||(m[T]=[]),f[e][T])if(!f[e][T][S].forced){var w=f[e][T][S];if(w=o.default.mergeOptions({id:S,playlistLoader:new d.default(w.resolvedUri,r,c)},w),_[e](e,w.playlistLoader,t),m[T].push(w),void 0===y[S]){var track=n.addRemoteTextTrack({id:S,kind:"subtitles",enabled:!1,language:w.language,label:S},!1).track;y[S]=track}}l.on("error",v[e](e,t))},"CLOSED-CAPTIONS":function(e,t){var n=t.tech,r=t.master.mediaGroups,d=t.mediaTypes[e],l=d.groups,c=d.tracks;for(var f in r[e])for(var h in l[f]||(l[f]=[]),r[e][f]){var m=r[e][f][h];if(m.instreamId.match(/CC\d/)&&(l[f].push(o.default.mergeOptions({id:h},m)),void 0===c[h])){var track=n.addRemoteTextTrack({id:m.instreamId,kind:"captions",enabled:!1,language:m.language,label:h},!1).track;c[h]=track}}}};r.initialize=T;var S=function(e,t){return function(track){var n=t.masterPlaylistLoader,r=t.mediaTypes[e].groups,o=n.media();if(!o)return null;var d=null;return o.attributes[e]&&(d=r[o.attributes[e]]),d=d||r.main,void 0===track?d:null===track?null:d.filter((function(e){return e.id===track.id}))[0]||null}};r.activeGroup=S;var w={AUDIO:function(e,t){return function(){var n=t.mediaTypes[e].tracks;for(var r in n)if(n[r].enabled)return n[r];return null}},SUBTITLES:function(e,t){return function(){var n=t.mediaTypes[e].tracks;for(var r in n)if("showing"===n[r].mode)return n[r];return null}}};r.activeTrack=w;var k=function(e){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach((function(t){T[t](t,e)}));var t=e.mediaTypes,n=e.masterPlaylistLoader,r=e.tech,o=e.hls;["AUDIO","SUBTITLES"].forEach((function(n){t[n].activeGroup=S(n,e),t[n].activeTrack=w[n](n,e),t[n].onGroupChanged=m(n,e),t[n].onTrackChanged=y(n,e)}));var d=t.AUDIO.activeGroup(),l=(d.filter((function(e){return e.default}))[0]||d[0]).id;t.AUDIO.tracks[l].enabled=!0,t.AUDIO.onTrackChanged(),n.on("mediachange",(function(){["AUDIO","SUBTITLES"].forEach((function(e){return t[e].onGroupChanged()}))}));var c=function(){t.AUDIO.onTrackChanged(),r.trigger({type:"usage",name:"hls-audio-change"})};for(var f in r.audioTracks().addEventListener("change",c),r.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged),o.on("dispose",(function(){r.audioTracks().removeEventListener("change",c),r.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)})),r.clearTracks("audio"),t.AUDIO.tracks)r.audioTracks().addTrack(t.AUDIO.tracks[f])};r.setupMediaGroups=k;var O=function(){var e={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach((function(t){e[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:l,activeTrack:l,onGroupChanged:l,onTrackChanged:l}})),e};r.createMediaTypes=O}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./playlist-loader":9}],7:[function(e,n,r){(function(t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=n("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),d=e("./bin-utils"),l={FAILURE:2,TIMEOUT:-101,ABORTED:-102};r.REQUEST_ERRORS=l;var c=function(e){var t=void 0;return t=e.offset+e.length-1,"bytes="+e.offset+"-"+t},f=function(e){var t={};return e.byterange&&(t.Range=c(e.byterange)),t},h=function(e){e.forEach((function(e){e.abort()}))},m=function(e){return{bandwidth:e.bandwidth,bytesReceived:e.bytesReceived||0,roundTripTime:e.roundTripTime||0}},y=function(e){var t=e.target,n={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-t.requestTime||0};return n.bytesReceived=e.loaded,n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3),n},v=function(e,t){return t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:l.TIMEOUT,xhr:t}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:l.ABORTED,xhr:t}:e?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:l.FAILURE,xhr:t}:null},_=function(e,t){return function(n,r){var o=r.response,d=v(n,r);if(d)return t(d,e);if(16!==o.byteLength)return t({status:r.status,message:"Invalid HLS key at URL: "+r.uri,code:l.FAILURE,xhr:r},e);var view=new DataView(o);return e.key.bytes=new Uint32Array([view.getUint32(0),view.getUint32(4),view.getUint32(8),view.getUint32(12)]),t(null,e)}},T=function(e,t){return function(n,r){var o=r.response,d=v(n,r);return d?t(d,e):0===o.byteLength?t({status:r.status,message:"Empty HLS segment content at URL: "+r.uri,code:l.FAILURE,xhr:r},e):(e.map.bytes=new Uint8Array(r.response),t(null,e))}},S=function(e,t){return function(n,r){var o=r.response,d=v(n,r);return d?t(d,e):0===o.byteLength?t({status:r.status,message:"Empty HLS segment content at URL: "+r.uri,code:l.FAILURE,xhr:r},e):(e.stats=m(r),e.key?e.encryptedBytes=new Uint8Array(r.response):e.bytes=new Uint8Array(r.response),t(null,e))}},w=function(e,t,n){var r=function r(o){if(o.data.source===t.requestId){e.removeEventListener("message",r);var d=o.data.decrypted;return t.bytes=new Uint8Array(d.bytes,d.byteOffset,d.byteLength),n(null,t)}};e.addEventListener("message",r),e.postMessage((0,d.createTransferableMessage)({source:t.requestId,encrypted:t.encryptedBytes,key:t.key.bytes,iv:t.key.iv}),[t.encryptedBytes.buffer,t.key.bytes.buffer])},k=function(e){return e.reduce((function(e,t){return t.code>e.code?t:e}))},O=function(e,t,n){var r=[],o=0;return function(d,l){if(d&&(h(e),r.push(d)),(o+=1)===e.length){if(l.endOfAllRequests=Date.now(),r.length>0){var c=k(r);return n(c,l)}return l.encryptedBytes?w(t,l,n):n(null,l)}}},E=function(e,t){return function(n){return e.stats=o.default.mergeOptions(e.stats,y(n)),!e.stats.firstBytesReceivedAt&&e.stats.bytesReceived&&(e.stats.firstBytesReceivedAt=Date.now()),t(n,e)}},A=function(e,t,n,r,d,l){var c=[],m=O(c,n,l);if(r.key){var y=e(o.default.mergeOptions(t,{uri:r.key.resolvedUri,responseType:"arraybuffer"}),_(r,m));c.push(y)}if(r.map&&!r.map.bytes){var v=e(o.default.mergeOptions(t,{uri:r.map.resolvedUri,responseType:"arraybuffer",headers:f(r.map)}),T(r,m));c.push(v)}var w=e(o.default.mergeOptions(t,{uri:r.resolvedUri,responseType:"arraybuffer",headers:f(r)}),S(r,m));return w.addEventListener("progress",E(r,d)),c.push(w),function(){return h(c)}};r.mediaSegmentRequest=A}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./bin-utils":2}],8:[function(e,n,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function d(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c=d(e("global/window")),f=d(e("./ranges")),h=d("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),m=["seeking","seeked","pause","playing","error"],y=function(){function e(t){var n=this;l(this,e),this.tech_=t.tech,this.seekable=t.seekable,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.timer_=null,this.checkCurrentTimeTimeout_=null,t.debug&&(this.logger_=h.default.log.bind(h.default,"playback-watcher ->")),this.logger_("initialize");var r=function(){return n.monitorCurrentTime_()},o=function(){return n.techWaiting_()},d=function(){return n.cancelTimer_()},f=function(){return n.fixesBadSeeks_()};this.tech_.on("seekablechanged",f),this.tech_.on("waiting",o),this.tech_.on(m,d),this.tech_.on("canplay",r),this.dispose=function(){n.logger_("dispose"),n.tech_.off("seekablechanged",f),n.tech_.off("waiting",o),n.tech_.off(m,d),n.tech_.off("canplay",r),n.checkCurrentTimeTimeout_&&c.default.clearTimeout(n.checkCurrentTimeTimeout_),n.cancelTimer_()}}return o(e,[{key:"monitorCurrentTime_",value:function(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&c.default.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=c.default.setTimeout(this.monitorCurrentTime_.bind(this),250)}},{key:"checkCurrentTime_",value:function(){if(this.tech_.seeking()&&this.fixesBadSeeks_())return this.consecutiveUpdates=0,void(this.lastRecordedTime=this.tech_.currentTime());if(!this.tech_.paused()&&!this.tech_.seeking()){var e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+f.default.SAFE_TIME_DELTA>=t.end(t.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&e===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):e===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=e)}}},{key:"cancelTimer_",value:function(){this.consecutiveUpdates=0,this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_)),this.timer_=null}},{key:"fixesBadSeeks_",value:function(){var e=this.tech_.seeking(),t=this.seekable(),n=this.tech_.currentTime(),r=void 0;return e&&this.afterSeekableWindow_(t,n)&&(r=t.end(t.length-1)),e&&this.beforeSeekableWindow_(t,n)&&(r=t.start(0)+f.default.SAFE_TIME_DELTA),void 0!==r&&(this.logger_("Trying to seek outside of seekable at time "+n+" with seekable range "+f.default.printableRange(t)+". Seeking to "+r+"."),this.tech_.setCurrentTime(r),!0)}},{key:"waiting_",value:function(){if(!this.techWaiting_()){var e=this.tech_.currentTime(),t=this.tech_.buffered(),n=f.default.findRange(t,e);return n.length&&e+3<=n.end(0)?(this.cancelTimer_(),this.tech_.setCurrentTime(e),this.logger_("Stopped at "+e+" while inside a buffered region ["+n.start(0)+" -> "+n.end(0)+"]. Attempting to resume playback by seeking to the current time."),void this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"})):void 0}}},{key:"techWaiting_",value:function(){var e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking()&&this.fixesBadSeeks_())return!0;if(this.tech_.seeking()||null!==this.timer_)return!0;if(this.beforeSeekableWindow_(e,t)){var n=e.end(e.length-1);return this.logger_("Fell out of live window at time "+t+". Seeking to live point (seekable end) "+n),this.cancelTimer_(),this.tech_.setCurrentTime(n),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0}var r=this.tech_.buffered(),o=f.default.findNextRange(r,t);if(this.videoUnderflow_(o,r,t))return this.cancelTimer_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0;if(o.length>0){var d=o.start(0)-t;return this.logger_("Stopped at "+t+", setting timer for "+d+", seeking to "+o.start(0)),this.timer_=setTimeout(this.skipTheGap_.bind(this),1e3*d,t),!0}return!1}},{key:"afterSeekableWindow_",value:function(e,t){return!!e.length&&t>e.end(e.length-1)+f.default.SAFE_TIME_DELTA}},{key:"beforeSeekableWindow_",value:function(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-f.default.SAFE_TIME_DELTA)}},{key:"videoUnderflow_",value:function(e,t,n){if(0===e.length){var r=this.gapFromVideoUnderflow_(t,n);if(r)return this.logger_("Encountered a gap in video from "+r.start+" to "+r.end+". Seeking to current time "+n),!0}return!1}},{key:"skipTheGap_",value:function(e){var t=this.tech_.buffered(),n=this.tech_.currentTime(),r=f.default.findNextRange(t,n);this.cancelTimer_(),0!==r.length&&n===e&&(this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",r.start(0)),this.tech_.setCurrentTime(r.start(0)+f.default.TIME_FUDGE_FACTOR),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))}},{key:"gapFromVideoUnderflow_",value:function(e,t){for(var n=f.default.findGaps(e),i=0;i<n.length;i++){var r=n.start(i),o=n.end(i);if(t-r<4&&t-r>2)return{start:r,end:o}}return null}},{key:"logger_",value:function(){}}]),e}();r.default=y,n.exports=r.default}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ranges":12,"global/window":32}],9:[function(e,n,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t,n){for(var r=!0;r;){var object=e,o=t,d=n;r=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,o);if(void 0!==desc){if("value"in desc)return desc.value;var l=desc.get;if(void 0===l)return;return l.call(d)}var c=Object.getPrototypeOf(object);if(null===c)return;e=c,t=o,n=d,r=!0,desc=c=void 0}};function d(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=d(e("./resolve-url")),h="undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null,m=d(e("m3u8-parser")),y=d(e("global/window")),v=function(e,t,n){var r=t.slice();n=n||0;for(var o=Math.min(e.length,t.length+n),i=n;i<o;i++)r[i-n]=(0,h.mergeOptions)(e[i],r[i-n]);return r};r.updateSegments=v;var _=function(e,t){e.resolvedUri||(e.resolvedUri=(0,f.default)(t,e.uri)),e.key&&!e.key.resolvedUri&&(e.key.resolvedUri=(0,f.default)(t,e.key.uri)),e.map&&!e.map.resolvedUri&&(e.map.resolvedUri=(0,f.default)(t,e.map.uri))};r.resolveSegmentUris=_;var T=function(e,t){var n=(0,h.mergeOptions)(e,{}),r=n.playlists.filter((function(p){return p.uri===t.uri}))[0];if(!r)return null;if(r.segments&&t.segments&&r.segments.length===t.segments.length&&r.mediaSequence===t.mediaSequence)return null;var o=(0,h.mergeOptions)(r,t);r.segments&&(o.segments=v(r.segments,t.segments,t.mediaSequence-r.mediaSequence)),o.segments.forEach((function(e){_(e,o.resolvedUri)}));for(var i=0;i<n.playlists.length;i++)n.playlists[i].uri===t.uri&&(n.playlists[i]=o);return n.playlists[t.uri]=o,n};r.updateMaster=T;var S=function(e){for(var i=e.playlists.length;i--;){var t=e.playlists[i];e.playlists[t.uri]=t,t.resolvedUri=(0,f.default)(e.uri,t.uri),t.attributes||(t.attributes={},h.log.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute."))}};r.setupMediaPlaylists=S;var w=function(e){["AUDIO","SUBTITLES"].forEach((function(t){for(var n in e.mediaGroups[t])for(var r in e.mediaGroups[t][n]){var o=e.mediaGroups[t][n][r];o.uri&&(o.resolvedUri=(0,f.default)(e.uri,o.uri))}}))};r.resolveMediaGroupUris=w;var k=function(e,t){var n=e.segments[e.segments.length-1];return t&&n&&n.duration?1e3*n.duration:500*(e.targetDuration||10)};r.refreshDelay=k;var O=function(e){function t(e,n,r){var d=this;if(l(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),r=r||{},this.srcUrl=e,this.hls_=n,this.withCredentials=!!r.withCredentials,this.handleManifestRedirects=!!r.handleManifestRedirects,!this.srcUrl)throw new Error("A non-empty playlist URL is required");this.state="HAVE_NOTHING",this.on("mediaupdatetimeout",(function(){"HAVE_METADATA"===d.state&&(d.state="HAVE_CURRENT_METADATA",d.request=d.hls_.xhr({uri:(0,f.default)(d.master.uri,d.media().uri),withCredentials:d.withCredentials},(function(e,t){if(d.request)return e?d.playlistRequestError(d.request,d.media().uri,"HAVE_METADATA"):void d.haveMetadata(d.request,d.media().uri)})))}))}return c(t,e),n(t,[{key:"playlistRequestError",value:function(e,t,n){this.request=null,n&&(this.state=n),this.error={playlist:this.master.playlists[t],status:e.status,message:"HLS playlist request error at URL: "+t,responseText:e.responseText,code:e.status>=500?4:2},this.trigger("error")}},{key:"haveMetadata",value:function(e,t){var n=this;this.request=null,this.state="HAVE_METADATA";var r=new m.default.Parser;r.push(e.responseText),r.end(),r.manifest.uri=t,r.manifest.attributes=r.manifest.attributes||{};var o=T(this.master,r.manifest);this.targetDuration=r.manifest.targetDuration,o?(this.master=o,this.media_=this.master.playlists[r.manifest.uri]):this.trigger("playlistunchanged"),this.media().endList||(y.default.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=y.default.setTimeout((function(){n.trigger("mediaupdatetimeout")}),k(this.media(),!!o))),this.trigger("loadedplaylist")}},{key:"dispose",value:function(){this.stopRequest(),y.default.clearTimeout(this.mediaUpdateTimeout)}},{key:"stopRequest",value:function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}},{key:"media",value:function(e){var t=this;if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);var n=this.state;if("string"==typeof e){if(!this.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.master.playlists[e]}var r=!this.media_||e.uri!==this.media_.uri;if(this.master.playlists[e.uri].endList)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,void(r&&(this.trigger("mediachanging"),this.trigger("mediachange")));if(r){if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.request=this.hls_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials},(function(r,o){if(t.request){if(e.resolvedUri=t.resolveManifestRedirect(e.resolvedUri,o),r)return t.playlistRequestError(t.request,e.uri,n);t.haveMetadata(o,e.uri),"HAVE_MASTER"===n?t.trigger("loadedmetadata"):t.trigger("mediachange")}}))}}},{key:"resolveManifestRedirect",value:function(e,t){return this.handleManifestRedirects&&t.responseURL&&e!==t.responseURL?t.responseURL:e}},{key:"pause",value:function(){this.stopRequest(),y.default.clearTimeout(this.mediaUpdateTimeout),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MASTER":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")}},{key:"load",value:function(e){var t=this;y.default.clearTimeout(this.mediaUpdateTimeout);var n=this.media();if(e){var r=n?n.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=y.default.setTimeout((function(){return t.load()}),r)}else this.started?n&&!n.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()}},{key:"start",value:function(){var e=this;this.started=!0,this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},(function(t,n){if(e.request){if(e.request=null,t)return e.error={status:n.status,message:"HLS playlist request error at URL: "+e.srcUrl,responseText:n.responseText,code:2},"HAVE_NOTHING"===e.state&&(e.started=!1),e.trigger("error");var r=new m.default.Parser;return r.push(n.responseText),r.end(),e.state="HAVE_MASTER",e.srcUrl=e.resolveManifestRedirect(e.srcUrl,n),r.manifest.uri=e.srcUrl,r.manifest.playlists?(e.master=r.manifest,S(e.master),w(e.master),e.trigger("loadedplaylist"),void(e.request||e.media(r.manifest.playlists[0]))):(e.master={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:y.default.location.href,playlists:[{uri:e.srcUrl,resolvedUri:e.srcUrl,attributes:{}}]},e.master.playlists[e.srcUrl]=e.master.playlists[0],e.haveMetadata(n,e.srcUrl),e.trigger("loadedmetadata"))}}))}}]),t}(h.EventTarget);r.default=O}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./resolve-url":15,"global/window":32,"m3u8-parser":33}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var o=r(e("./config")),d=r(e("./playlist")),l=e("./util/codecs.js"),c=function(e,t){var n=void 0;return e&&(n=window.getComputedStyle(e))?n[t]:""},f=function(e,t){var n=e.slice();e.sort((function(e,r){var o=t(e,r);return 0===o?n.indexOf(e)-n.indexOf(r):o}))},h=function(e,t){var n=void 0,r=void 0;return e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),n=n||window.Number.MAX_VALUE,t.attributes.BANDWIDTH&&(r=t.attributes.BANDWIDTH),n-(r=r||window.Number.MAX_VALUE)};n.comparePlaylistBandwidth=h;var m=function(e,t){var n=void 0,r=void 0;return e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),n=n||window.Number.MAX_VALUE,t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(r=t.attributes.RESOLUTION.width),n===(r=r||window.Number.MAX_VALUE)&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH-t.attributes.BANDWIDTH:n-r};n.comparePlaylistResolution=m;var y=function(e,t,n,r){var l=e.playlists.map((function(e){var t=void 0,n=void 0;return t=e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width,n=e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height,{bandwidth:e.attributes.BANDWIDTH||window.Number.MAX_VALUE,width:t,height:n,playlist:e}}));f(l,(function(e,t){return e.bandwidth-t.bandwidth}));var c=(l=l.filter((function(e){return!d.default.isIncompatible(e.playlist)}))).filter((function(e){return d.default.isEnabled(e.playlist)}));c.length||(c=l.filter((function(e){return!d.default.isDisabled(e.playlist)})));var h=c.filter((function(e){return e.bandwidth*o.default.BANDWIDTH_VARIANCE<t})),m=h[h.length-1],y=h.filter((function(e){return e.bandwidth===m.bandwidth}))[0],v=h.filter((function(e){return e.width&&e.height}));f(v,(function(e,t){return e.width-t.width}));var _=v.filter((function(e){return e.width===n&&e.height===r}));m=_[_.length-1];var T=_.filter((function(e){return e.bandwidth===m.bandwidth}))[0],S=void 0,w=void 0,k=void 0;T||(w=(S=v.filter((function(e){return e.width>n||e.height>r}))).filter((function(e){return e.width===S[0].width&&e.height===S[0].height})),m=w[w.length-1],k=w.filter((function(e){return e.bandwidth===m.bandwidth}))[0]);var O=k||T||y||c[0]||l[0];return O?O.playlist:null};n.simpleSelector=y;var v=function(){return y(this.playlists.master,this.systemBandwidth,parseInt(c(this.tech_.el(),"width"),10),parseInt(c(this.tech_.el(),"height"),10))};n.lastBandwidthSelector=v;var _=function(e){var t=-1;if(e<0||e>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){return t<0&&(t=this.systemBandwidth),t=e*this.systemBandwidth+(1-e)*t,y(this.playlists.master,t,parseInt(c(this.tech_.el(),"width"),10),parseInt(c(this.tech_.el(),"height"),10))}};n.movingAverageBandwidthSelector=_;var T=function(e){var t=e.master,n=e.currentTime,r=e.bandwidth,o=e.duration,l=e.segmentDuration,c=e.timeUntilRebuffer,m=e.currentTimeline,y=e.syncController,v=t.playlists.filter((function(e){return!d.default.isIncompatible(e)})),_=v.filter(d.default.isEnabled);_.length||(_=v.filter((function(e){return!d.default.isDisabled(e)})));var T=_.filter(d.default.hasAttribute.bind(null,"BANDWIDTH")).map((function(e){var t=y.getSyncPoint(e,o,m,n)?1:2;return{playlist:e,rebufferingImpact:d.default.estimateSegmentRequestTime(l,r,e)*t-c}})),S=T.filter((function(e){return e.rebufferingImpact<=0}));return f(S,(function(a,b){return h(b.playlist,a.playlist)})),S.length?S[0]:(f(T,(function(a,b){return a.rebufferingImpact-b.rebufferingImpact})),T[0]||null)};n.minRebufferMaxBandwidthSelector=T;var S=function(){var e=this.playlists.master.playlists.filter(d.default.isEnabled);return f(e,(function(a,b){return h(a,b)})),e.filter((function(e){return(0,l.parseCodecs)(e.attributes.CODECS).videoCodec}))[0]||null};n.lowestBitrateCompatibleVariantSelector=S},{"./config":3,"./playlist":11,"./util/codecs.js":19}],11:[function(e,n,r){(function(t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o="undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null,d=n(e("global/window")),l=function(e,t){var n=0,i=t-e.mediaSequence,r=e.segments[i];if(r){if(void 0!==r.start)return{result:r.start,precise:!0};if(void 0!==r.end)return{result:r.end-r.duration,precise:!0}}for(;i--;){if(void 0!==(r=e.segments[i]).end)return{result:n+r.end,precise:!0};if(n+=r.duration,void 0!==r.start)return{result:n+r.start,precise:!0}}return{result:n,precise:!1}},c=function(e,t){for(var n=0,r=void 0,i=t-e.mediaSequence;i<e.segments.length;i++){if(void 0!==(r=e.segments[i]).start)return{result:r.start-n,precise:!0};if(n+=r.duration,void 0!==r.end)return{result:r.end-n,precise:!0}}return{result:-1,precise:!1}},f=function(e,t,n){var r=void 0,o=void 0;return void 0===t&&(t=e.mediaSequence+e.segments.length),t<e.mediaSequence?0:(r=l(e,t)).precise?r.result:(o=c(e,t)).precise?o.result:r.result+n},h=function(e,t,n){if(!e)return 0;if("number"!=typeof n&&(n=0),void 0===t){if(e.totalDuration)return e.totalDuration;if(!e.endList)return d.default.Infinity}return f(e,t,n)};r.duration=h;var m=function(e,t,n){var r=0;if(t>n){var o=[n,t];t=o[0],n=o[1]}if(t<0){for(var i=t;i<Math.min(0,n);i++)r+=e.targetDuration;t=0}for(i=t;i<n;i++)r+=e.segments[i].duration;return r};r.sumDurations=m;var y=function(e){if(!e.segments.length)return 0;for(var i=e.segments.length-1,t=e.segments[i].duration||e.targetDuration,n=t+2*e.targetDuration;i--&&!((t+=e.segments[i].duration)>=n););return Math.max(0,i)};r.safeLiveIndex=y;var v=function(e,t,n){if(!e||!e.segments)return null;if(e.endList)return h(e);if(null===t)return null;t=t||0;var r=n?y(e):e.segments.length;return f(e,e.mediaSequence+r,t)};r.playlistEnd=v;var _=function(e,t){var n=t||0,r=v(e,t,!0);return null===r?(0,o.createTimeRange)():(0,o.createTimeRange)(n,r)};r.seekable=_;var T=function(e){return e-Math.floor(e)==0},S=function(e,t){if(T(t))return t+.1*e;for(var n=t.toString().split(".")[1].length,i=1;i<=n;i++){var r=Math.pow(10,i),o=t*r;if(T(o)||i===n)return(o+e)/r}},w=S.bind(null,1),k=S.bind(null,-1),O=function(e,t,n,r){var i=void 0,o=void 0,d=e.segments.length,time=t-r;if(time<0){if(n>0)for(i=n-1;i>=0;i--)if(o=e.segments[i],(time+=k(o.duration))>0)return{mediaIndex:i,startTime:r-m(e,n,i)};return{mediaIndex:0,startTime:t}}if(n<0){for(i=n;i<0;i++)if((time-=e.targetDuration)<0)return{mediaIndex:0,startTime:t};n=0}for(i=n;i<d;i++)if(o=e.segments[i],(time-=w(o.duration))<0)return{mediaIndex:i,startTime:r+m(e,n,i)};return{mediaIndex:d-1,startTime:t}};r.getMediaInfoForTime=O;var E=function(e){return e.excludeUntil&&e.excludeUntil>Date.now()};r.isBlacklisted=E;var A=function(e){return e.excludeUntil&&e.excludeUntil===1/0};r.isIncompatible=A;var L=function(e){var t=E(e);return!e.disabled&&!t};r.isEnabled=L;var P=function(e){return e.disabled};r.isDisabled=P;var I=function(e){for(var i=0;i<e.segments.length;i++)if(e.segments[i].key)return!0;return!1};r.isAes=I;var C=function(e){for(var i=0;i<e.segments.length;i++)if(e.segments[i].map)return!0;return!1};r.isFmp4=C;var U=function(e,t){return t.attributes&&t.attributes[e]};r.hasAttribute=U;var M=function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?0:arguments[3];return U("BANDWIDTH",n)?(e*n.attributes.BANDWIDTH-8*r)/t:NaN};r.estimateSegmentRequestTime=M;var D=function(e,t){if(1===e.playlists.length)return!0;var n=t.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===e.playlists.filter((function(e){return!!L(e)&&(e.attributes.BANDWIDTH||0)<n})).length};r.isLowestEnabledRendition=D,r.default={duration:h,seekable:_,safeLiveIndex:y,getMediaInfoForTime:O,isEnabled:L,isDisabled:P,isBlacklisted:E,isIncompatible:A,playlistEnd:v,isAes:I,isFmp4:C,hasAttribute:U,estimateSegmentRequestTime:M,isLowestEnabledRendition:D}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"global/window":32}],12:[function(e,n,r){(function(e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){function e(e,i){var t=[],n=!0,r=!1,o=void 0;try{for(var d,l=e[Symbol.iterator]();!(n=(d=l.next()).done)&&(t.push(d.value),!i||t.length!==i);n=!0);}catch(e){r=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw o}}return t}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function o(e){return e&&e.__esModule?e:{default:e}}var d=o("undefined"!=typeof window?window.videojs:void 0!==e?e.videojs:null),l=1/30,c=3*l,f=function(e,n){var r=t(n,2),o=r[0],d=r[1];return Math.min(Math.max(o,e),d)},h=function(e,t){var n=[],i=void 0;if(e&&e.length)for(i=0;i<e.length;i++)t(e.start(i),e.end(i))&&n.push([e.start(i),e.end(i)]);return d.default.createTimeRanges(n)},m=function(e,time){return h(e,(function(e,t){return e-l<=time&&t+l>=time}))},y=function(e,time){return h(e,(function(e){return e-l>=time}))},v=function(e){if(e.length<2)return d.default.createTimeRanges();for(var t=[],i=1;i<e.length;i++){var n=e.end(i-1),r=e.start(i);t.push([n,r])}return d.default.createTimeRanges(t)},_=function(e,t){var i=void 0,n=void 0,r=void 0,o=[],d=[],l=function(span){return span[0]<=r&&span[1]>=r};if(e)for(i=0;i<e.length;i++)n=e.start(i),r=e.end(i),d.push([n,r]);if(t)for(i=0;i<t.length;i++)n=t.start(i),r=t.end(i),d.some(l)||o.push(r);return 1!==o.length?null:o[0]},T=function(e,t){var n=null,r=null,o=0,l=[],c=[];if(!(e&&e.length&&t&&t.length))return d.default.createTimeRange();for(var f=e.length;f--;)l.push({time:e.start(f),type:"start"}),l.push({time:e.end(f),type:"end"});for(f=t.length;f--;)l.push({time:t.start(f),type:"start"}),l.push({time:t.end(f),type:"end"});for(l.sort((function(a,b){return a.time-b.time})),f=0;f<l.length;f++)"start"===l[f].type?2==++o&&(n=l[f].time):"end"===l[f].type&&1==--o&&(r=l[f].time),null!==n&&null!==r&&(c.push([n,r]),n=null,r=null);return d.default.createTimeRanges(c)},S=function(e,t,n,r){for(var o=t.end(0)-t.start(0),d=o-(e.end(0)-e.start(0)),l=T(e,r),c=T(t,r),f=0,h=0,m=l.length;m--;)f+=l.end(m)-l.start(m),l.start(m)===n&&(f+=d);for(m=c.length;m--;)h+=c.end(m)-c.start(m);return Math.max(f,h)/o*100},w=function(e,t,n,r){var o=e+t,l=d.default.createTimeRanges([[e,o]]),c=d.default.createTimeRanges([[f(e,[n,o]),o]]);if(c.start(0)===c.end(0))return 0;var h=S(c,l,n,r);return isNaN(h)||h===1/0||h===-1/0?0:h},k=function(e){var t=[];if(!e||!e.length)return"";for(var i=0;i<e.length;i++)t.push(e.start(i)+" => "+e.end(i));return t.join(", ")},O=function(e,t){var n=arguments.length<=2||void 0===arguments[2]?1:arguments[2];return((e.length?e.end(e.length-1):0)-t)/n};r.default={findRange:m,findNextRange:y,findGaps:v,findSoleUncommonTimeRangesEnd:_,getSegmentBufferedPercent:w,TIME_FUDGE_FACTOR:l,SAFE_TIME_DELTA:c,printableRange:k,timeUntilRebuffer:O},n.exports=r.default}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(e,n,r){(function(e){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=t("undefined"!=typeof window?window.videojs:void 0!==e?e.videojs:null),d={errorInterval:30,getSource:function(e){return e(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_)}},l=function e(t,n){var r=0,l=0,c=o.default.mergeOptions(d,n);t.ready((function(){t.trigger({type:"usage",name:"hls-error-reload-initialized"})}));var f=function(){l&&t.currentTime(l)},h=function(e){null!=e&&(l=t.duration()!==1/0&&t.currentTime()||0,t.one("loadedmetadata",f),t.src(e),t.trigger({type:"usage",name:"hls-error-reload"}),t.play())},m=function(){if(Date.now()-r<1e3*c.errorInterval)t.trigger({type:"usage",name:"hls-error-reload-canceled"});else{if(c.getSource&&"function"==typeof c.getSource)return r=Date.now(),c.getSource.call(t,h);o.default.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}},y=function e(){t.off("loadedmetadata",f),t.off("error",m),t.off("dispose",e)},v=function(n){y(),e(t,n)};t.on("error",m),t.on("dispose",y),t.reloadSourceOnError=v},c=function(e){l(this,e)};r.default=c,n.exports=r.default}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./playlist.js"),d=function(e,t,n){return function(r){var d=e.master.playlists[t],l=(0,o.isIncompatible)(d),c=(0,o.isEnabled)(d);return void 0===r?c:(r?delete d.disabled:d.disabled=!0,r===c||l||(n(),r?e.trigger("renditionenabled"):e.trigger("renditiondisabled")),r)}},l=function e(t,n,o){r(this,e);var l=t.masterPlaylistController_.fastQualityChange_.bind(t.masterPlaylistController_);if(n.attributes.RESOLUTION){var c=n.attributes.RESOLUTION;this.width=c.width,this.height=c.height}this.bandwidth=n.attributes.BANDWIDTH,this.id=o,this.enabled=d(t.playlists,n.uri,l)},c=function(e){var t=e.playlists;e.representations=function(){return t.master.playlists.filter((function(e){return!(0,o.isIncompatible)(e)})).map((function(t,i){return new l(e,t,t.uri)}))}};n.default=c,t.exports=n.default},{"./playlist.js":11}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var o=r(e("url-toolkit")),d=r(e("global/window")),l=function(e,t){return/^[a-z]+:/i.test(t)?t:(/\/\//i.test(e)||(e=o.default.buildAbsoluteURL(d.default.location.href,e)),o.default.buildAbsoluteURL(e,t))};n.default=l,t.exports=n.default},{"global/window":32,"url-toolkit":63}],16:[function(e,n,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t,n){for(var r=!0;r;){var object=e,o=t,d=n;r=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,o);if(void 0!==desc){if("value"in desc)return desc.value;var l=desc.get;if(void 0===l)return;return l.call(d)}var c=Object.getPrototypeOf(object);if(null===c)return;e=c,t=o,n=d,r=!0,desc=c=void 0}};function d(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=d(e("./playlist")),h=d("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),m=d(e("./source-updater")),y=d(e("./config")),v=d(e("global/window")),_=d(e("videojs-contrib-media-sources/es5/remove-cues-from-track.js")),T=e("./bin-utils"),S=e("./media-segment-request"),w=e("./ranges"),k=e("./playlist-selectors"),O=500,E=function(e,t,n){if(!e||!t)return!1;var r=n===e.segments.length;return e.endList&&"open"===t.readyState&&r},A=function(e){return"number"==typeof e&&isFinite(e)},L=function(e,t,n){return"main"===e&&t&&n?n.containsAudio||n.containsVideo?t.containsVideo&&!n.containsVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!t.containsVideo&&n.containsVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null};r.illegalMediaSwitch=L;var P=function(e,t,n){var r=void 0;return r=e.length&&e.start(0)>0&&e.start(0)<t?e.start(0):t-30,Math.min(r,t-n)};r.safeBackBufferTrimTime=P;var I=function(e){function t(e){var n=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(l(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),!e)throw new TypeError("Initialization settings are required");if("function"!=typeof e.currentTime)throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.state="INIT",this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.hls_=e.hls,this.loaderType_=e.loaderType,this.startingMedia_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.pendingSegment_=null,this.mimeType_=null,this.sourceUpdater_=null,this.xhrOptions_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.syncController_.on("syncinfoupdate",(function(){return n.trigger("syncinfoupdate")})),this.mediaSource_.addEventListener("sourceopen",(function(){return n.ended_=!1})),this.fetchAtBuffer_=!1,r.debug&&(this.logger_=h.default.log.bind(h.default,"segment-loader",this.loaderType_,"->"))}return c(t,e),n(t,[{key:"resetStats_",value:function(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0}},{key:"dispose",value:function(){this.state="DISPOSED",this.pause(),this.abort_(),this.sourceUpdater_&&this.sourceUpdater_.dispose(),this.resetStats_()}},{key:"abort",value:function(){"WAITING"===this.state?(this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()):this.pendingSegment_&&(this.pendingSegment_=null)}},{key:"abort_",value:function(){this.pendingSegment_&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null}},{key:"error",value:function(e){return void 0!==e&&(this.error_=e),this.pendingSegment_=null,this.error_}},{key:"endOfStream",value:function(){this.ended_=!0,this.pause(),this.trigger("ended")}},{key:"buffered_",value:function(){return this.sourceUpdater_?this.sourceUpdater_.buffered():h.default.createTimeRanges()}},{key:"initSegment",value:function(map){var e=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];if(!map)return null;var t=(0,T.initSegmentId)(map),n=this.initSegments_[t];return e&&!n&&map.bytes&&(this.initSegments_[t]=n={resolvedUri:map.resolvedUri,byterange:map.byterange,bytes:map.bytes}),n||map}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&(this.sourceUpdater_||this.mimeType_&&"INIT"===this.state)&&!this.paused()}},{key:"load",value:function(){if(this.monitorBuffer_(),this.playlist_){if(this.syncController_.setDateTimeMapping(this.playlist_),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY")}}},{key:"init_",value:function(){return this.state="READY",this.sourceUpdater_=new m.default(this.mediaSource_,this.mimeType_),this.resetEverything(),this.monitorBuffer_()}},{key:"playlist",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(e){var n=this.playlist_,r=this.pendingSegment_;if(this.playlist_=e,this.xhrOptions_=t,this.hasPlayed_()||(e.syncInfo={mediaSequence:e.mediaSequence,time:0}),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(n&&n.uri===e.uri){var o=e.mediaSequence-n.mediaSequence;this.logger_("mediaSequenceDiff",o),null!==this.mediaIndex&&(this.mediaIndex-=o),r&&(r.mediaIndex-=o,r.mediaIndex>=0&&(r.segment=e.segments[r.mediaIndex])),this.syncController_.saveExpiredSegmentInfo(n,e)}else null!==this.mediaIndex&&this.resyncLoader()}}},{key:"pause",value:function(){this.checkBufferTimeout_&&(v.default.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}},{key:"paused",value:function(){return null===this.checkBufferTimeout_}},{key:"mimeType",value:function(e){this.mimeType_||(this.mimeType_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_())}},{key:"resetEverything",value:function(){this.ended_=!1,this.resetLoader(),this.remove(0,this.duration_()),this.trigger("reseteverything")}},{key:"resetLoader",value:function(){this.fetchAtBuffer_=!1,this.resyncLoader()}},{key:"resyncLoader",value:function(){this.mediaIndex=null,this.syncPoint_=null,this.abort()}},{key:"remove",value:function(e,t){this.sourceUpdater_&&this.sourceUpdater_.remove(e,t),(0,_.default)(e,t,this.segmentMetadataTrack_)}},{key:"monitorBuffer_",value:function(){this.checkBufferTimeout_&&v.default.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=v.default.setTimeout(this.monitorBufferTick_.bind(this),1)}},{key:"monitorBufferTick_",value:function(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&v.default.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=v.default.setTimeout(this.monitorBufferTick_.bind(this),O)}},{key:"fillBuffer_",value:function(){if(!this.sourceUpdater_.updating()){this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var e=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);e&&(E(this.playlist_,this.mediaSource_,e.mediaIndex)?this.endOfStream():(e.mediaIndex!==this.playlist_.segments.length-1||"ended"!==this.mediaSource_.readyState||this.seeking_())&&((e.timeline!==this.currentTimeline_||null!==e.startOfSegment&&e.startOfSegment<this.sourceUpdater_.timestampOffset())&&(this.syncController_.reset(),e.timestampOffset=e.startOfSegment),this.loadSegment_(e)))}}},{key:"checkBuffer_",value:function(e,t,n,r,o,d){var l=0,c=void 0;e.length&&(l=e.end(e.length-1));var h,m=Math.max(0,l-o);if(!t.segments.length)return null;if(m>=this.goalBufferLength_())return null;if(!r&&m>=1)return null;if(this.logger_("checkBuffer_","mediaIndex:",n,"hasPlayed:",r,"currentTime:",o,"syncPoint:",d,"fetchAtBuffer:",this.fetchAtBuffer_,"bufferedTime:",m),null===d)return n=this.getSyncSegmentCandidate_(t),this.logger_("getSync","mediaIndex:",n),this.generateSegmentInfo_(t,n,null,!0);if(null!==n){this.logger_("walkForward","mediaIndex:",n+1);var y=t.segments[n];return c=y&&y.end?y.end:l,this.generateSegmentInfo_(t,n+1,c,!1)}return this.fetchAtBuffer_?(n=(h=f.default.getMediaInfoForTime(t,l,d.segmentIndex,d.time)).mediaIndex,c=h.startTime):(n=(h=f.default.getMediaInfoForTime(t,o,d.segmentIndex,d.time)).mediaIndex,c=h.startTime),this.logger_("getMediaIndexForTime","mediaIndex:",n,"startOfSegment:",c),this.generateSegmentInfo_(t,n,c,!1)}},{key:"getSyncSegmentCandidate_",value:function(e){var t=this;if(-1===this.currentTimeline_)return 0;var n=e.segments.map((function(s,i){return{timeline:s.timeline,segmentIndex:i}})).filter((function(s){return s.timeline===t.currentTimeline_}));return n.length?n[Math.min(n.length-1,1)].segmentIndex:Math.max(e.segments.length-1,0)}},{key:"generateSegmentInfo_",value:function(e,t,n,r){if(t<0||t>=e.segments.length)return null;var o=e.segments[t];return{requestId:"segment-loader-"+Math.random(),uri:o.resolvedUri,mediaIndex:t,isSyncRequest:r,startOfSegment:n,playlist:e,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:o.timeline,duration:o.duration,segment:o}}},{key:"abortRequestEarly_",value:function(e){if(this.hls_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH)return!1;if(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return!1;var t=this.currentTime_(),n=e.bandwidth,r=this.pendingSegment_.duration,o=f.default.estimateSegmentRequestTime(r,n,this.playlist_,e.bytesReceived),d=(0,w.timeUntilRebuffer)(this.buffered_(),t,this.hls_.tech_.playbackRate())-1;if(o<=d)return!1;var l=(0,k.minRebufferMaxBandwidthSelector)({master:this.hls_.playlists.master,currentTime:t,bandwidth:n,duration:this.duration_(),segmentDuration:r,timeUntilRebuffer:d,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(l){var c=o-d-l.rebufferingImpact,h=.5;return d<=w.TIME_FUDGE_FACTOR&&(h=1),!(!l.playlist||l.playlist.uri===this.playlist_.uri||c<h||(this.bandwidth=l.playlist.attributes.BANDWIDTH*y.default.BANDWIDTH_VARIANCE+1,this.abort(),this.trigger("earlyabort"),0))}}},{key:"handleProgress_",value:function(e,t){this.pendingSegment_&&t.requestId===this.pendingSegment_.requestId&&!this.abortRequestEarly_(t.stats)&&this.trigger("progress")}},{key:"loadSegment_",value:function(e){this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),e.abortRequests=(0,S.mediaSegmentRequest)(this.hls_.xhr,this.xhrOptions_,this.decrypter_,this.createSimplifiedSegmentObj_(e),this.handleProgress_.bind(this),this.segmentRequestFinished_.bind(this))}},{key:"trimBackBuffer_",value:function(e){var t=P(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}},{key:"createSimplifiedSegmentObj_",value:function(e){var t=e.segment,n={resolvedUri:t.resolvedUri,byterange:t.byterange,requestId:e.requestId};if(t.key){var r=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);n.key={resolvedUri:t.key.resolvedUri,iv:r}}return t.map&&(n.map=this.initSegment(t.map)),n}},{key:"segmentRequestFinished_",value:function(e,t){if(this.mediaRequests+=1,t.stats&&(this.mediaBytesTransferred+=t.stats.bytesReceived,this.mediaTransferDuration+=t.stats.roundTripTime),this.pendingSegment_){if(t.requestId===this.pendingSegment_.requestId){if(e)return this.pendingSegment_=null,this.state="READY",e.code===S.REQUEST_ERRORS.ABORTED?void(this.mediaRequestsAborted+=1):(this.pause(),e.code===S.REQUEST_ERRORS.TIMEOUT?(this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,void this.trigger("bandwidthupdate")):(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error")));this.bandwidth=t.stats.bandwidth,this.roundTrip=t.stats.roundTripTime,t.map&&(t.map=this.initSegment(t.map,!0)),this.processSegmentResponse_(t)}}else this.mediaRequestsAborted+=1}},{key:"processSegmentResponse_",value:function(e){var t=this.pendingSegment_;t.bytes=e.bytes,e.map&&(t.segment.map.bytes=e.map.bytes),t.endOfAllRequests=e.endOfAllRequests,this.handleSegment_()}},{key:"handleSegment_",value:function(){var e=this;if(this.pendingSegment_){var t=this.pendingSegment_,n=t.segment,r=this.syncController_.probeSegmentInfo(t);void 0===this.startingMedia_&&r&&(r.containsAudio||r.containsVideo)&&(this.startingMedia_={containsAudio:r.containsAudio,containsVideo:r.containsVideo});var o=L(this.loaderType_,this.startingMedia_,r);if(o)return this.error({message:o,blacklistDuration:1/0}),void this.trigger("error");if(t.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");null!==t.timestampOffset&&t.timestampOffset!==this.sourceUpdater_.timestampOffset()&&(this.sourceUpdater_.timestampOffset(t.timestampOffset),this.trigger("timestampoffset"));var d=this.syncController_.mappingForTimeline(t.timeline);null!==d&&this.trigger({type:"segmenttimemapping",mapping:d}),this.state="APPENDING",n.map&&function(){var t=(0,T.initSegmentId)(n.map);if(!e.activeInitSegmentId_||e.activeInitSegmentId_!==t){var r=e.initSegment(n.map);e.sourceUpdater_.appendBuffer(r.bytes,(function(){e.activeInitSegmentId_=t}))}}(),t.byteLength=t.bytes.byteLength,"number"==typeof n.start&&"number"==typeof n.end?this.mediaSecondsLoaded+=n.end-n.start:this.mediaSecondsLoaded+=n.duration,this.sourceUpdater_.appendBuffer(t.bytes,this.handleUpdateEnd_.bind(this))}else this.state="READY"}},{key:"handleUpdateEnd_",value:function(){if(this.logger_("handleUpdateEnd_","segmentInfo:",this.pendingSegment_),!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());var e=this.pendingSegment_,t=e.segment,n=null!==this.mediaIndex;this.pendingSegment_=null,this.recordThroughput_(e),this.addSegmentMetadataCue_(e),this.state="READY",this.mediaIndex=e.mediaIndex,this.fetchAtBuffer_=!0,this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate"),t.end&&this.currentTime_()-t.end>3*e.playlist.targetDuration?this.resetEverything():(n&&this.trigger("bandwidthupdate"),this.trigger("progress"),E(e.playlist,this.mediaSource_,e.mediaIndex+1)&&this.endOfStream(),this.paused()||this.monitorBuffer_())}},{key:"recordThroughput_",value:function(e){var t=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,r=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(r-t)/++this.throughput.count}},{key:"logger_",value:function(){}},{key:"addSegmentMetadataCue_",value:function(e){if(this.segmentMetadataTrack_){var t=e.segment,n=t.start,r=t.end;if(A(n)&&A(r)){(0,_.default)(n,r,this.segmentMetadataTrack_);var o=v.default.WebKitDataCue||v.default.VTTCue,d={bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.uri,start:n,end:r},l=new o(n,r,JSON.stringify(d));l.value=d,this.segmentMetadataTrack_.addCue(l)}}}}]),t}(h.default.EventTarget);r.default=I}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./bin-utils":2,"./config":3,"./media-segment-request":7,"./playlist":11,"./playlist-selectors":10,"./ranges":12,"./source-updater":17,"global/window":32,"videojs-contrib-media-sources/es5/remove-cues-from-track.js":72}],17:[function(e,n,r){(function(e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var t=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=o("undefined"!=typeof window?window.videojs:void 0!==e?e.videojs:null),c=function(){},f=function(){function e(t,n){var r=this;d(this,e);var o=function(){r.sourceBuffer_=t.addSourceBuffer(n),r.onUpdateendCallback_=function(){var e=r.pendingCallback_;r.pendingCallback_=null,e&&e(),r.runCallback_()},r.sourceBuffer_.addEventListener("updateend",r.onUpdateendCallback_),r.runCallback_()};this.callbacks_=[],this.pendingCallback_=null,this.timestampOffset_=0,this.mediaSource=t,this.processedAppend_=!1,"closed"===t.readyState?t.addEventListener("sourceopen",o):o()}return t(e,[{key:"abort",value:function(e){var t=this;this.processedAppend_&&this.queueCallback_((function(){t.sourceBuffer_.abort()}),e)}},{key:"appendBuffer",value:function(e,t){var n=this;this.processedAppend_=!0,this.queueCallback_((function(){n.sourceBuffer_.appendBuffer(e)}),t)}},{key:"buffered",value:function(){return this.sourceBuffer_?this.sourceBuffer_.buffered:l.default.createTimeRanges()}},{key:"remove",value:function(e,t){var n=this;this.processedAppend_&&this.queueCallback_((function(){n.sourceBuffer_.remove(e,t)}),c)}},{key:"updating",value:function(){return!this.sourceBuffer_||this.sourceBuffer_.updating||this.pendingCallback_}},{key:"timestampOffset",value:function(e){var t=this;return void 0!==e&&(this.queueCallback_((function(){t.sourceBuffer_.timestampOffset=e})),this.timestampOffset_=e),this.timestampOffset_}},{key:"queueCallback_",value:function(e,t){this.callbacks_.push([e.bind(this),t]),this.runCallback_()}},{key:"runCallback_",value:function(){var e=void 0;!this.updating()&&this.callbacks_.length&&(e=this.callbacks_.shift(),this.pendingCallback_=e[1],e[0]())}},{key:"dispose",value:function(){this.sourceBuffer_.removeEventListener("updateend",this.onUpdateendCallback_),this.sourceBuffer_&&"open"===this.mediaSource.readyState&&this.sourceBuffer_.abort()}}]),e}();r.default=f,n.exports=r.default}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],18:[function(e,n,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t,n){for(var r=!0;r;){var object=e,o=t,d=n;r=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,o);if(void 0!==desc){if("value"in desc)return desc.value;var l=desc.get;if(void 0===l)return;return l.call(d)}var c=Object.getPrototypeOf(object);if(null===c)return;e=c,t=o,n=d,r=!0,desc=c=void 0}};function d(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=d(e("mux.js/lib/mp4/probe")),h=e("mux.js/lib/tools/ts-inspector.js"),m=e("./playlist"),y=d("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),v=[{name:"VOD",run:function(e,t,n,r,o){return n!==1/0?{time:0,segmentIndex:0}:null}},{name:"ProgramDateTime",run:function(e,t,n,r,o){return e.datetimeToDisplayTime&&t.dateTimeObject?{time:t.dateTimeObject.getTime()/1e3+e.datetimeToDisplayTime,segmentIndex:0}:null}},{name:"Segment",run:function(e,t,n,r,o){var d=t.segments||[],l=null,c=null;o=o||0;for(var i=0;i<d.length;i++){var f=d[i];if(f.timeline===r&&void 0!==f.start){var h=Math.abs(o-f.start);if(null!==c&&c<h)break;(!l||null===c||c>=h)&&(c=h,l={time:f.start,segmentIndex:i})}}return l}},{name:"Discontinuity",run:function(e,t,n,r,o){var d=null;if(o=o||0,t.discontinuityStarts&&t.discontinuityStarts.length)for(var l=null,i=0;i<t.discontinuityStarts.length;i++){var c=t.discontinuityStarts[i],f=t.discontinuitySequence+i+1,h=e.discontinuities[f];if(h){var m=Math.abs(o-h.time);if(null!==l&&l<m)break;(!d||null===l||l>=m)&&(l=m,d={time:h.time,segmentIndex:c})}}return d}},{name:"Playlist",run:function(e,t,n,r,o){return t.syncInfo?{time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence}:null}}];r.syncPointStrategies=v;var _=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];l(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.inspectCache_=void 0,this.timelines=[],this.discontinuities=[],this.datetimeToDisplayTime=null,e.debug&&(this.logger_=y.default.log.bind(y.default,"sync-controller ->"))}return c(t,e),n(t,[{key:"getSyncPoint",value:function(e,t,n,r){var o=this.runStrategies_(e,t,n,r);return o.length?this.selectSyncPoint_(o,{key:"time",value:r}):null}},{key:"getExpiredTime",value:function(e,t){if(!e||!e.segments)return null;var n=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!n.length)return null;var r=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return r.segmentIndex>0&&(r.time*=-1),Math.abs(r.time+(0,m.sumDurations)(e,r.segmentIndex,0))}},{key:"runStrategies_",value:function(e,t,n,r){for(var o=[],i=0;i<v.length;i++){var d=v[i],l=d.run(this,e,t,n,r);l&&(l.strategy=d.name,o.push({strategy:d.name,syncPoint:l}),this.logger_("syncPoint found via <"+d.name+">:",l))}return o}},{key:"selectSyncPoint_",value:function(e,t){for(var n=e[0].syncPoint,r=Math.abs(e[0].syncPoint[t.key]-t.value),o=e[0].strategy,i=1;i<e.length;i++){var d=Math.abs(e[i].syncPoint[t.key]-t.value);d<r&&(r=d,n=e[i].syncPoint,o=e[i].strategy)}return this.logger_("syncPoint with strategy <"+o+"> chosen: ",n),n}},{key:"saveExpiredSegmentInfo",value:function(e,t){for(var i=t.mediaSequence-e.mediaSequence-1;i>=0;i--){var n=e.segments[i];if(n&&void 0!==n.start){t.syncInfo={mediaSequence:e.mediaSequence+i,time:n.start},this.logger_("playlist sync:",t.syncInfo),this.trigger("syncinfoupdate");break}}}},{key:"setDateTimeMapping",value:function(e){if(!this.datetimeToDisplayTime&&e.dateTimeObject){var t=e.dateTimeObject.getTime()/1e3;this.datetimeToDisplayTime=-t}}},{key:"reset",value:function(){this.inspectCache_=void 0}},{key:"probeSegmentInfo",value:function(e){var t=e.segment,n=e.playlist,r=void 0;return(r=t.map?this.probeMp4Segment_(e):this.probeTsSegment_(e))&&this.calculateSegmentTimeMapping_(e,r)&&(this.saveDiscontinuitySyncInfo_(e),n.syncInfo||(n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:t.start})),r}},{key:"probeMp4Segment_",value:function(e){var t=e.segment,n=f.default.timescale(t.map.bytes),r=f.default.startTime(n,e.bytes);return null!==e.timestampOffset&&(e.timestampOffset-=r),{start:r,end:r+t.duration}}},{key:"probeTsSegment_",value:function(e){var t=(0,h.inspect)(e.bytes,this.inspectCache_),n=void 0,r=void 0;return t?(t.video&&2===t.video.length?(this.inspectCache_=t.video[1].dts,n=t.video[0].dtsTime,r=t.video[1].dtsTime):t.audio&&2===t.audio.length&&(this.inspectCache_=t.audio[1].dts,n=t.audio[0].dtsTime,r=t.audio[1].dtsTime),{start:n,end:r,containsVideo:t.video&&2===t.video.length,containsAudio:t.audio&&2===t.audio.length}):null}},{key:"timestampOffsetForTimeline",value:function(e){return void 0===this.timelines[e]?null:this.timelines[e].time}},{key:"mappingForTimeline",value:function(e){return void 0===this.timelines[e]?null:this.timelines[e].mapping}},{key:"calculateSegmentTimeMapping_",value:function(e,t){var n=e.segment,r=this.timelines[e.timeline];if(null!==e.timestampOffset)this.logger_("tsO:",e.timestampOffset),r={time:e.startOfSegment,mapping:e.startOfSegment-t.start},this.timelines[e.timeline]=r,this.trigger("timestampoffset"),n.start=e.startOfSegment,n.end=t.end+r.mapping;else{if(!r)return!1;n.start=t.start+r.mapping,n.end=t.end+r.mapping}return!0}},{key:"saveDiscontinuitySyncInfo_",value:function(e){var t=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(t.discontinuityStarts.length)for(var i=0;i<t.discontinuityStarts.length;i++){var r=t.discontinuityStarts[i],o=t.discontinuitySequence+i+1,d=r-e.mediaIndex,l=Math.abs(d);if(!this.discontinuities[o]||this.discontinuities[o].accuracy>l){var time=void 0;time=d<0?n.start-(0,m.sumDurations)(t,e.mediaIndex,r):n.end+(0,m.sumDurations)(t,e.mediaIndex+1,r),this.discontinuities[o]={time:time,accuracy:l}}}}},{key:"logger_",value:function(){}}]),t}(y.default.EventTarget);r.default=_}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./playlist":11,"mux.js/lib/mp4/probe":57,"mux.js/lib/tools/ts-inspector.js":59}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t={codecCount:0},n=void 0;return t.codecCount=e.split(",").length,t.codecCount=t.codecCount||2,(n=/(^|\s|,)+(avc1)([^ ,]*)/i.exec(e))&&(t.videoCodec=n[2],t.videoObjectTypeIndicator=n[3]),t.audioProfile=/(^|\s|,)+mp4a.[0-9A-Fa-f]+\.([0-9A-Fa-f]+)/i.exec(e),t.audioProfile=t.audioProfile&&t.audioProfile[2],t};n.parseCodecs=r},{}],20:[function(e,n,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=function(e,t,n){for(var r=!0;r;){var object=e,o=t,d=n;r=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,o);if(void 0!==desc){if("value"in desc)return desc.value;var l=desc.get;if(void 0===l)return;return l.call(d)}var c=Object.getPrototypeOf(object);if(null===c)return;e=c,t=o,n=d,r=!0,desc=c=void 0}};function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=l(e("./segment-loader")),m=l("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),y=l(e("global/window")),v=l(e("videojs-contrib-media-sources/es5/remove-cues-from-track.js")),_=e("./bin-utils"),T=new Uint8Array("\n\n".split("").map((function(e){return e.charCodeAt(0)}))),S=function(e){return String.fromCharCode.apply(null,e)},w=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];c(this,t),d(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n),this.mediaSource_=null,this.subtitlesTrack_=null}return f(t,e),o(t,[{key:"buffered_",value:function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues.length)return m.default.createTimeRanges();var e=this.subtitlesTrack_.cues,t=e[0].startTime,n=e[e.length-1].startTime;return m.default.createTimeRanges([[t,n]])}},{key:"initSegment",value:function(map){var e=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];if(!map)return null;var t=(0,_.initSegmentId)(map),n=this.initSegments_[t];if(e&&!n&&map.bytes){var r=T.byteLength+map.bytes.byteLength,o=new Uint8Array(r);o.set(map.bytes),o.set(T,map.bytes.byteLength),this.initSegments_[t]=n={resolvedUri:map.resolvedUri,byterange:map.byterange,bytes:o}}return n||map}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}},{key:"init_",value:function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}},{key:"track",value:function(e){return void 0===e||(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_()),this.subtitlesTrack_}},{key:"remove",value:function(e,t){(0,v.default)(e,t,this.subtitlesTrack_)}},{key:"fillBuffer_",value:function(){var e=this;this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var t=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);if(t=this.skipEmptySegments_(t)){if(null===this.syncController_.timestampOffsetForTimeline(t.timeline)){var n=function(){e.state="READY",e.paused()||e.monitorBuffer_()};return this.syncController_.one("timestampoffset",n),void(this.state="WAITING_ON_TIMELINE")}this.loadSegment_(t)}}},{key:"skipEmptySegments_",value:function(e){for(;e&&e.segment.empty;)e=this.generateSegmentInfo_(e.playlist,e.mediaIndex+1,e.startOfSegment+e.duration,e.isSyncRequest);return e}},{key:"handleSegment_",value:function(){var e=this;if(this.pendingSegment_&&this.subtitlesTrack_){this.state="APPENDING";var t,n=this.pendingSegment_,r=n.segment;if("function"!=typeof y.default.WebVTT&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_){var o=(t=function(){e.handleSegment_()},e.state="WAITING_ON_VTTJS",e.subtitlesTrack_.tech_.one("vttjsloaded",t),e.subtitlesTrack_.tech_.one("vttjserror",(function(){e.subtitlesTrack_.tech_.off("vttjsloaded",t),e.error({message:"Error loading vtt.js"}),e.state="READY",e.pause(),e.trigger("error")})),{v:void 0});if("object"==typeof o)return o.v}r.requested=!0;try{this.parseVTTCues_(n)}catch(e){return this.error({message:e.message}),this.state="READY",this.pause(),this.trigger("error")}if(this.updateTimeMapping_(n,this.syncController_.timelines[n.timeline],this.playlist_),n.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");n.byteLength=n.bytes.byteLength,this.mediaSecondsLoaded+=r.duration,n.cues.length&&this.remove(n.cues[0].endTime,n.cues[n.cues.length-1].endTime),n.cues.forEach((function(t){e.subtitlesTrack_.addCue(t)})),this.handleUpdateEnd_()}else this.state="READY"}},{key:"parseVTTCues_",value:function(e){var t=void 0,n=!1;"function"==typeof y.default.TextDecoder?t=new y.default.TextDecoder("utf8"):(t=y.default.WebVTT.StringDecoder(),n=!0);var r=new y.default.WebVTT.Parser(y.default,y.default.vttjs,t);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},r.oncue=e.cues.push.bind(e.cues),r.ontimestampmap=function(map){return e.timestampmap=map},r.onparsingerror=function(e){m.default.log.warn("Error encountered when parsing cues: "+e.message)},e.segment.map){var o=e.segment.map.bytes;n&&(o=S(o)),r.parse(o)}var d=e.bytes;n&&(d=S(d)),r.parse(d),r.flush()}},{key:"updateTimeMapping_",value:function(e,t,n){var r=e.segment;if(t)if(e.cues.length){var o=e.timestampmap,d=o.MPEGTS/9e4-o.LOCAL+t.mapping;if(e.cues.forEach((function(e){e.startTime+=d,e.endTime+=d})),!n.syncInfo){var l=e.cues[0].startTime,c=e.cues[e.cues.length-1].startTime;n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(l,c-r.duration)}}}else r.empty=!0}}]),t}(h.default);r.default=w,n.exports=r.default}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./bin-utils":2,"./segment-loader":16,"global/window":32,"videojs-contrib-media-sources/es5/remove-cues-from-track.js":72}],21:[function(e,n,r){(function(e){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o="undefined"!=typeof window?window.videojs:void 0!==e?e.videojs:null,d=t(o),l=function(){return function e(t,n){t=(0,o.mergeOptions)({timeout:45e3},t);var r=e.beforeRequest||d.default.Hls.xhr.beforeRequest;if(r&&"function"==typeof r){var l=r(t);l&&(t=l)}var c=(0,o.xhr)(t,(function(e,t){var r=c.response;!e&&r&&(c.responseTime=Date.now(),c.roundTripTime=c.responseTime-c.requestTime,c.bytesReceived=r.byteLength||r.length,c.bandwidth||(c.bandwidth=Math.floor(c.bytesReceived/c.roundTripTime*8*1e3))),e&&"ETIMEDOUT"===e.code&&(c.timedout=!0),e||c.aborted||200===t.statusCode||206===t.statusCode||0===t.statusCode||(e=new Error("XHR Failed with a response of: "+(c&&(r||c.responseText)))),n(e,c)})),f=c.abort;return c.abort=function(){return c.aborted=!0,f.apply(c,arguments)},c.uri=t.uri,c.requestTime=Date.now(),c}};r.default=l,n.exports=r.default}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var d=function(){var e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],n=e[1],r=t[4],o=n[4],i=void 0,d=void 0,l=void 0,c=[],th=[],f=void 0,h=void 0,s=void 0,m=void 0,y=void 0;for(i=0;i<256;i++)th[(c[i]=i<<1^283*(i>>7))^i]=i;for(d=l=0;!r[d];d^=f||1,l=th[l]||1)for(s=(s=l^l<<1^l<<2^l<<3^l<<4)>>8^255&s^99,r[d]=s,o[s]=d,y=16843009*c[h=c[f=c[d]]]^65537*h^257*f^16843008*d,m=257*c[s]^16843008*s,i=0;i<4;i++)t[i][d]=m=m<<24^m>>>8,n[i][s]=y=y<<24^y>>>8;for(i=0;i<5;i++)t[i]=t[i].slice(0),n[i]=n[i].slice(0);return e},l=null,c=function(){function e(t){o(this,e),l||(l=d()),this._tables=[[l[0][0].slice(),l[0][1].slice(),l[0][2].slice(),l[0][3].slice(),l[0][4].slice()],[l[1][0].slice(),l[1][1].slice(),l[1][2].slice(),l[1][3].slice(),l[1][4].slice()]];var i=void 0,n=void 0,r=void 0,c=void 0,f=void 0,h=this._tables[0][4],m=this._tables[1],y=t.length,v=1;if(4!==y&&6!==y&&8!==y)throw new Error("Invalid aes key size");for(c=t.slice(0),f=[],this._key=[c,f],i=y;i<4*y+28;i++)r=c[i-1],(i%y==0||8===y&&i%y==4)&&(r=h[r>>>24]<<24^h[r>>16&255]<<16^h[r>>8&255]<<8^h[255&r],i%y==0&&(r=r<<8^r>>>24^v<<24,v=v<<1^283*(v>>7))),c[i]=c[i-y]^r;for(n=0;i;n++,i--)r=c[3&n?i:i-4],f[n]=i<=4||n<4?r:m[0][h[r>>>24]]^m[1][h[r>>16&255]]^m[2][h[r>>8&255]]^m[3][h[255&r]]}return r(e,[{key:"decrypt",value:function(e,t,n,r,o,d){var l=this._key[1],a=e^l[0],b=r^l[1],c=n^l[2],f=t^l[3],h=void 0,m=void 0,y=void 0,v=l.length/4-2,i=void 0,_=4,table=this._tables[1],T=table[0],S=table[1],w=table[2],k=table[3],O=table[4];for(i=0;i<v;i++)h=T[a>>>24]^S[b>>16&255]^w[c>>8&255]^k[255&f]^l[_],m=T[b>>>24]^S[c>>16&255]^w[f>>8&255]^k[255&a]^l[_+1],y=T[c>>>24]^S[f>>16&255]^w[a>>8&255]^k[255&b]^l[_+2],f=T[f>>>24]^S[a>>16&255]^w[b>>8&255]^k[255&c]^l[_+3],_+=4,a=h,b=m,c=y;for(i=0;i<4;i++)o[(3&-i)+d]=O[a>>>24]<<24^O[b>>16&255]<<16^O[c>>8&255]<<8^O[255&f]^l[_++],h=a,a=b,b=c,c=f,f=h}}]),e}();n.default=c,t.exports=n.default},{}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t,n){for(var r=!0;r;){var object=e,o=t,d=n;r=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,o);if(void 0!==desc){if("value"in desc)return desc.value;var l=desc.get;if(void 0===l)return;return l.call(d)}var c=Object.getPrototypeOf(object);if(null===c)return;e=c,t=o,n=d,r=!0,desc=c=void 0}};function d(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=d(e("./stream")),h=function(e){function t(){l(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,f.default),this.jobs=[],this.delay=1,this.timeout_=null}return c(t,e),r(t,[{key:"processJob_",value:function(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}},{key:"push",value:function(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}]),t}(f.default);n.default=h,t.exports=n.default},{"./stream":26}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=o(e("./aes")),c=o(e("./async-stream")),f=e("pkcs7"),h=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},m=function(e,t,n){var r=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),o=new l.default(Array.prototype.slice.call(t)),d=new Uint8Array(e.byteLength),c=new Int32Array(d.buffer),f=void 0,m=void 0,y=void 0,v=void 0,_=void 0,T=void 0,S=void 0,w=void 0,k=void 0;for(f=n[0],m=n[1],y=n[2],v=n[3],k=0;k<r.length;k+=4)_=h(r[k]),T=h(r[k+1]),S=h(r[k+2]),w=h(r[k+3]),o.decrypt(_,T,S,w,c,k),c[k]=h(c[k]^f),c[k+1]=h(c[k+1]^m),c[k+2]=h(c[k+2]^y),c[k+3]=h(c[k+3]^v),f=_,m=T,y=S,v=w;return d};n.decrypt=m;var y=function(){function e(t,n,r,o){d(this,e);var l=e.STEP,m=new Int32Array(t.buffer),y=new Uint8Array(t.byteLength),i=0;for(this.asyncStream_=new c.default,this.asyncStream_.push(this.decryptChunk_(m.subarray(i,i+l),n,r,y)),i=l;i<m.length;i+=l)r=new Uint32Array([h(m[i-4]),h(m[i-3]),h(m[i-2]),h(m[i-1])]),this.asyncStream_.push(this.decryptChunk_(m.subarray(i,i+l),n,r,y));this.asyncStream_.push((function(){o(null,(0,f.unpad)(y))}))}return r(e,[{key:"decryptChunk_",value:function(e,t,n,r){return function(){var o=m(e,t,n);r.set(o,e.byteOffset)}}}],[{key:"STEP",get:function(){return 32e3}}]),e}();n.Decrypter=y,n.default={Decrypter:y,decrypt:m}},{"./aes":22,"./async-stream":23,pkcs7:28}],25:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./decrypter"),d=r(e("./async-stream"));n.default={decrypt:o.decrypt,Decrypter:o.Decrypter,AsyncStream:d.default},t.exports=n.default},{"./async-stream":23,"./decrypter":24}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var d=function(){function e(){o(this,e),this.listeners={}}return r(e,[{key:"on",value:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"off",value:function(e,t){var n=void 0;return!!this.listeners[e]&&(n=this.listeners[e].indexOf(t),this.listeners[e].splice(n,1),n>-1)}},{key:"trigger",value:function(e){var t=void 0,i=void 0,n=void 0,r=void 0;if(t=this.listeners[e])if(2===arguments.length)for(n=t.length,i=0;i<n;++i)t[i].call(this,arguments[1]);else for(r=Array.prototype.slice.call(arguments,1),n=t.length,i=0;i<n;++i)t[i].apply(this,r)}},{key:"dispose",value:function(){this.listeners={}}},{key:"pipe",value:function(e){this.on("data",(function(data){e.push(data)}))}}]),e}();n.default=d,t.exports=n.default},{}],27:[function(e,t,n){"use strict";var r;t.exports=function(e){var t=r[e.byteLength%16||0],n=new Uint8Array(e.byteLength+t.length);return n.set(e),n.set(t,e.byteLength),n},r=[[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],[15,15,15,15,15,15,15,15,15,15,15,15,15,15,15],[14,14,14,14,14,14,14,14,14,14,14,14,14,14],[13,13,13,13,13,13,13,13,13,13,13,13,13],[12,12,12,12,12,12,12,12,12,12,12,12],[11,11,11,11,11,11,11,11,11,11,11],[10,10,10,10,10,10,10,10,10,10],[9,9,9,9,9,9,9,9,9],[8,8,8,8,8,8,8,8],[7,7,7,7,7,7,7],[6,6,6,6,6,6],[5,5,5,5,5],[4,4,4,4],[3,3,3],[2,2],[1]]},{}],28:[function(e,t,n){"use strict";n.pad=e("./pad.js"),n.unpad=e("./unpad.js")},{"./pad.js":27,"./unpad.js":29}],29:[function(e,t,n){"use strict";t.exports=function(e){return e.subarray(0,e.byteLength-e[e.byteLength-1])}},{}],30:[function(e,t,n){},{}],31:[function(e,n,r){(function(t){var r,o=void 0!==t?t:"undefined"!=typeof window?window:{},d=e("min-document");"undefined"!=typeof document?r=document:(r=o["__GLOBAL_DOCUMENT_CACHE@4"])||(r=o["__GLOBAL_DOCUMENT_CACHE@4"]=d),n.exports=r}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"min-document":30}],32:[function(e,n,r){(function(e){var t;t="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},n.exports=t}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],33:[function(e,t,n){"use strict";var r=l(e("./line-stream")),o=l(e("./parse-stream")),d=l(e("./parser"));function l(e){return e&&e.__esModule?e:{default:e}}t.exports={LineStream:r.default,ParseStream:o.default,Parser:d.default}},{"./line-stream":34,"./parse-stream":35,"./parser":36}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=function(e){function t(){d(this,t);var e=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.buffer="",e}return c(t,e),r(t,[{key:"push",value:function(data){var e=void 0;for(this.buffer+=data,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)}}]),t}(o(e("./stream")).default);n.default=f},{"./stream":37}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,i){var t=[],n=!0,r=!1,o=void 0;try{for(var d,l=e[Symbol.iterator]();!(n=(d=l.next()).done)&&(t.push(d.value),!i||t.length!==i);n=!0);}catch(e){r=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw o}}return t}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=l(e("./stream"));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var m=function(){return new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')},y=function(e){for(var t=e.split(m()),n={},i=t.length,r=void 0;i--;)""!==t[i]&&((r=/([^=]*)=(.*)/.exec(t[i]).slice(1))[0]=r[0].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^['"](.*)['"]$/g,"$1"),n[r[0]]=r[1]);return n},v=function(e){function t(){return c(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return h(t,e),o(t,[{key:"push",value:function(line){var e=void 0,t=void 0;if(0!==(line=line.replace(/^[\u0000\s]+|[\u0000\s]+$/g,"")).length)if("#"===line[0])if(0===line.indexOf("#EXT"))if(line=line.replace("\r",""),e=/^#EXTM3U/.exec(line))this.trigger("data",{type:"tag",tagType:"m3u"});else{if(e=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(line))return t={type:"tag",tagType:"inf"},e[1]&&(t.duration=parseFloat(e[1])),e[2]&&(t.title=e[2]),void this.trigger("data",t);if(e=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(line))return t={type:"tag",tagType:"targetduration"},e[1]&&(t.duration=parseInt(e[1],10)),void this.trigger("data",t);if(e=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(line))return t={type:"tag",tagType:"totalduration"},e[1]&&(t.duration=parseInt(e[1],10)),void this.trigger("data",t);if(e=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(line))return t={type:"tag",tagType:"version"},e[1]&&(t.version=parseInt(e[1],10)),void this.trigger("data",t);if(e=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(line))return t={type:"tag",tagType:"media-sequence"},e[1]&&(t.number=parseInt(e[1],10)),void this.trigger("data",t);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(line))return t={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(t.number=parseInt(e[1],10)),void this.trigger("data",t);if(e=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(line))return t={type:"tag",tagType:"playlist-type"},e[1]&&(t.playlistType=e[1]),void this.trigger("data",t);if(e=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(line))return t={type:"tag",tagType:"byterange"},e[1]&&(t.length=parseInt(e[1],10)),e[2]&&(t.offset=parseInt(e[2],10)),void this.trigger("data",t);if(e=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(line))return t={type:"tag",tagType:"allow-cache"},e[1]&&(t.allowed=!/NO/.test(e[1])),void this.trigger("data",t);if(e=/^#EXT-X-MAP:?(.*)$/.exec(line)){if(t={type:"tag",tagType:"map"},e[1]){var n=y(e[1]);if(n.URI&&(t.uri=n.URI),n.BYTERANGE){var o=n.BYTERANGE.split("@"),d=r(o,2),l=d[0],c=d[1];t.byterange={},l&&(t.byterange.length=parseInt(l,10)),c&&(t.byterange.offset=parseInt(c,10))}}this.trigger("data",t)}else if(e=/^#EXT-X-STREAM-INF:?(.*)$/.exec(line)){if(t={type:"tag",tagType:"stream-inf"},e[1]){if(t.attributes=y(e[1]),t.attributes.RESOLUTION){var f=t.attributes.RESOLUTION.split("x"),h={};f[0]&&(h.width=parseInt(f[0],10)),f[1]&&(h.height=parseInt(f[1],10)),t.attributes.RESOLUTION=h}t.attributes.BANDWIDTH&&(t.attributes.BANDWIDTH=parseInt(t.attributes.BANDWIDTH,10)),t.attributes["PROGRAM-ID"]&&(t.attributes["PROGRAM-ID"]=parseInt(t.attributes["PROGRAM-ID"],10))}this.trigger("data",t)}else{if(e=/^#EXT-X-MEDIA:?(.*)$/.exec(line))return t={type:"tag",tagType:"media"},e[1]&&(t.attributes=y(e[1])),void this.trigger("data",t);if(e=/^#EXT-X-ENDLIST/.exec(line))this.trigger("data",{type:"tag",tagType:"endlist"});else if(e=/^#EXT-X-DISCONTINUITY/.exec(line))this.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(e=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(line))return t={type:"tag",tagType:"program-date-time"},e[1]&&(t.dateTimeString=e[1],t.dateTimeObject=new Date(e[1])),void this.trigger("data",t);if(e=/^#EXT-X-KEY:?(.*)$/.exec(line))return t={type:"tag",tagType:"key"},e[1]&&(t.attributes=y(e[1]),t.attributes.IV&&("0x"===t.attributes.IV.substring(0,2).toLowerCase()&&(t.attributes.IV=t.attributes.IV.substring(2)),t.attributes.IV=t.attributes.IV.match(/.{8}/g),t.attributes.IV[0]=parseInt(t.attributes.IV[0],16),t.attributes.IV[1]=parseInt(t.attributes.IV[1],16),t.attributes.IV[2]=parseInt(t.attributes.IV[2],16),t.attributes.IV[3]=parseInt(t.attributes.IV[3],16),t.attributes.IV=new Uint32Array(t.attributes.IV))),void this.trigger("data",t);if(e=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(line))return t={type:"tag",tagType:"cue-out-cont"},e[1]?t.data=e[1]:t.data="",void this.trigger("data",t);if(e=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(line))return t={type:"tag",tagType:"cue-out"},e[1]?t.data=e[1]:t.data="",void this.trigger("data",t);if(e=/^#EXT-X-CUE-IN:?(.*)?$/.exec(line))return t={type:"tag",tagType:"cue-in"},e[1]?t.data=e[1]:t.data="",void this.trigger("data",t);this.trigger("data",{type:"tag",data:line.slice(4)})}}}else this.trigger("data",{type:"comment",text:line.slice(1)});else this.trigger("data",{type:"uri",uri:line})}}]),t}(d.default);n.default=v},{"./stream":37}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var t in source)Object.prototype.hasOwnProperty.call(source,t)&&(e[t]=source[t])}return e},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=f(e("./stream")),l=f(e("./line-stream")),c=f(e("./parse-stream"));function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var v=function(e){function t(){h(this,t);var e=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.lineStream=new l.default,e.parseStream=new c.default,e.lineStream.pipe(e.parseStream);var n=e,o=[],d={},f=void 0,y=void 0,v=function(){},_={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},T=0;return e.manifest={allowCache:!0,discontinuityStarts:[],segments:[]},e.parseStream.on("data",(function(e){var t=void 0,l=void 0;({tag:function(){({"allow-cache":function(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var t={};"length"in e&&(d.byterange=t,t.length=e.length,"offset"in e||(this.trigger("info",{message:"defaulting offset to zero"}),e.offset=0)),"offset"in e&&(d.byterange=t,t.offset=e.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),e.duration>0&&(d.duration=e.duration),0===e.duration&&(d.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=o},key:function(){e.attributes?"NONE"!==e.attributes.METHOD?e.attributes.URI?(e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),y={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},void 0!==e.attributes.IV&&(y.iv=e.attributes.IV)):this.trigger("warn",{message:"ignoring key declaration without URI"}):y=null:this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence":function(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,T=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type":function(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map:function(){f={},e.uri&&(f.uri=e.uri),e.byterange&&(f.byterange=e.byterange)},"stream-inf":function(){this.manifest.playlists=o,this.manifest.mediaGroups=this.manifest.mediaGroups||_,e.attributes?(d.attributes||(d.attributes={}),r(d.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||_,e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME){var n=this.manifest.mediaGroups[e.attributes.TYPE];n[e.attributes["GROUP-ID"]]=n[e.attributes["GROUP-ID"]]||{},t=n[e.attributes["GROUP-ID"]],(l={default:/yes/i.test(e.attributes.DEFAULT)}).default?l.autoselect=!0:l.autoselect=/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(l.language=e.attributes.LANGUAGE),e.attributes.URI&&(l.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(l.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(l.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(l.forced=/yes/i.test(e.attributes.FORCED)),t[e.attributes.NAME]=l}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){T+=1,d.discontinuity=!0,this.manifest.discontinuityStarts.push(o.length)},"program-date-time":function(){this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject},targetduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):this.manifest.targetDuration=e.duration},totalduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid total duration: "+e.duration}):this.manifest.totalDuration=e.duration},"cue-out":function(){d.cueOut=e.data},"cue-out-cont":function(){d.cueOutCont=e.data},"cue-in":function(){d.cueIn=e.data}}[e.tagType]||v).call(n)},uri:function(){d.uri=e.uri,o.push(d),this.manifest.targetDuration&&!("duration"in d)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),d.duration=this.manifest.targetDuration),y&&(d.key=y),d.timeline=T,f&&(d.map=f),d={}},comment:function(){}})[e.type].call(n)})),e}return y(t,e),o(t,[{key:"push",value:function(e){this.lineStream.push(e)}},{key:"end",value:function(){this.lineStream.push("\n")}}]),t}(d.default);n.default=v},{"./line-stream":34,"./parse-stream":35,"./stream":37}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var d=function(){function e(){o(this,e),this.listeners={}}return r(e,[{key:"on",value:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"off",value:function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e].splice(n,1),n>-1}},{key:"trigger",value:function(e){var t=this.listeners[e],i=void 0,n=void 0,r=void 0;if(t)if(2===arguments.length)for(n=t.length,i=0;i<n;++i)t[i].call(this,arguments[1]);else for(r=Array.prototype.slice.call(arguments,1),n=t.length,i=0;i<n;++i)t[i].apply(this,r)}},{key:"dispose",value:function(){this.listeners={}}},{key:"pipe",value:function(e){this.on("data",(function(data){e.push(data)}))}}]),e}();n.default=d},{}],38:[function(e,t,n){"use strict";var r,o=e("../utils/stream.js");(r=function(){var e=new Uint8Array,t=0;r.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.parseId3TagSize=function(header,e){var t=header[e+6]<<21|header[e+7]<<14|header[e+8]<<7|header[e+9];return(16&header[e+5])>>4?t+20:t+10},this.parseAdtsSize=function(header,e){var t=(224&header[e+5])>>5,n=header[e+4]<<3;return 6144&header[e+3]|n|t},this.push=function(n){var r,o,d,l,c=0,f=0;for(e.length?(l=e.length,(e=new Uint8Array(n.byteLength+l)).set(e.subarray(0,l)),e.set(n,l)):e=n;e.length-f>=3;)if(e[f]!=="I".charCodeAt(0)||e[f+1]!=="D".charCodeAt(0)||e[f+2]!=="3".charCodeAt(0))if(!0&e[f]&&240==(240&e[f+1])){if(e.length-f<7)break;if((c=this.parseAdtsSize(e,f))>e.length)break;d={type:"audio",data:e.subarray(f,f+c),pts:t,dts:t},this.trigger("data",d),f+=c}else f++;else{if(e.length-f<10)break;if((c=this.parseId3TagSize(e,f))>e.length)break;o={type:"timed-metadata",data:e.subarray(f,f+c)},this.trigger("data",o),f+=c}r=e.length-f,e=r>0?e.subarray(f):new Uint8Array}}).prototype=new o,t.exports=r},{"../utils/stream.js":62}],39:[function(e,t,n){"use strict";var r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],o=function(data){return data[0]<<21|data[1]<<14|data[2]<<7|data[3]},d=function(e,t,n){var i,r="";for(i=t;i<n;i++)r+="%"+("00"+e[i].toString(16)).slice(-2);return r},l=function(e,t,n){return unescape(d(e,t,n))},c=function(header,e){var t=header[e+6]<<21|header[e+7]<<14|header[e+8]<<7|header[e+9];return(16&header[e+5])>>4?t+20:t+10},f=function(header,e){var t=(224&header[e+5])>>5,n=header[e+4]<<3;return 6144&header[e+3]|n|t},h=function(header,e){return header[e]==="I".charCodeAt(0)&&header[e+1]==="D".charCodeAt(0)&&header[e+2]==="3".charCodeAt(0)?"timed-metadata":!0&header[e]&&240==(240&header[e+1])?"audio":null},m=function(e){for(var i=0;i+5<e.length;){if(255===e[i]&&240==(246&e[i+1]))return r[(60&e[i+2])>>>2];i++}return null},y=function(e){var t,n,r;t=10,64&e[5]&&(t+=4,t+=o(e.subarray(10,14)));do{if((n=o(e.subarray(t+4,t+8)))<1)return null;if("PRIV"===String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3])){r=e.subarray(t+10,t+n+10);for(var i=0;i<r.byteLength;i++)if(0===r[i]){if("com.apple.streaming.transportStreamTimestamp"===l(r,0,i)){var d=r.subarray(i+1),c=(1&d[3])<<30|d[4]<<22|d[5]<<14|d[6]<<6|d[7]>>>2;return c*=4,c+=3&d[7]}break}}t+=10,t+=n}while(t<e.byteLength);return null};t.exports={parseId3TagSize:c,parseAdtsSize:f,parseType:h,parseSampleRate:m,parseAacTimestamp:y}},{}],40:[function(e,t,n){"use strict";var r,o=e("../utils/stream.js"),d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(r=function(){var e;r.prototype.init.call(this),this.push=function(t){var n,r,o,l,c,f,i=0,h=0;if("audio"===t.type)for(e?(l=e,(e=new Uint8Array(l.byteLength+t.data.byteLength)).set(l),e.set(t.data,l.byteLength)):e=t.data;i+5<e.length;)if(255===e[i]&&240==(246&e[i+1])){if(r=2*(1&~e[i+1]),n=(3&e[i+3])<<11|e[i+4]<<3|(224&e[i+5])>>5,f=9e4*(c=1024*(1+(3&e[i+6])))/d[(60&e[i+2])>>>2],o=i+n,e.byteLength<o)return;if(this.trigger("data",{pts:t.pts+h*f,dts:t.dts+h*f,sampleCount:c,audioobjecttype:1+(e[i+2]>>>6&3),channelcount:(1&e[i+2])<<2|(192&e[i+3])>>>6,samplerate:d[(60&e[i+2])>>>2],samplingfrequencyindex:(60&e[i+2])>>>2,samplesize:16,data:e.subarray(i+7+r,o)}),e.byteLength===o)return void(e=void 0);h++,e=e.subarray(o)}else i++},this.flush=function(){this.trigger("done")}}).prototype=new o,t.exports=r},{"../utils/stream.js":62}],41:[function(e,t,n){"use strict";var r,o,d,l=e("../utils/stream.js"),c=e("../utils/exp-golomb.js");(o=function(){var i,e,t=0;o.prototype.init.call(this),this.push=function(data){var n;for(e?((n=new Uint8Array(e.byteLength+data.data.byteLength)).set(e),n.set(data.data,e.byteLength),e=n):e=data.data;t<e.byteLength-3;t++)if(1===e[t+2]){i=t+5;break}for(;i<e.byteLength;)switch(e[i]){case 0:if(0!==e[i-1]){i+=2;break}if(0!==e[i-2]){i++;break}t+3!==i-2&&this.trigger("data",e.subarray(t+3,i-2));do{i++}while(1!==e[i]&&i<e.length);t=i-2,i+=3;break;case 1:if(0!==e[i-1]||0!==e[i-2]){i+=3;break}this.trigger("data",e.subarray(t+3,i-2)),t=i-2,i+=3;break;default:i+=3}e=e.subarray(t),i-=t,t=0},this.flush=function(){e&&e.byteLength>3&&this.trigger("data",e.subarray(t+3)),e=null,t=0,this.trigger("done")}}).prototype=new l,d={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(r=function(){var e,t,n,l,f,h,m,y=new o;r.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,n=e.pts,l=e.dts,y.push(e))},y.on("data",(function(data){var r={trackId:t,pts:n,dts:l,data:data};switch(31&data[0]){case 5:r.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:r.nalUnitType="sei_rbsp",r.escapedRBSP=f(data.subarray(1));break;case 7:r.nalUnitType="seq_parameter_set_rbsp",r.escapedRBSP=f(data.subarray(1)),r.config=h(r.escapedRBSP);break;case 8:r.nalUnitType="pic_parameter_set_rbsp";break;case 9:r.nalUnitType="access_unit_delimiter_rbsp"}e.trigger("data",r)})),y.on("done",(function(){e.trigger("done")})),this.flush=function(){y.flush()},m=function(e,t){var n,r=8,o=8;for(n=0;n<e;n++)0!==o&&(o=(r+t.readExpGolomb()+256)%256),r=0===o?r:o},f=function(data){for(var e,t,n=data.byteLength,r=[],i=1;i<n-2;)0===data[i]&&0===data[i+1]&&3===data[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return data;e=n-r.length,t=new Uint8Array(e);var o=0;for(i=0;i<e;o++,i++)o===r[0]&&(o++,r.shift()),t[i]=data[o];return t},h=function(data){var e,t,n,r,o,l,f,h,y,v,_,T,i,S=0,w=0,k=0,O=0,E=1;if(t=(e=new c(data)).readUnsignedByte(),r=e.readUnsignedByte(),n=e.readUnsignedByte(),e.skipUnsignedExpGolomb(),d[t]&&(3===(o=e.readUnsignedExpGolomb())&&e.skipBits(1),e.skipUnsignedExpGolomb(),e.skipUnsignedExpGolomb(),e.skipBits(1),e.readBoolean()))for(_=3!==o?8:12,i=0;i<_;i++)e.readBoolean()&&m(i<6?16:64,e);if(e.skipUnsignedExpGolomb(),0===(l=e.readUnsignedExpGolomb()))e.readUnsignedExpGolomb();else if(1===l)for(e.skipBits(1),e.skipExpGolomb(),e.skipExpGolomb(),f=e.readUnsignedExpGolomb(),i=0;i<f;i++)e.skipExpGolomb();if(e.skipUnsignedExpGolomb(),e.skipBits(1),h=e.readUnsignedExpGolomb(),y=e.readUnsignedExpGolomb(),0===(v=e.readBits(1))&&e.skipBits(1),e.skipBits(1),e.readBoolean()&&(S=e.readUnsignedExpGolomb(),w=e.readUnsignedExpGolomb(),k=e.readUnsignedExpGolomb(),O=e.readUnsignedExpGolomb()),e.readBoolean()&&e.readBoolean()){switch(e.readUnsignedByte()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[e.readUnsignedByte()<<8|e.readUnsignedByte(),e.readUnsignedByte()<<8|e.readUnsignedByte()]}T&&(E=T[0]/T[1])}return{profileIdc:t,levelIdc:n,profileCompatibility:r,width:Math.ceil((16*(h+1)-2*S-2*w)*E),height:(2-v)*(y+1)*16-2*k-2*O}}}).prototype=new l,t.exports={H264Stream:r,NalByteStream:o}},{"../utils/exp-golomb.js":61,"../utils/stream.js":62}],42:[function(e,t,n){var r=[33,16,5,32,164,27],o=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],d=function(e){for(var a=[];e--;)a.push(0);return a},l=function(e){return Object.keys(e).reduce((function(t,n){return t[n]=new Uint8Array(e[n].reduce((function(e,t){return e.concat(t)}),[])),t}),{})},c={96e3:[r,[227,64],d(154),[56]],88200:[r,[231],d(170),[56]],64e3:[r,[248,192],d(240),[56]],48e3:[r,[255,192],d(268),[55,148,128],d(54),[112]],44100:[r,[255,192],d(268),[55,163,128],d(84),[112]],32e3:[r,[255,192],d(268),[55,234],d(226),[112]],24e3:[r,[255,192],d(268),[55,255,128],d(268),[111,112],d(126),[224]],16e3:[r,[255,192],d(268),[55,255,128],d(268),[111,255],d(269),[223,108],d(195),[1,192]],12e3:[o,d(268),[3,127,248],d(268),[6,255,240],d(268),[13,255,224],d(268),[27,253,128],d(259),[56]],11025:[o,d(268),[3,127,248],d(268),[6,255,240],d(268),[13,255,224],d(268),[27,255,192],d(268),[55,175,128],d(108),[112]],8e3:[o,d(268),[3,121,16],d(47),[7]]};t.exports=l(c)},{}],43:[function(e,t,n){"use strict";var r=e("../utils/stream.js"),o=function(e){this.numberOfTracks=0,this.metadataStream=e.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,o.prototype.init.call(this),this.push=function(output){return output.text?this.pendingCaptions.push(output):output.frames?this.pendingMetadata.push(output):("video"===output.track.type&&(this.videoTrack=output.track,this.videoTags=output.tags,this.pendingTracks++),void("audio"===output.track.type&&(this.audioTrack=output.track,this.audioTags=output.tags,this.pendingTracks++)))}};o.prototype=new r,o.prototype.flush=function(e){var t,caption,i,n,r={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(0===this.pendingTracks&&(this.processedTracks++,this.processedTracks<this.numberOfTracks))return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?n=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(n=this.audioTrack.timelineStartInfo.pts),r.tags.videoTags=this.videoTags,r.tags.audioTags=this.audioTags,i=0;i<this.pendingCaptions.length;i++)(caption=this.pendingCaptions[i]).startTime=caption.startPts-n,caption.startTime/=9e4,caption.endTime=caption.endPts-n,caption.endTime/=9e4,r.captionStreams[caption.stream]=!0,r.captions.push(caption);for(i=0;i<this.pendingMetadata.length;i++)(t=this.pendingMetadata[i]).cueTime=t.pts-n,t.cueTime/=9e4,r.metadata.push(t);r.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",r),this.trigger("done")}},t.exports=o},{"../utils/stream.js":62}],44:[function(e,t,n){"use strict";var r=e("./flv-tag.js"),o=function(e,audio,video){var t,n,o,d=new Uint8Array(9),head=new DataView(d.buffer);return e=e||0,audio=void 0===audio||audio,video=void 0===video||video,head.setUint8(0,70),head.setUint8(1,76),head.setUint8(2,86),head.setUint8(3,1),head.setUint8(4,(audio?4:0)|(video?1:0)),head.setUint32(5,d.byteLength),e<=0?((n=new Uint8Array(d.byteLength+4)).set(d),n.set([0,0,0,0],d.byteLength),n):((t=new r(r.METADATA_TAG)).pts=t.dts=0,t.writeMetaDataDouble("duration",e),o=t.finalize().length,(n=new Uint8Array(d.byteLength+o)).set(d),n.set(head.byteLength,o),n)};t.exports=o},{"./flv-tag.js":45}],45:[function(e,t,n){"use strict";var r;(r=function(e,t){var i,n=0,o=16384,d=function(e,t){var n,r=e.position+t;r<e.bytes.byteLength||((n=new Uint8Array(2*r)).set(e.bytes.subarray(0,e.position),0),e.bytes=n,e.view=new DataView(e.bytes.buffer))},l=r.widthBytes||new Uint8Array("width".length),c=r.heightBytes||new Uint8Array("height".length),f=r.videocodecidBytes||new Uint8Array("videocodecid".length);if(!r.widthBytes){for(i=0;i<"width".length;i++)l[i]="width".charCodeAt(i);for(i=0;i<"height".length;i++)c[i]="height".charCodeAt(i);for(i=0;i<"videocodecid".length;i++)f[i]="videocodecid".charCodeAt(i);r.widthBytes=l,r.heightBytes=c,r.videocodecidBytes=f}switch(this.keyFrame=!1,e){case r.VIDEO_TAG:this.length=16,o*=6;break;case r.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case r.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(o),this.view=new DataView(this.bytes.buffer),this.bytes[0]=e,this.position=this.length,this.keyFrame=t,this.pts=0,this.dts=0,this.writeBytes=function(e,t,n){var r,o=t||0;r=o+(n=n||e.byteLength),d(this,n),this.bytes.set(e.subarray(o,r),this.position),this.position+=n,this.length=Math.max(this.length,this.position)},this.writeByte=function(e){d(this,1),this.bytes[this.position]=e,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(e){d(this,2),this.view.setUint16(this.position,e),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(e){return this.bytes[this.length-e]},this.nalUnitSize=function(){return 0===n?0:this.length-(n+4)},this.startNalUnit=function(){if(n>0)throw new Error("Attempted to create new NAL wihout closing the old one");n=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(e){var t,r;this.length===n+4?this.length-=4:n>0&&(t=n+4,r=this.length-t,this.position=n,this.view.setUint32(this.position,r),this.position=this.length,e&&e.push(this.bytes.subarray(t,t+r))),n=0},this.writeMetaDataDouble=function(e,t){var i;if(d(this,2+e.length+9),this.view.setUint16(this.position,e.length),this.position+=2,"width"===e)this.bytes.set(l,this.position),this.position+=5;else if("height"===e)this.bytes.set(c,this.position),this.position+=6;else if("videocodecid"===e)this.bytes.set(f,this.position),this.position+=12;else for(i=0;i<e.length;i++)this.bytes[this.position]=e.charCodeAt(i),this.position++;this.position++,this.view.setFloat64(this.position,t),this.position+=8,this.length=Math.max(this.length,this.position),++n},this.writeMetaDataBoolean=function(e,t){var i;for(d(this,2),this.view.setUint16(this.position,e.length),this.position+=2,i=0;i<e.length;i++)d(this,1),this.bytes[this.position]=e.charCodeAt(i),this.position++;d(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,t?1:0),this.position++,this.length=Math.max(this.length,this.position),++n},this.finalize=function(){var e,o;switch(this.bytes[0]){case r.VIDEO_TAG:this.bytes[11]=7|(this.keyFrame||t?16:32),this.bytes[12]=t?0:1,e=this.pts-this.dts,this.bytes[13]=(16711680&e)>>>16,this.bytes[14]=(65280&e)>>>8,this.bytes[15]=(255&e)>>>0;break;case r.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=t?0:1;break;case r.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,n),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position}return o=this.length-11,this.bytes[1]=(16711680&o)>>>16,this.bytes[2]=(65280&o)>>>8,this.bytes[3]=(255&o)>>>0,this.bytes[4]=(16711680&this.dts)>>>16,this.bytes[5]=(65280&this.dts)>>>8,this.bytes[6]=(255&this.dts)>>>0,this.bytes[7]=(4278190080&this.dts)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,d(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=r.frameTime(this.bytes),this}}).AUDIO_TAG=8,r.VIDEO_TAG=9,r.METADATA_TAG=18,r.isAudioFrame=function(e){return r.AUDIO_TAG===e[0]},r.isVideoFrame=function(e){return r.VIDEO_TAG===e[0]},r.isMetaData=function(e){return r.METADATA_TAG===e[0]},r.isKeyFrame=function(e){return r.isVideoFrame(e)?23===e[11]:!!r.isAudioFrame(e)||!!r.isMetaData(e)},r.frameTime=function(e){var t=e[4]<<16;return t|=e[5]<<8,t|=e[6]<<0,t|=e[7]<<24},t.exports=r},{}],46:[function(e,t,n){t.exports={tag:e("./flv-tag"),Transmuxer:e("./transmuxer"),getFlvHeader:e("./flv-header")}},{"./flv-header":44,"./flv-tag":45,"./transmuxer":48}],47:[function(e,t,n){"use strict";var r=function(){var e=this;this.list=[],this.push=function(e){this.list.push({bytes:e.bytes,dts:e.dts,pts:e.pts,keyFrame:e.keyFrame,metaDataTag:e.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return e.list.length}})};t.exports=r},{}],48:[function(e,t,n){"use strict";var r,o,d,l,c,f,h=e("../utils/stream.js"),m=e("./flv-tag.js"),y=e("../m2ts/m2ts.js"),v=e("../codecs/adts.js"),_=e("../codecs/h264").H264Stream,T=e("./coalesce-stream.js"),S=e("./tag-list.js");l=function(track,data){"number"==typeof data.pts&&(void 0===track.timelineStartInfo.pts?track.timelineStartInfo.pts=data.pts:track.timelineStartInfo.pts=Math.min(track.timelineStartInfo.pts,data.pts)),"number"==typeof data.dts&&(void 0===track.timelineStartInfo.dts?track.timelineStartInfo.dts=data.dts:track.timelineStartInfo.dts=Math.min(track.timelineStartInfo.dts,data.dts))},c=function(track,e){var t=new m(m.METADATA_TAG);return t.dts=e,t.pts=e,t.writeMetaDataDouble("videocodecid",7),t.writeMetaDataDouble("width",track.width),t.writeMetaDataDouble("height",track.height),t},f=function(track,e){var i,t=new m(m.VIDEO_TAG,!0);for(t.dts=e,t.pts=e,t.writeByte(1),t.writeByte(track.profileIdc),t.writeByte(track.profileCompatibility),t.writeByte(track.levelIdc),t.writeByte(255),t.writeByte(225),t.writeShort(track.sps[0].length),t.writeBytes(track.sps[0]),t.writeByte(track.pps.length),i=0;i<track.pps.length;++i)t.writeShort(track.pps[i].length),t.writeBytes(track.pps[i]);return t},(d=function(track){var e,t=[],n=[];d.prototype.init.call(this),this.push=function(data){l(track,data),track&&(track.audioobjecttype=data.audioobjecttype,track.channelcount=data.channelcount,track.samplerate=data.samplerate,track.samplingfrequencyindex=data.samplingfrequencyindex,track.samplesize=data.samplesize,track.extraData=track.audioobjecttype<<11|track.samplingfrequencyindex<<7|track.channelcount<<3),data.pts=Math.round(data.pts/90),data.dts=Math.round(data.dts/90),t.push(data)},this.flush=function(){var r,o,d,l=new S;if(0!==t.length){for(d=-1/0;t.length;)r=t.shift(),n.length&&r.pts>=n[0]&&(d=n.shift(),this.writeMetaDataTags(l,d)),(track.extraData!==e||r.pts-d>=1e3)&&(this.writeMetaDataTags(l,r.pts),e=track.extraData,d=r.pts),(o=new m(m.AUDIO_TAG)).pts=r.pts,o.dts=r.dts,o.writeBytes(r.data),l.push(o.finalize());n.length=0,e=null,this.trigger("data",{track:track,tags:l.list}),this.trigger("done","AudioSegmentStream")}else this.trigger("done","AudioSegmentStream")},this.writeMetaDataTags=function(e,t){var n;(n=new m(m.METADATA_TAG)).pts=t,n.dts=t,n.writeMetaDataDouble("audiocodecid",10),n.writeMetaDataBoolean("stereo",2===track.channelcount),n.writeMetaDataDouble("audiosamplerate",track.samplerate),n.writeMetaDataDouble("audiosamplesize",16),e.push(n.finalize()),(n=new m(m.AUDIO_TAG,!0)).pts=t,n.dts=t,n.view.setUint16(n.position,track.extraData),n.position+=2,n.length=Math.max(n.length,n.position),e.push(n.finalize())},this.onVideoKeyFrame=function(e){n.push(e)}}).prototype=new h,(o=function(track){var e,t,n=[];o.prototype.init.call(this),this.finishFrame=function(n,r){if(r){if(e&&track&&track.newMetadata&&(r.keyFrame||0===n.length)){var o=c(e,r.dts).finalize(),d=f(track,r.dts).finalize();o.metaDataTag=d.metaDataTag=!0,n.push(o),n.push(d),track.newMetadata=!1,this.trigger("keyframe",r.dts)}r.endNalUnit(),n.push(r.finalize()),t=null}},this.push=function(data){l(track,data),data.pts=Math.round(data.pts/90),data.dts=Math.round(data.dts/90),n.push(data)},this.flush=function(){for(var r,o=new S;n.length&&"access_unit_delimiter_rbsp"!==n[0].nalUnitType;)n.shift();if(0!==n.length){for(;n.length;)"seq_parameter_set_rbsp"===(r=n.shift()).nalUnitType?(track.newMetadata=!0,e=r.config,track.width=e.width,track.height=e.height,track.sps=[r.data],track.profileIdc=e.profileIdc,track.levelIdc=e.levelIdc,track.profileCompatibility=e.profileCompatibility,t.endNalUnit()):"pic_parameter_set_rbsp"===r.nalUnitType?(track.newMetadata=!0,track.pps=[r.data],t.endNalUnit()):"access_unit_delimiter_rbsp"===r.nalUnitType?(t&&this.finishFrame(o,t),(t=new m(m.VIDEO_TAG)).pts=r.pts,t.dts=r.dts):("slice_layer_without_partitioning_rbsp_idr"===r.nalUnitType&&(t.keyFrame=!0),t.endNalUnit()),t.startNalUnit(),t.writeBytes(r.data);t&&this.finishFrame(o,t),this.trigger("data",{track:track,tags:o.list}),this.trigger("done","VideoSegmentStream")}else this.trigger("done","VideoSegmentStream")}}).prototype=new h,(r=function(e){var t,n,l,c,f,h,m,S,w,k,O,E,A=this;r.prototype.init.call(this),e=e||{},this.metadataStream=new y.MetadataStream,e.metadataStream=this.metadataStream,t=new y.TransportPacketStream,n=new y.TransportParseStream,l=new y.ElementaryStream,c=new y.TimestampRolloverStream("video"),f=new y.TimestampRolloverStream("audio"),h=new y.TimestampRolloverStream("timed-metadata"),m=new v,S=new _,E=new T(e),t.pipe(n).pipe(l),l.pipe(c).pipe(S),l.pipe(f).pipe(m),l.pipe(h).pipe(this.metadataStream).pipe(E),O=new y.CaptionStream,S.pipe(O).pipe(E),l.on("data",(function(data){var i,e,t;if("metadata"===data.type){for(i=data.tracks.length;i--;)"video"===data.tracks[i].type?e=data.tracks[i]:"audio"===data.tracks[i].type&&(t=data.tracks[i]);e&&!w&&(E.numberOfTracks++,w=new o(e),S.pipe(w).pipe(E)),t&&!k&&(E.numberOfTracks++,k=new d(t),m.pipe(k).pipe(E),w&&w.on("keyframe",k.onVideoKeyFrame))}})),this.push=function(data){t.push(data)},this.flush=function(){t.flush()},this.resetCaptions=function(){O.reset()},E.on("data",(function(e){A.trigger("data",e)})),E.on("done",(function(){A.trigger("done")}))}).prototype=new h,t.exports=r},{"../codecs/adts.js":40,"../codecs/h264":41,"../m2ts/m2ts.js":50,"../utils/stream.js":62,"./coalesce-stream.js":43,"./flv-tag.js":45,"./tag-list.js":47}],49:[function(e,t,n){"use strict";var r=4,o=128,d=e("../utils/stream"),l=function(e){for(var i=0,t={payloadType:-1,payloadSize:0},n=0,d=0;i<e.byteLength&&e[i]!==o;){for(;255===e[i];)n+=255,i++;for(n+=e[i++];255===e[i];)d+=255,i++;if(d+=e[i++],!t.payload&&n===r){t.payloadType=n,t.payloadSize=d,t.payload=e.subarray(i,i+d);break}i+=d,n=0,d=0}return t},c=function(e){return 181!==e.payload[0]||49!=(e.payload[1]<<8|e.payload[2])||"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])||3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)},f=function(e,t){var i,n,r,data,o=[];if(!(64&t[0]))return o;for(n=31&t[0],i=0;i<n;i++)data={type:3&t[2+(r=3*i)],pts:e},4&t[r+2]&&(data.ccData=t[r+3]<<8|t[r+4],o.push(data));return o},h=function(){h.prototype.init.call(this),this.captionPackets_=[],this.ccStreams_=[new S(0,0),new S(0,1),new S(1,0),new S(1,1)],this.reset(),this.ccStreams_.forEach((function(e){e.on("data",this.trigger.bind(this,"data")),e.on("done",this.trigger.bind(this,"done"))}),this)};h.prototype=new d,h.prototype.push=function(e){var t,n;"sei_rbsp"===e.nalUnitType&&(t=l(e.escapedRBSP)).payloadType===r&&(n=c(t))&&(e.dts<this.latestDts_?this.ignoreNextEqualDts_=!0:e.dts===this.latestDts_&&this.ignoreNextEqualDts_?this.ignoreNextEqualDts_=!1:(this.captionPackets_=this.captionPackets_.concat(f(e.pts,n)),this.latestDts_=e.dts))},h.prototype.flush=function(){this.captionPackets_.length?(this.captionPackets_.forEach((function(e,t){e.presortIndex=t})),this.captionPackets_.sort((function(a,b){return a.pts===b.pts?a.presortIndex-b.presortIndex:a.pts-b.pts})),this.captionPackets_.forEach((function(e){e.type<2&&this.dispatchCea608Packet(e)}),this),this.captionPackets_.length=0,this.ccStreams_.forEach((function(e){e.flush()}),this)):this.ccStreams_.forEach((function(e){e.flush()}),this)},h.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach((function(e){e.reset()}))},h.prototype.dispatchCea608Packet=function(e){this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},h.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},h.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)};var m={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},y=function(code){return null===code?"":(code=m[code]||code,String.fromCharCode(code))},v=14,_=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],T=function(){for(var e=[],i=v+1;i--;)e.push("");return e},S=function(e,t){S.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var data,t,n,r,text;if((data=32639&e.ccData)!==this.lastControlCode_){if(4096==(61440&data)?this.lastControlCode_=data:data!==this.PADDING_&&(this.lastControlCode_=null),n=data>>>8,r=255&data,data!==this.PADDING_)if(data===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(data===this.END_OF_CAPTION_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),t=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=t,this.startPts_=e.pts;else if(data===this.ROLL_UP_2_ROWS_)this.topRow_=v-1,this.mode_="rollUp";else if(data===this.ROLL_UP_3_ROWS_)this.topRow_=v-2,this.mode_="rollUp";else if(data===this.ROLL_UP_4_ROWS_)this.topRow_=v-3,this.mode_="rollUp";else if(data===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(data===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[v]=this.nonDisplayed_[v].slice(0,-1):this.displayed_[v]=this.displayed_[v].slice(0,-1);else if(data===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=T();else if(data===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=T();else if(data===this.RESUME_DIRECT_CAPTIONING_)this.mode_="paintOn";else if(this.isSpecialCharacter(n,r))text=y((n=(3&n)<<8)|r),this[this.mode_](e.pts,text),this.column_++;else if(this.isExtCharacter(n,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[v]=this.displayed_[v].slice(0,-1),text=y((n=(3&n)<<8)|r),this[this.mode_](e.pts,text),this.column_++;else if(this.isMidRowCode(n,r))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14==(14&r)&&this.addFormatting(e.pts,["i"]),1==(1&r)&&this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(n,r))this.column_+=3&r;else if(this.isPAC(n,r)){var o=_.indexOf(7968&data);o!==this.row_&&(this.clearFormatting(e.pts),this.row_=o),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16==(16&data)&&(this.column_=4*((14&data)>>1)),this.isColorPAC(r)&&14==(14&r)&&this.addFormatting(e.pts,["i"])}else this.isNormalChar(n)&&(0===r&&(r=null),text=y(n),text+=y(r),this[this.mode_](e.pts,text),this.column_+=text.length)}else this.lastControlCode_=null}};S.prototype=new d,S.prototype.flushDisplayed=function(e){var content=this.displayed_.map((function(e){return e.trim()})).join("\n").replace(/^\n+|\n+$/g,"");content.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,text:content,stream:this.name_})},S.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=T(),this.nonDisplayed_=T(),this.lastControlCode_=null,this.column_=0,this.row_=v,this.formatting_=[]},S.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},S.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},S.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},S.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},S.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},S.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},S.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},S.prototype.isNormalChar=function(e){return e>=32&&e<=127},S.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var text=t.reduce((function(text,e){return text+"<"+e+">"}),"");this[this.mode_](e,text)},S.prototype.clearFormatting=function(e){if(this.formatting_.length){var text=this.formatting_.reverse().reduce((function(text,e){return text+"</"+e+">"}),"");this.formatting_=[],this[this.mode_](e,text)}},S.prototype.popOn=function(e,text){var t=this.nonDisplayed_[this.row_];t+=text,this.nonDisplayed_[this.row_]=t},S.prototype.rollUp=function(e,text){var t=this.displayed_[v];t+=text,this.displayed_[v]=t},S.prototype.shiftRowsUp_=function(){var i;for(i=0;i<this.topRow_;i++)this.displayed_[i]="";for(i=this.topRow_;i<v;i++)this.displayed_[i]=this.displayed_[i+1];this.displayed_[v]=""},S.prototype.paintOn=function(){},t.exports={CaptionStream:h,Cea608Stream:S}},{"../utils/stream":62}],50:[function(e,t,n){"use strict";var r,o,d,l=e("../utils/stream.js"),c=e("./caption-stream"),f=e("./stream-types"),h=e("./timestamp-rollover-stream").TimestampRolloverStream,m=e("./stream-types.js"),y=188,v=71;(r=function(){var e=new Uint8Array(y),t=0;r.prototype.init.call(this),this.push=function(n){var r,o=0,d=y;for(t?((r=new Uint8Array(n.byteLength+t)).set(e.subarray(0,t)),r.set(n,t),t=0):r=n;d<r.byteLength;)r[o]!==v||r[d]!==v?(o++,d++):(this.trigger("data",r.subarray(o,d)),o+=y,d+=y);o<r.byteLength&&(e.set(r.subarray(o),0),t=r.byteLength-o)},this.flush=function(){t===y&&e[0]===v&&(this.trigger("data",e),t=0),this.trigger("done")}}).prototype=new l,(o=function(){var e,t,n,r;o.prototype.init.call(this),r=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,r){var o=0;r.payloadUnitStartIndicator&&(o+=e[o]+1),"pat"===r.type?t(e.subarray(o),r):n(e.subarray(o),r)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],r.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=r.pmtPid},n=function(e,t){var n,o;if(1&e[5]){for(r.programMapTable={video:null,audio:null,"timed-metadata":{}},n=3+((15&e[1])<<8|e[2])-4,o=12+((15&e[10])<<8|e[11]);o<n;){var d=e[o],l=(31&e[o+1])<<8|e[o+2];d===f.H264_STREAM_TYPE&&null===r.programMapTable.video?r.programMapTable.video=l:d===f.ADTS_STREAM_TYPE&&null===r.programMapTable.audio?r.programMapTable.audio=l:d===f.METADATA_STREAM_TYPE&&(r.programMapTable["timed-metadata"][l]=d),o+=5+((15&e[o+3])<<8|e[o+4])}t.programMapTable=r.programMapTable}},this.push=function(t){var n={},r=4;if(n.payloadUnitStartIndicator=!!(64&t[1]),n.pid=31&t[1],n.pid<<=8,n.pid|=t[2],(48&t[3])>>>4>1&&(r+=t[r]+1),0===n.pid)n.type="pat",e(t.subarray(r),n),this.trigger("data",n);else if(n.pid===this.pmtPid)for(n.type="pmt",e(t.subarray(r),n),this.trigger("data",n);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,r,n]):this.processPes_(t,r,n)},this.processPes_=function(e,t,n){n.pid===this.programMapTable.video?n.streamType=f.H264_STREAM_TYPE:n.pid===this.programMapTable.audio?n.streamType=f.ADTS_STREAM_TYPE:n.streamType=this.programMapTable["timed-metadata"][n.pid],n.type="pes",n.data=e.subarray(t),this.trigger("data",n)}}).prototype=new l,o.STREAM_TYPES={h264:27,adts:15},(d=function(){var e=this,video={data:[],size:0},audio={data:[],size:0},t={data:[],size:0},n=function(e,t){var n;t.packetLength=6+(e[4]<<8|e[5]),t.dataAlignmentIndicator=0!=(4&e[6]),192&(n=e[7])&&(t.pts=(14&e[9])<<27|(255&e[10])<<20|(254&e[11])<<12|(255&e[12])<<5|(254&e[13])>>>3,t.pts*=4,t.pts+=(6&e[13])>>>1,t.dts=t.pts,64&n&&(t.dts=(14&e[14])<<27|(255&e[15])<<20|(254&e[16])<<12|(255&e[17])<<5|(254&e[18])>>>3,t.dts*=4,t.dts+=(6&e[18])>>>1)),t.data=e.subarray(9+e[8])},r=function(t,r,o){var d,l=new Uint8Array(t.size),c={type:r},i=0,f=0,h=!1;if(t.data.length&&!(t.size<9)){for(c.trackId=t.data[0].pid,i=0;i<t.data.length;i++)d=t.data[i],l.set(d.data,f),f+=d.data.byteLength;n(l,c),h="video"===r||c.packetLength<=t.size,(o||h)&&(t.size=0,t.data.length=0),h&&e.trigger("data",c)}};d.prototype.init.call(this),this.push=function(data){({pat:function(){},pes:function(){var e,n;switch(data.streamType){case f.H264_STREAM_TYPE:case m.H264_STREAM_TYPE:e=video,n="video";break;case f.ADTS_STREAM_TYPE:e=audio,n="audio";break;case f.METADATA_STREAM_TYPE:e=t,n="timed-metadata";break;default:return}data.payloadUnitStartIndicator&&r(e,n,!0),e.data.push(data),e.size+=data.data.byteLength},pmt:function(){var t={type:"metadata",tracks:[]},n=data.programMapTable;null!==n.video&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+n.video,codec:"avc",type:"video"}),null!==n.audio&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+n.audio,codec:"adts",type:"audio"}),e.trigger("data",t)}})[data.type]()},this.flush=function(){r(video,"video"),r(audio,"audio"),r(t,"timed-metadata"),this.trigger("done")}}).prototype=new l;var _={PAT_PID:0,MP2T_PACKET_LENGTH:y,TransportPacketStream:r,TransportParseStream:o,ElementaryStream:d,TimestampRolloverStream:h,CaptionStream:c.CaptionStream,Cea608Stream:c.Cea608Stream,MetadataStream:e("./metadata-stream")};for(var T in f)f.hasOwnProperty(T)&&(_[T]=f[T]);t.exports=_},{"../utils/stream.js":62,"./caption-stream":49,"./metadata-stream":51,"./stream-types":53,"./stream-types.js":53,"./timestamp-rollover-stream":54}],51:[function(e,t,n){"use strict";var r,o=e("../utils/stream"),d=e("./stream-types"),l=function(e,t,n){var i,r="";for(i=t;i<n;i++)r+="%"+("00"+e[i].toString(16)).slice(-2);return r},c=function(e,t,n){return decodeURIComponent(l(e,t,n))},f=function(e,t,n){return unescape(l(e,t,n))},h=function(data){return data[0]<<21|data[1]<<14|data[2]<<7|data[3]},m={TXXX:function(e){var i;if(3===e.data[0]){for(i=1;i<e.data.length;i++)if(0===e.data[i]){e.description=c(e.data,1,i),e.value=c(e.data,i+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var i;if(3===e.data[0])for(i=1;i<e.data.length;i++)if(0===e.data[i]){e.description=c(e.data,1,i),e.url=c(e.data,i+1,e.data.length);break}},PRIV:function(e){var i;for(i=0;i<e.data.length;i++)if(0===e.data[i]){e.owner=f(e.data,0,i);break}e.privateData=e.data.subarray(i+1),e.data=e.privateData}};(r=function(e){var i,t={debug:!(!e||!e.debug),descriptor:e&&e.descriptor},n=0,o=[],l=0;if(r.prototype.init.call(this),this.dispatchType=d.METADATA_STREAM_TYPE.toString(16),t.descriptor)for(i=0;i<t.descriptor.length;i++)this.dispatchType+=("00"+t.descriptor[i].toString(16)).slice(-2);this.push=function(e){var r,d,c,f,i;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(l=0,o.length=0),0===o.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))t.debug&&console.log("Skipping unrecognized metadata packet");else if(o.push(e),l+=e.data.byteLength,1===o.length&&(n=h(e.data.subarray(6,10)),n+=10),!(l<n)){for(r={data:new Uint8Array(n),frames:[],pts:o[0].pts,dts:o[0].dts},i=0;i<n;)r.data.set(o[0].data.subarray(0,n-i),i),i+=o[0].data.byteLength,l-=o[0].data.byteLength,o.shift();d=10,64&r.data[5]&&(d+=4,d+=h(r.data.subarray(10,14)),n-=h(r.data.subarray(16,20)));do{if((c=h(r.data.subarray(d+4,d+8)))<1)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");if((f={id:String.fromCharCode(r.data[d],r.data[d+1],r.data[d+2],r.data[d+3]),data:r.data.subarray(d+10,d+c+10)}).key=f.id,m[f.id]&&(m[f.id](f),"com.apple.streaming.transportStreamTimestamp"===f.owner)){var y=f.data,v=(1&y[3])<<30|y[4]<<22|y[5]<<14|y[6]<<6|y[7]>>>2;v*=4,v+=3&y[7],f.timeStamp=v,void 0===r.pts&&void 0===r.dts&&(r.pts=f.timeStamp,r.dts=f.timeStamp),this.trigger("timestamp",f)}r.frames.push(f),d+=10,d+=c}while(d<n);this.trigger("data",r)}}}).prototype=new o,t.exports=r},{"../utils/stream":62,"./stream-types":53}],52:[function(e,t,n){"use strict";var r=e("./stream-types.js"),o=function(e){var t=31&e[1];return t<<=8,t|=e[2]},d=function(e){return!!(64&e[1])},l=function(e){var t=0;return(48&e[3])>>>4>1&&(t+=e[4]+1),t},c=function(e,t){var n=o(e);return 0===n?"pat":n===t?"pmt":t?"pes":null},f=function(e){var t=d(e),n=4+l(e);return t&&(n+=e[n]+1),(31&e[n+10])<<8|e[n+11]},h=function(e){var t={},n=d(e),r=4+l(e);if(n&&(r+=e[r]+1),1&e[r+5]){var o;o=3+((15&e[r+1])<<8|e[r+2])-4;for(var c=12+((15&e[r+10])<<8|e[r+11]);c<o;){var i=r+c;t[(31&e[i+1])<<8|e[i+2]]=e[i],c+=5+((15&e[i+3])<<8|e[i+4])}return t}},m=function(e,t){switch(t[o(e)]){case r.H264_STREAM_TYPE:return"video";case r.ADTS_STREAM_TYPE:return"audio";case r.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},y=function(e){if(!d(e))return null;var t=4+l(e);if(t>=e.byteLength)return null;var n,r=null;return 192&(n=e[t+7])&&((r={}).pts=(14&e[t+9])<<27|(255&e[t+10])<<20|(254&e[t+11])<<12|(255&e[t+12])<<5|(254&e[t+13])>>>3,r.pts*=4,r.pts+=(6&e[t+13])>>>1,r.dts=r.pts,64&n&&(r.dts=(14&e[t+14])<<27|(255&e[t+15])<<20|(254&e[t+16])<<12|(255&e[t+17])<<5|(254&e[t+18])>>>3,r.dts*=4,r.dts+=(6&e[t+18])>>>1)),r},v=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},_=function(e){for(var t=4+l(e),n=e.subarray(t),r=0,o=0,d=!1;o<n.byteLength-3;o++)if(1===n[o+2]){r=o+5;break}for(;r<n.byteLength;)switch(n[r]){case 0:if(0!==n[r-1]){r+=2;break}if(0!==n[r-2]){r++;break}o+3!==r-2&&"slice_layer_without_partitioning_rbsp_idr"===v(31&n[o+3])&&(d=!0);do{r++}while(1!==n[r]&&r<n.length);o=r-2,r+=3;break;case 1:if(0!==n[r-1]||0!==n[r-2]){r+=3;break}"slice_layer_without_partitioning_rbsp_idr"===v(31&n[o+3])&&(d=!0),o=r-2,r+=3;break;default:r+=3}return n=n.subarray(o),r-=o,o=0,n&&n.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===v(31&n[o+3])&&(d=!0),d};t.exports={parseType:c,parsePat:f,parsePmt:h,parsePayloadUnitStartIndicator:d,parsePesType:m,parsePesTime:y,videoPacketContainsKeyFrame:_}},{"./stream-types.js":53}],53:[function(e,t,n){"use strict";t.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},{}],54:[function(e,t,n){"use strict";var r=e("../utils/stream"),o=8589934592,d=4294967296,l=function(e,t){var n=1;for(e>t&&(n=-1);Math.abs(t-e)>d;)e+=n*o;return e},c=function(e){var t,n;c.prototype.init.call(this),this.type_=e,this.push=function(data){data.type===this.type_&&(void 0===n&&(n=data.dts),data.dts=l(data.dts,n),data.pts=l(data.pts,n),t=data.dts,this.trigger("data",data))},this.flush=function(){n=t,this.trigger("done")},this.discontinuity=function(){n=void 0,t=void 0}};c.prototype=new r,t.exports={TimestampRolloverStream:c,handleRollover:l}},{"../utils/stream":62}],55:[function(e,t,n){t.exports={generator:e("./mp4-generator"),Transmuxer:e("./transmuxer").Transmuxer,AudioSegmentStream:e("./transmuxer").AudioSegmentStream,VideoSegmentStream:e("./transmuxer").VideoSegmentStream}},{"./mp4-generator":56,"./transmuxer":58}],56:[function(e,t,n){"use strict";var r,o,d,l,c,f,h,m,y,v,_,T,S,w,k,O,E,A,L,P,I,C,U,M,D,x,R,B,j,N,F,G,H,V,W,z,X,Y,K,$,Q,J=Math.pow(2,32)-1;!function(){var i;if(U={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(i in U)U.hasOwnProperty(i)&&(U[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);M=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),x=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),D=new Uint8Array([0,0,0,1]),R=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),B=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),j={video:R,audio:B},G=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),F=new Uint8Array([0,0,0,0,0,0,0,0]),H=new Uint8Array([0,0,0,0,0,0,0,0]),V=H,W=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),z=H,N=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),r=function(e){var i,t,n=[],r=0;for(i=1;i<arguments.length;i++)n.push(arguments[i]);for(i=n.length;i--;)r+=n[i].byteLength;for(t=new Uint8Array(r+8),new DataView(t.buffer,t.byteOffset,t.byteLength).setUint32(0,t.byteLength),t.set(e,4),i=0,r=8;i<n.length;i++)t.set(n[i],r),r+=n[i].byteLength;return t},o=function(){return r(U.dinf,r(U.dref,G))},d=function(track){return r(U.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,track.audioobjecttype<<3|track.samplingfrequencyindex>>>1,track.samplingfrequencyindex<<7|track.channelcount<<3,6,1,2]))},l=function(){return r(U.ftyp,M,D,M,x)},O=function(e){return r(U.hdlr,j[e])},c=function(data){return r(U.mdat,data)},k=function(track){var e=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,track.duration>>>24&255,track.duration>>>16&255,track.duration>>>8&255,255&track.duration,85,196,0,0]);return track.samplerate&&(e[12]=track.samplerate>>>24&255,e[13]=track.samplerate>>>16&255,e[14]=track.samplerate>>>8&255,e[15]=255&track.samplerate),r(U.mdhd,e)},w=function(track){return r(U.mdia,k(track),O(track.type),h(track))},f=function(e){return r(U.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},h=function(track){return r(U.minf,"video"===track.type?r(U.vmhd,N):r(U.smhd,F),o(),A(track))},m=function(e,t){for(var n=[],i=t.length;i--;)n[i]=P(t[i]);return r.apply(null,[U.moof,f(e)].concat(n))},y=function(e){for(var i=e.length,t=[];i--;)t[i]=T(e[i]);return r.apply(null,[U.moov,_(4294967295)].concat(t).concat(v(e)))},v=function(e){for(var i=e.length,t=[];i--;)t[i]=I(e[i]);return r.apply(null,[U.mvex].concat(t))},_=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return r(U.mvhd,t)},E=function(track){var e,i,t=track.samples||[],n=new Uint8Array(4+t.length);for(i=0;i<t.length;i++)e=t[i].flags,n[i+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return r(U.sdtp,n)},A=function(track){return r(U.stbl,L(track),r(U.stts,z),r(U.stsc,V),r(U.stsz,W),r(U.stco,H))},L=function(track){return r(U.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===track.type?X(track):Y(track))},X=function(track){var i,e=track.sps||[],t=track.pps||[],n=[],o=[];for(i=0;i<e.length;i++)n.push((65280&e[i].byteLength)>>>8),n.push(255&e[i].byteLength),n=n.concat(Array.prototype.slice.call(e[i]));for(i=0;i<t.length;i++)o.push((65280&t[i].byteLength)>>>8),o.push(255&t[i].byteLength),o=o.concat(Array.prototype.slice.call(t[i]));return r(U.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&track.width)>>8,255&track.width,(65280&track.height)>>8,255&track.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),r(U.avcC,new Uint8Array([1,track.profileIdc,track.profileCompatibility,track.levelIdc,255].concat([e.length]).concat(n).concat([t.length]).concat(o))),r(U.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))},Y=function(track){return r(U.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&track.channelcount)>>8,255&track.channelcount,(65280&track.samplesize)>>8,255&track.samplesize,0,0,0,0,(65280&track.samplerate)>>8,255&track.samplerate,0,0]),d(track))},S=function(track){var e=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&track.id)>>24,(16711680&track.id)>>16,(65280&track.id)>>8,255&track.id,0,0,0,0,(4278190080&track.duration)>>24,(16711680&track.duration)>>16,(65280&track.duration)>>8,255&track.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&track.width)>>8,255&track.width,0,0,(65280&track.height)>>8,255&track.height,0,0]);return r(U.tkhd,e)},P=function(track){var e,t,n,o,d,l,c;return e=r(U.tfhd,new Uint8Array([0,0,0,58,(4278190080&track.id)>>24,(16711680&track.id)>>16,(65280&track.id)>>8,255&track.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),l=Math.floor(track.baseMediaDecodeTime/(J+1)),c=Math.floor(track.baseMediaDecodeTime%(J+1)),t=r(U.tfdt,new Uint8Array([1,0,0,0,l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c])),d=92,"audio"===track.type?(n=C(track,d),r(U.traf,e,t,n)):(o=E(track),n=C(track,o.length+d),r(U.traf,e,t,n,o))},T=function(track){return track.duration=track.duration||4294967295,r(U.trak,S(track),w(track))},I=function(track){var e=new Uint8Array([0,0,0,0,(4278190080&track.id)>>24,(16711680&track.id)>>16,(65280&track.id)>>8,255&track.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==track.type&&(e[e.length-1]=0),r(U.trex,e)},Q=function(e,t){var n=0,r=0,o=0,d=0;return e.length&&(void 0!==e[0].duration&&(n=1),void 0!==e[0].size&&(r=2),void 0!==e[0].flags&&(o=4),void 0!==e[0].compositionTimeOffset&&(d=8)),[0,0,n|r|o|d,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},$=function(track,e){var t,n,o,i;for(e+=20+16*(n=track.samples||[]).length,t=Q(n,e),i=0;i<n.length;i++)o=n[i],t=t.concat([(4278190080&o.duration)>>>24,(16711680&o.duration)>>>16,(65280&o.duration)>>>8,255&o.duration,(4278190080&o.size)>>>24,(16711680&o.size)>>>16,(65280&o.size)>>>8,255&o.size,o.flags.isLeading<<2|o.flags.dependsOn,o.flags.isDependedOn<<6|o.flags.hasRedundancy<<4|o.flags.paddingValue<<1|o.flags.isNonSyncSample,61440&o.flags.degradationPriority,15&o.flags.degradationPriority,(4278190080&o.compositionTimeOffset)>>>24,(16711680&o.compositionTimeOffset)>>>16,(65280&o.compositionTimeOffset)>>>8,255&o.compositionTimeOffset]);return r(U.trun,new Uint8Array(t))},K=function(track,e){var t,n,o,i;for(e+=20+8*(n=track.samples||[]).length,t=Q(n,e),i=0;i<n.length;i++)o=n[i],t=t.concat([(4278190080&o.duration)>>>24,(16711680&o.duration)>>>16,(65280&o.duration)>>>8,255&o.duration,(4278190080&o.size)>>>24,(16711680&o.size)>>>16,(65280&o.size)>>>8,255&o.size]);return r(U.trun,new Uint8Array(t))},C=function(track,e){return"audio"===track.type?K(track,e):$(track,e)},t.exports={ftyp:l,mdat:c,moof:m,moov:y,initSegment:function(e){var t,n=l(),r=y(e);return(t=new Uint8Array(n.byteLength+r.byteLength)).set(n),t.set(r,n.byteLength),t}}},{}],57:[function(e,t,n){"use strict";var r,o,d,l;r=function(data,path){var i,e,t,n,d,l=[];if(!path.length)return null;for(i=0;i<data.byteLength;)e=data[i]<<24,e|=data[i+1]<<16,e|=data[i+2]<<8,e|=data[i+3],t=o(data.subarray(i+4,i+8)),n=e>1?i+e:data.byteLength,t===path[0]&&(1===path.length?l.push(data.subarray(i+8,n)):(d=r(data.subarray(i+8,n),path.slice(1))).length&&(l=l.concat(d))),i=n;return l},o=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3])},d=function(e){var t={};return r(e,["moov","trak"]).reduce((function(e,t){var n,o,d,l;return(n=r(t,["tkhd"])[0])?(d=n[o=0===n[0]?12:20]<<24|n[o+1]<<16|n[o+2]<<8|n[o+3],(l=r(t,["mdia","mdhd"])[0])?(o=0===l[0]?12:20,e[d]=l[o]<<24|l[o+1]<<16|l[o+2]<<8|l[o+3],e):null):null}),t)},l=function(e,t){var n,o,d;return n=r(t,["moof","traf"]),o=[].concat.apply([],n.map((function(t){return r(t,["tfhd"]).map((function(n){var o,d;return o=n[4]<<24|n[5]<<16|n[6]<<8|n[7],d=e[o]||9e4,(r(t,["tfdt"]).map((function(e){var t,n;return t=e[0],n=e[4]<<24|e[5]<<16|e[6]<<8|e[7],1===t&&(n*=Math.pow(2,32),n+=e[8]<<24|e[9]<<16|e[10]<<8|e[11]),n}))[0]||1/0)/d}))}))),d=Math.min.apply(null,o),isFinite(d)?d:0},t.exports={parseType:o,timescale:d,startTime:l}},{}],58:[function(e,t,n){"use strict";var r,o,d,l,c,f,h,m,y,v,_,T=e("../utils/stream.js"),S=e("./mp4-generator.js"),w=e("../m2ts/m2ts.js"),k=e("../codecs/adts.js"),O=e("../codecs/h264").H264Stream,E=e("../aac"),A=e("../data/silence"),L=e("../utils/clock"),P=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],I=["width","height","profileIdc","levelIdc","profileCompatibility"],C=9e4;c=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0}}},f=function(data){return data[0]==="I".charCodeAt(0)&&data[1]==="D".charCodeAt(0)&&data[2]==="3".charCodeAt(0)},v=function(a,b){var i;if(a.length!==b.length)return!1;for(i=0;i<a.length;i++)if(a[i]!==b[i])return!1;return!0},_=function(e){var i,t=0;for(i=0;i<e.length;i++)t+=e[i].data.byteLength;return t},(o=function(track){var e=[],t=0,n=0,r=0,d=1/0;o.prototype.init.call(this),this.push=function(data){h(track,data),track&&P.forEach((function(e){track[e]=data[e]})),e.push(data)},this.setEarliestDts=function(e){n=e-track.timelineStartInfo.baseMediaDecodeTime},this.setVideoBaseMediaDecodeTime=function(e){d=e},this.setAudioAppendStart=function(e){r=e},this.flush=function(){var n,r,o,d;0!==e.length?(n=this.trimAdtsFramesByEarliestDts_(e),track.baseMediaDecodeTime=y(track),this.prefixWithSilence_(track,n),track.samples=this.generateSampleTable_(n),o=S.mdat(this.concatenateFrameData_(n)),e=[],r=S.moof(t,[track]),d=new Uint8Array(r.byteLength+o.byteLength),t++,d.set(r),d.set(o,r.byteLength),m(track),this.trigger("data",{track:track,boxes:d}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.prefixWithSilence_=function(track,e){var t,n,i,o=0,l=0,c=0,f=0;if(e.length&&(t=L.audioTsToVideoTs(track.baseMediaDecodeTime,track.samplerate),o=Math.ceil(C/(track.samplerate/1024)),r&&d&&(l=t-Math.max(r,d),f=(c=Math.floor(l/o))*o),!(c<1||f>C/2))){for((n=A[track.samplerate])||(n=e[0].data),i=0;i<c;i++)e.splice(i,0,{data:n});track.baseMediaDecodeTime-=Math.floor(L.videoTsToAudioTs(f,track.samplerate))}},this.trimAdtsFramesByEarliestDts_=function(e){return track.minSegmentDts>=n?e:(track.minSegmentDts=1/0,e.filter((function(e){return e.dts>=n&&(track.minSegmentDts=Math.min(track.minSegmentDts,e.dts),track.minSegmentPts=track.minSegmentDts,!0)})))},this.generateSampleTable_=function(e){var i,t,n=[];for(i=0;i<e.length;i++)t=e[i],n.push({size:t.data.byteLength,duration:1024});return n},this.concatenateFrameData_=function(e){var i,t,n=0,data=new Uint8Array(_(e));for(i=0;i<e.length;i++)t=e[i],data.set(t.data,n),n+=t.data.byteLength;return data}}).prototype=new T,(r=function(track,e){var t,n,o=0,d=[],l=[];e=e||{},r.prototype.init.call(this),delete track.minPTS,this.gopCache_=[],this.push=function(e){h(track,e),"seq_parameter_set_rbsp"!==e.nalUnitType||t||(t=e.config,track.sps=[e.data],I.forEach((function(e){track[e]=t[e]}),this)),"pic_parameter_set_rbsp"!==e.nalUnitType||n||(n=e.data,track.pps=[e.data]),d.push(e)},this.flush=function(){for(var t,n,r,c,f,v;d.length&&"access_unit_delimiter_rbsp"!==d[0].nalUnitType;)d.shift();if(0===d.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(t=this.groupNalsIntoFrames_(d),(r=this.groupFramesIntoGops_(t))[0][0].keyFrame||((n=this.getGopForFusion_(d[0],track))?(r.unshift(n),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.pts=n.pts,r.dts=n.dts,r.duration+=n.duration):r=this.extendFirstKeyFrame_(r)),l.length){var _;if(!(_=e.alignGopsAtEnd?this.alignGopsAtEnd_(r):this.alignGopsAtStart_(r)))return this.gopCache_.unshift({gop:r.pop(),pps:track.pps,sps:track.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),d=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");m(track),r=_}h(track,r),track.samples=this.generateSampleTable_(r),f=S.mdat(this.concatenateNalData_(r)),track.baseMediaDecodeTime=y(track),this.trigger("processedGopsInfo",r.map((function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}}))),this.gopCache_.unshift({gop:r.pop(),pps:track.pps,sps:track.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),d=[],this.trigger("baseMediaDecodeTime",track.baseMediaDecodeTime),this.trigger("timelineStartInfo",track.timelineStartInfo),c=S.moof(o,[track]),v=new Uint8Array(c.byteLength+f.byteLength),o++,v.set(c),v.set(f,c.byteLength),this.trigger("data",{track:track,boxes:v}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.resetStream_=function(){m(track),t=void 0,n=void 0},this.getGopForFusion_=function(e){var t,n,r,o,i,d=45e3,l=1e4,c=1/0;for(i=0;i<this.gopCache_.length;i++)r=(o=this.gopCache_[i]).gop,track.pps&&v(track.pps[0],o.pps[0])&&track.sps&&v(track.sps[0],o.sps[0])&&(r.dts<track.timelineStartInfo.dts||(t=e.dts-r.dts-r.duration)>=-l&&t<=d&&(!n||c>t)&&(n=o,c=t));return n?n.gop:null},this.extendFirstKeyFrame_=function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},this.groupNalsIntoFrames_=function(e){var i,t,n=[],r=[];for(n.byteLength=0,i=0;i<e.length;i++)"access_unit_delimiter_rbsp"===(t=e[i]).nalUnitType?(n.length&&(n.duration=t.dts-n.dts,r.push(n)),(n=[t]).byteLength=t.data.byteLength,n.pts=t.pts,n.dts=t.dts):("slice_layer_without_partitioning_rbsp_idr"===t.nalUnitType&&(n.keyFrame=!0),n.duration=t.dts-n.dts,n.byteLength+=t.data.byteLength,n.push(t));return r.length&&(!n.duration||n.duration<=0)&&(n.duration=r[r.length-1].duration),r.push(n),r},this.groupFramesIntoGops_=function(e){var i,t,n=[],r=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=e[0].pts,n.dts=e[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,i=0;i<e.length;i++)(t=e[i]).keyFrame?(n.length&&(r.push(n),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration),(n=[t]).nalCount=t.length,n.byteLength=t.byteLength,n.pts=t.pts,n.dts=t.dts,n.duration=t.duration):(n.duration+=t.duration,n.nalCount+=t.length,n.byteLength+=t.byteLength,n.push(t));return r.length&&n.duration<=0&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration,r.push(n),r},this.generateSampleTable_=function(e,t){var n,i,r,o,d,l=t||0,f=[];for(n=0;n<e.length;n++)for(o=e[n],i=0;i<o.length;i++)d=o[i],(r=c()).dataOffset=l,r.compositionTimeOffset=d.pts-d.dts,r.duration=d.duration,r.size=4*d.length,r.size+=d.byteLength,d.keyFrame&&(r.flags.dependsOn=2),l+=r.size,f.push(r);return f},this.concatenateNalData_=function(e){var t,i,n,r,o,d,l=0,c=e.byteLength,f=e.nalCount,data=new Uint8Array(c+4*f),view=new DataView(data.buffer);for(t=0;t<e.length;t++)for(r=e[t],i=0;i<r.length;i++)for(o=r[i],n=0;n<o.length;n++)d=o[n],view.setUint32(l,d.data.byteLength),l+=4,data.set(d.data,l),l+=d.data.byteLength;return data},this.alignGopsAtStart_=function(e){var t,n,r,o,d,c,f,h;for(d=e.byteLength,c=e.nalCount,f=e.duration,t=n=0;t<l.length&&n<e.length&&(r=l[t],o=e[n],r.pts!==o.pts);)o.pts>r.pts?t++:(n++,d-=o.byteLength,c-=o.nalCount,f-=o.duration);return 0===n?e:n===e.length?null:((h=e.slice(n)).byteLength=d,h.duration=f,h.nalCount=c,h.pts=h[0].pts,h.dts=h[0].dts,h)},this.alignGopsAtEnd_=function(e){var t,n,r,o,d,c,f;for(t=l.length-1,n=e.length-1,d=null,c=!1;t>=0&&n>=0;){if(r=l[t],o=e[n],r.pts===o.pts){c=!0;break}r.pts>o.pts?t--:(t===l.length-1&&(d=n),n--)}if(!c&&null===d)return null;if(0===(f=c?n:d))return e;var h=e.slice(f),m=h.reduce((function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e}),{byteLength:0,duration:0,nalCount:0});return h.byteLength=m.byteLength,h.duration=m.duration,h.nalCount=m.nalCount,h.pts=h[0].pts,h.dts=h[0].dts,h},this.alignGopsWith=function(e){l=e}}).prototype=new T,h=function(track,data){"number"==typeof data.pts&&(void 0===track.timelineStartInfo.pts&&(track.timelineStartInfo.pts=data.pts),void 0===track.minSegmentPts?track.minSegmentPts=data.pts:track.minSegmentPts=Math.min(track.minSegmentPts,data.pts),void 0===track.maxSegmentPts?track.maxSegmentPts=data.pts:track.maxSegmentPts=Math.max(track.maxSegmentPts,data.pts)),"number"==typeof data.dts&&(void 0===track.timelineStartInfo.dts&&(track.timelineStartInfo.dts=data.dts),void 0===track.minSegmentDts?track.minSegmentDts=data.dts:track.minSegmentDts=Math.min(track.minSegmentDts,data.dts),void 0===track.maxSegmentDts?track.maxSegmentDts=data.dts:track.maxSegmentDts=Math.max(track.maxSegmentDts,data.dts))},m=function(track){delete track.minSegmentDts,delete track.maxSegmentDts,delete track.minSegmentPts,delete track.maxSegmentPts},y=function(track){var e,t=track.minSegmentDts-track.timelineStartInfo.dts;return e=track.timelineStartInfo.baseMediaDecodeTime,e+=t,e=Math.max(0,e),"audio"===track.type&&(e*=track.samplerate/C,e=Math.floor(e)),e},(l=function(e,t){this.numberOfTracks=0,this.metadataStream=t,void 0!==e.remux?this.remuxTracks=!!e.remux:this.remuxTracks=!0,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,l.prototype.init.call(this),this.push=function(output){return output.text?this.pendingCaptions.push(output):output.frames?this.pendingMetadata.push(output):(this.pendingTracks.push(output.track),this.pendingBoxes.push(output.boxes),this.pendingBytes+=output.boxes.byteLength,"video"===output.track.type&&(this.videoTrack=output.track),void("audio"===output.track.type&&(this.audioTrack=output.track)))}}).prototype=new T,l.prototype.flush=function(e){var caption,t,n,i,r=0,o={captions:[],captionStreams:{},metadata:[],info:{}},d=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}for(this.videoTrack?(d=this.videoTrack.timelineStartInfo.pts,I.forEach((function(e){o.info[e]=this.videoTrack[e]}),this)):this.audioTrack&&(d=this.audioTrack.timelineStartInfo.pts,P.forEach((function(e){o.info[e]=this.audioTrack[e]}),this)),1===this.pendingTracks.length?o.type=this.pendingTracks[0].type:o.type="combined",this.emittedTracks+=this.pendingTracks.length,n=S.initSegment(this.pendingTracks),o.initSegment=new Uint8Array(n.byteLength),o.initSegment.set(n),o.data=new Uint8Array(this.pendingBytes),i=0;i<this.pendingBoxes.length;i++)o.data.set(this.pendingBoxes[i],r),r+=this.pendingBoxes[i].byteLength;for(i=0;i<this.pendingCaptions.length;i++)(caption=this.pendingCaptions[i]).startTime=caption.startPts-d,caption.startTime/=9e4,caption.endTime=caption.endPts-d,caption.endTime/=9e4,o.captionStreams[caption.stream]=!0,o.captions.push(caption);for(i=0;i<this.pendingMetadata.length;i++)(t=this.pendingMetadata[i]).cueTime=t.pts-d,t.cueTime/=9e4,o.metadata.push(t);o.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",o),this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},(d=function(e){var t,n,c=this,h=!0;d.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var t={};this.transmuxPipeline_=t,t.type="aac",t.metadataStream=new w.MetadataStream,t.aacStream=new E,t.audioTimestampRolloverStream=new w.TimestampRolloverStream("audio"),t.timedMetadataTimestampRolloverStream=new w.TimestampRolloverStream("timed-metadata"),t.adtsStream=new k,t.coalesceStream=new l(e,t.metadataStream),t.headOfPipeline=t.aacStream,t.aacStream.pipe(t.audioTimestampRolloverStream).pipe(t.adtsStream),t.aacStream.pipe(t.timedMetadataTimestampRolloverStream).pipe(t.metadataStream).pipe(t.coalesceStream),t.metadataStream.on("timestamp",(function(e){t.aacStream.setTimestamp(e.timeStamp)})),t.aacStream.on("data",(function(data){"timed-metadata"!==data.type||t.audioSegmentStream||(n=n||{timelineStartInfo:{baseMediaDecodeTime:c.baseMediaDecodeTime},codec:"adts",type:"audio"},t.coalesceStream.numberOfTracks++,t.audioSegmentStream=new o(n),t.adtsStream.pipe(t.audioSegmentStream).pipe(t.coalesceStream))})),t.coalesceStream.on("data",this.trigger.bind(this,"data")),t.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var d={};this.transmuxPipeline_=d,d.type="ts",d.metadataStream=new w.MetadataStream,d.packetStream=new w.TransportPacketStream,d.parseStream=new w.TransportParseStream,d.elementaryStream=new w.ElementaryStream,d.videoTimestampRolloverStream=new w.TimestampRolloverStream("video"),d.audioTimestampRolloverStream=new w.TimestampRolloverStream("audio"),d.timedMetadataTimestampRolloverStream=new w.TimestampRolloverStream("timed-metadata"),d.adtsStream=new k,d.h264Stream=new O,d.captionStream=new w.CaptionStream,d.coalesceStream=new l(e,d.metadataStream),d.headOfPipeline=d.packetStream,d.packetStream.pipe(d.parseStream).pipe(d.elementaryStream),d.elementaryStream.pipe(d.videoTimestampRolloverStream).pipe(d.h264Stream),d.elementaryStream.pipe(d.audioTimestampRolloverStream).pipe(d.adtsStream),d.elementaryStream.pipe(d.timedMetadataTimestampRolloverStream).pipe(d.metadataStream).pipe(d.coalesceStream),d.h264Stream.pipe(d.captionStream).pipe(d.coalesceStream),d.elementaryStream.on("data",(function(data){var i;if("metadata"===data.type){for(i=data.tracks.length;i--;)t||"video"!==data.tracks[i].type?n||"audio"!==data.tracks[i].type||((n=data.tracks[i]).timelineStartInfo.baseMediaDecodeTime=c.baseMediaDecodeTime):(t=data.tracks[i]).timelineStartInfo.baseMediaDecodeTime=c.baseMediaDecodeTime;t&&!d.videoSegmentStream&&(d.coalesceStream.numberOfTracks++,d.videoSegmentStream=new r(t,e),d.videoSegmentStream.on("timelineStartInfo",(function(e){n&&(n.timelineStartInfo=e,d.audioSegmentStream.setEarliestDts(e.dts))})),d.videoSegmentStream.on("processedGopsInfo",c.trigger.bind(c,"gopInfo")),d.videoSegmentStream.on("baseMediaDecodeTime",(function(e){n&&d.audioSegmentStream.setVideoBaseMediaDecodeTime(e)})),d.h264Stream.pipe(d.videoSegmentStream).pipe(d.coalesceStream)),n&&!d.audioSegmentStream&&(d.coalesceStream.numberOfTracks++,d.audioSegmentStream=new o(n),d.adtsStream.pipe(d.audioSegmentStream).pipe(d.coalesceStream))}})),d.coalesceStream.on("data",this.trigger.bind(this,"data")),d.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(e){var r=this.transmuxPipeline_;this.baseMediaDecodeTime=e,n&&(n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,m(n),n.timelineStartInfo.baseMediaDecodeTime=e,r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),t&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[],r.videoTimestampRolloverStream.discontinuity()),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,m(t),r.captionStream.reset(),t.timelineStartInfo.baseMediaDecodeTime=e),r.timedMetadataTimestampRolloverStream&&r.timedMetadataTimestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){n&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.push=function(data){if(h){var e=f(data);e&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():e||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),h=!1}this.transmuxPipeline_.headOfPipeline.push(data)},this.flush=function(){h=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new T,t.exports={Transmuxer:d,VideoSegmentStream:r,AudioSegmentStream:o,AUDIO_PROPERTIES:P,VIDEO_PROPERTIES:I}},{"../aac":38,"../codecs/adts.js":40,"../codecs/h264":41,"../data/silence":42,"../m2ts/m2ts.js":50,"../utils/clock":60,"../utils/stream.js":62,"./mp4-generator.js":56}],59:[function(e,t,n){"use strict";var r=e("../m2ts/stream-types.js"),o=e("../m2ts/timestamp-rollover-stream.js").handleRollover,d={};d.ts=e("../m2ts/probe.js"),d.aac=e("../aac/probe.js");var l=9e4,c=188,f=71,h=function(data){return data[0]==="I".charCodeAt(0)&&data[1]==="D".charCodeAt(0)&&data[2]==="3".charCodeAt(0)},m=function(e,t){for(var n,r=0,o=c;o<e.byteLength;)if(e[r]!==f||e[o]!==f)r++,o++;else{switch(n=e.subarray(r,o),d.ts.parseType(n,t.pid)){case"pat":t.pid||(t.pid=d.ts.parsePat(n));break;case"pmt":t.table||(t.table=d.ts.parsePmt(n))}if(t.pid&&t.table)return;r+=c,o+=c}},y=function(e,t,n){for(var r,o,l,h,m=0,y=c,v=!1;y<e.byteLength;)if(e[m]!==f||e[y]!==f)m++,y++;else{switch(r=e.subarray(m,y),d.ts.parseType(r,t.pid)){case"pes":o=d.ts.parsePesType(r,t.table),l=d.ts.parsePayloadUnitStartIndicator(r),"audio"===o&&l&&(h=d.ts.parsePesTime(r))&&(h.type="audio",n.audio.push(h),v=!0)}if(v)break;m+=c,y+=c}for(m=(y=e.byteLength)-c,v=!1;m>=0;)if(e[m]!==f||e[y]!==f)m--,y--;else{switch(r=e.subarray(m,y),d.ts.parseType(r,t.pid)){case"pes":o=d.ts.parsePesType(r,t.table),l=d.ts.parsePayloadUnitStartIndicator(r),"audio"===o&&l&&(h=d.ts.parsePesTime(r))&&(h.type="audio",n.audio.push(h),v=!0)}if(v)break;m-=c,y-=c}},v=function(e,t,n){for(var r,o,l,h,m,i,y,v=0,_=c,T=!1,S={data:[],size:0};_<e.byteLength;)if(e[v]!==f||e[_]!==f)v++,_++;else{switch(r=e.subarray(v,_),d.ts.parseType(r,t.pid)){case"pes":if(o=d.ts.parsePesType(r,t.table),l=d.ts.parsePayloadUnitStartIndicator(r),"video"===o&&(l&&!T&&(h=d.ts.parsePesTime(r))&&(h.type="video",n.video.push(h),T=!0),!n.firstKeyFrame)){if(l&&0!==S.size){for(m=new Uint8Array(S.size),i=0;S.data.length;)y=S.data.shift(),m.set(y,i),i+=y.byteLength;d.ts.videoPacketContainsKeyFrame(m)&&(n.firstKeyFrame=d.ts.parsePesTime(m),n.firstKeyFrame.type="video"),S.size=0}S.data.push(r),S.size+=r.byteLength}}if(T&&n.firstKeyFrame)break;v+=c,_+=c}for(v=(_=e.byteLength)-c,T=!1;v>=0;)if(e[v]!==f||e[_]!==f)v--,_--;else{switch(r=e.subarray(v,_),d.ts.parseType(r,t.pid)){case"pes":o=d.ts.parsePesType(r,t.table),l=d.ts.parsePayloadUnitStartIndicator(r),"video"===o&&l&&(h=d.ts.parsePesTime(r))&&(h.type="video",n.video.push(h),T=!0)}if(T)break;v-=c,_-=c}},_=function(e,t){if(e.audio&&e.audio.length){var n=t;void 0===n&&(n=e.audio[0].dts),e.audio.forEach((function(e){e.dts=o(e.dts,n),e.pts=o(e.pts,n),e.dtsTime=e.dts/l,e.ptsTime=e.pts/l}))}if(e.video&&e.video.length){var r=t;if(void 0===r&&(r=e.video[0].dts),e.video.forEach((function(e){e.dts=o(e.dts,r),e.pts=o(e.pts,r),e.dtsTime=e.dts/l,e.ptsTime=e.pts/l})),e.firstKeyFrame){var d=e.firstKeyFrame;d.dts=o(d.dts,r),d.pts=o(d.pts,r),d.dtsTime=d.dts/l,d.ptsTime=d.dts/l}}},T=function(e){for(var t,n=!1,r=0,o=null,c=null,f=0,h=0;e.length-h>=3;){switch(d.aac.parseType(e,h)){case"timed-metadata":if(e.length-h<10){n=!0;break}if((f=d.aac.parseId3TagSize(e,h))>e.length){n=!0;break}null===c&&(t=e.subarray(h,h+f),c=d.aac.parseAacTimestamp(t)),h+=f;break;case"audio":if(e.length-h<7){n=!0;break}if((f=d.aac.parseAdtsSize(e,h))>e.length){n=!0;break}null===o&&(t=e.subarray(h,h+f),o=d.aac.parseSampleRate(t)),r++,h+=f;break;default:h++}if(n)return null}if(null===o||null===c)return null;var m=l/o;return{audio:[{type:"audio",dts:c,pts:c},{type:"audio",dts:c+1024*r*m,pts:c+1024*r*m}]}},S=function(e){var t={pid:null,table:null},n={};for(var o in m(e,t),t.table)if(t.table.hasOwnProperty(o))switch(t.table[o]){case r.H264_STREAM_TYPE:n.video=[],v(e,t,n),0===n.video.length&&delete n.video;break;case r.ADTS_STREAM_TYPE:n.audio=[],y(e,t,n),0===n.audio.length&&delete n.audio}return n},w=function(e,t){var n;return(n=h(e)?T(e):S(e))&&(n.audio||n.video)?(_(n,t),n):null};t.exports={inspect:w}},{"../aac/probe.js":39,"../m2ts/probe.js":52,"../m2ts/stream-types.js":53,"../m2ts/timestamp-rollover-stream.js":54}],60:[function(e,t,n){var r,o,d,l,c,f,h=9e4;r=function(e){return e*h},o=function(e,t){return e*t},d=function(e){return e/h},l=function(e,t){return e/t},c=function(e,t){return r(l(e,t))},f=function(e,t){return o(d(e),t)},t.exports={secondsToVideoTs:r,secondsToAudioTs:o,videoTsToSeconds:d,audioTsToSeconds:l,audioTsToVideoTs:c,videoTsToAudioTs:f}},{}],61:[function(e,t,n){"use strict";var r;r=function(e){var t=e.byteLength,n=0,r=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+r},this.loadWord=function(){var o=e.byteLength-t,d=new Uint8Array(4),l=Math.min(4,t);if(0===l)throw new Error("no bytes available");d.set(e.subarray(o,o+l)),n=new DataView(d.buffer).getUint32(0),r=8*l,t-=l},this.skipBits=function(e){var o;r>e?(n<<=e,r-=e):(e-=r,e-=8*(o=Math.floor(e/8)),t-=o,this.loadWord(),n<<=e,r-=e)},this.readBits=function(e){var o=Math.min(r,e),d=n>>>32-o;return(r-=o)>0?n<<=o:t>0&&this.loadWord(),(o=e-o)>0?d<<o|this.readBits(o):d},this.skipLeadingZeros=function(){var e;for(e=0;e<r;++e)if(0!=(n&2147483648>>>e))return n<<=e,r-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()},t.exports=r},{}],62:[function(e,t,n){"use strict";var r=function(){this.init=function(){var e={};this.on=function(t,n){e[t]||(e[t]=[]),e[t]=e[t].concat(n)},this.off=function(t,n){var r;return!!e[t]&&(r=e[t].indexOf(n),e[t]=e[t].slice(),e[t].splice(r,1),r>-1)},this.trigger=function(t){var n,i,r,o;if(n=e[t])if(2===arguments.length)for(r=n.length,i=0;i<r;++i)n[i].call(this,arguments[1]);else{for(o=[],i=arguments.length,i=1;i<arguments.length;++i)o.push(arguments[i]);for(r=n.length,i=0;i<r;++i)n[i].apply(this,o)}},this.dispose=function(){e={}}}};r.prototype.pipe=function(e){return this.on("data",(function(data){e.push(data)})),this.on("done",(function(t){e.flush(t)})),e},r.prototype.push=function(data){this.trigger("data",data)},r.prototype.flush=function(e){this.trigger("done",e)},t.exports=r},{}],63:[function(e,t,n){var o,d,l,c,f,h;o=this,d=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,l=/^([^\/;?#]*)(.*)$/,c=/(?:\/|^)\.(?=\/)/g,f=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,h={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=this.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=h.normalizePath(r.path),h.buildURLFromParts(r)}var o=this.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=h.normalizePath(o.path),h.buildURLFromParts(o)):t;var d=this.parseURL(e);if(!d)throw new Error("Error trying to parse base URL.");if(!d.netLoc&&d.path&&"/"!==d.path[0]){var c=l.exec(d.path);d.netLoc=c[1],d.path=c[2]}d.netLoc&&!d.path&&(d.path="/");var f={scheme:d.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(f.netLoc=d.netLoc,"/"!==o.path[0]))if(o.path){var m=d.path,y=m.substring(0,m.lastIndexOf("/")+1)+o.path;f.path=h.normalizePath(y)}else f.path=d.path,o.params||(f.params=d.params,o.query||(f.query=d.query));return null===f.path&&(f.path=n.alwaysNormalize?h.normalizePath(o.path):o.path),h.buildURLFromParts(f)},parseURL:function(e){var t=d.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(path){for(path=path.split("").reverse().join("").replace(c,"");path.length!==(path=path.replace(f,"")).length;);return path.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},"object"==typeof n&&"object"==typeof t?t.exports=h:"function"==typeof r&&r.amd?r([],(function(){return h})):"object"==typeof n?n.URLToolkit=h:o.URLToolkit=h},{}],64:[function(e,n,r){(function(t){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var d=o(e("global/window")),l=o("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),c=function(e){Object.defineProperties(e.frame,{id:{get:function(){return l.default.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),e.value.key}},value:{get:function(){return l.default.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),e.value.data}},privateData:{get:function(){return l.default.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),e.value.data}}})},f=function(e){return isNaN(e)||Math.abs(e)===1/0?Number.MAX_VALUE:e},h=function(e,t,n){var r,o=d.default.WebKitDataCue||d.default.VTTCue;t&&t.forEach((function(caption){var track=caption.stream;this.inbandTextTracks_[track].addCue(new o(caption.startTime+this.timestampOffset,caption.endTime+this.timestampOffset,caption.text))}),e),n&&(r=f(e.mediaSource_.duration),n.forEach((function(e){var time=e.cueTime+this.timestampOffset;e.frames.forEach((function(e){var t=new o(time,time,e.value||e.url||e.data||"");t.frame=e,t.value=e,c(t),this.metadataTrack_.addCue(t)}),this)}),e),e.metadataTrack_&&e.metadataTrack_.cues&&e.metadataTrack_.cues.length&&function(){for(var t=e.metadataTrack_.cues,n=[],i=0;i<t.length;i++)t[i]&&n.push(t[i]);var o=n.reduce((function(e,t){var n=e[t.startTime]||[];return n.push(t),e[t.startTime]=n,e}),{}),d=Object.keys(o).sort((function(a,b){return Number(a)-Number(b)}));d.forEach((function(e,t){var n=o[e],l=Number(d[t+1])||r;n.forEach((function(e){e.endTime=l}))}))}())};r.default={addTextTrackData:h,durationOfVideo:f},n.exports=r.default}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"global/window":32}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){return/mp4a\.\d+.\d+/i.test(e)},o=function(e){return/avc1\.[\da-f]+/i.test(e)},d=function(e){var object={type:"",parameters:{}},t=e.trim().split(";");return object.type=t.shift().trim(),t.forEach((function(e){var t=e.trim().split("=");if(t.length>1){var n=t[0].replace(/"/g,"").trim(),r=t[1].replace(/"/g,"").trim();object.parameters[n]=r}})),object},l=function(e){return e.map((function(e){return e.replace(/avc1\.(\d+)\.(\d+)/i,(function(e,t,n){return"avc1."+("00"+Number(t).toString(16)).slice(-2)+"00"+("00"+Number(n).toString(16)).slice(-2)}))}))};n.default={isAudioCodec:r,parseContentType:d,isVideoCodec:o,translateLegacyCodecs:l},t.exports=n.default},{}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){var r=t.player_;if(n.captions&&n.captions.length)for(var o in e.inbandTextTracks_||(e.inbandTextTracks_={}),n.captionStreams)if(!e.inbandTextTracks_[o]){r.tech_.trigger({type:"usage",name:"hls-608"});var track=r.textTracks().getTrackById(o);e.inbandTextTracks_[o]=track||r.addRemoteTextTrack({kind:"captions",id:o,label:o},!1).track}n.metadata&&n.metadata.length&&!e.metadataTrack_&&(e.metadataTrack_=r.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,e.metadataTrack_.inBandMetadataTrackDispatchType=n.metadata.dispatchType)};n.default=r,t.exports=n.default},{}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={TIME_BETWEEN_CHUNKS:1,BYTES_PER_CHUNK:32768};n.default=r,t.exports=n.default},{}],68:[function(e,n,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=function(e,t,n){for(var r=!0;r;){var object=e,o=t,d=n;r=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,o);if(void 0!==desc){if("value"in desc)return desc.value;var l=desc.get;if(void 0===l)return;return l.call(d)}var c=Object.getPrototypeOf(object);if(null===c)return;e=c,t=o,n=d,r=!0,desc=c=void 0}};function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=l(e("global/document")),m=l("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),y=l(e("./flash-source-buffer")),v=l(e("./flash-constants")),_=e("./codec-utils"),T=function(e){function t(){var e=this;c(this,t),d(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.sourceBuffers=[],this.readyState="closed",this.on(["sourceopen","webkitsourceopen"],(function(t){e.swfObj=h.default.getElementById(t.swfId),e.player_=(0,m.default)(e.swfObj.parentNode),e.tech_=e.swfObj.tech,e.readyState="open",e.tech_.on("seeking",(function(){for(var i=e.sourceBuffers.length;i--;)e.sourceBuffers[i].abort()})),e.swfObj&&e.swfObj.vjs_load()}))}return f(t,e),o(t,[{key:"addSeekableRange_",value:function(){}},{key:"addSourceBuffer",value:function(e){var t=(0,_.parseContentType)(e),n=void 0;if("video/mp2t"!==t.type&&"audio/mp2t"!==t.type)throw new Error("NotSupportedError (Video.js)");return n=new y.default(this),this.sourceBuffers.push(n),n}},{key:"endOfStream",value:function(e){"network"===e?this.tech_.error(2):"decode"===e&&this.tech_.error(3),"ended"!==this.readyState&&(this.readyState="ended",this.swfObj.vjs_endOfStream())}}]),t}(m.default.EventTarget);r.default=T;try{Object.defineProperty(T.prototype,"duration",{get:function(){return this.swfObj?this.swfObj.vjs_getProperty("duration"):NaN},set:function(e){var i=void 0,t=this.swfObj.vjs_getProperty("duration");if(this.swfObj.vjs_setProperty("duration",e),e<t)for(i=0;i<this.sourceBuffers.length;i++)this.sourceBuffers[i].remove(e,t);return e}})}catch(e){T.prototype.duration=NaN}for(var S in v.default)T[S]=v.default[S];n.exports=r.default}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./codec-utils":65,"./flash-constants":67,"./flash-source-buffer":69,"global/document":31}],69:[function(e,n,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=function(e,t,n){for(var r=!0;r;){var object=e,o=t,d=n;r=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,o);if(void 0!==desc){if("value"in desc)return desc.value;var l=desc.get;if(void 0===l)return;return l.call(d)}var c=Object.getPrototypeOf(object);if(null===c)return;e=c,t=o,n=d,r=!0,desc=c=void 0}};function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=l(e("global/window")),m=l("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),y=l(e("mux.js/lib/flv")),v=l(e("./remove-cues-from-track")),_=l(e("./create-text-tracks-if-necessary")),T=e("./add-text-track-data"),S=l(e("./flash-transmuxer-worker")),w=l(e("webwackify")),k=l(e("./flash-constants")),O=function(){var t=void 0;try{t=e.resolve("./flash-transmuxer-worker")}catch(e){}return t},E=function(e){h.default.setTimeout(e,k.default.TIME_BETWEEN_CHUNKS)},A=function(){return Math.random().toString(36).slice(2,8)},L=function(e,t){("number"!=typeof t||t<0)&&(t=0);var n=Math.pow(10,t);return Math.round(e*n)/n},P=function(e){function t(e){var n=this;c(this,t),d(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var r=void 0;this.chunkSize_=k.default.BYTES_PER_CHUNK,this.buffer_=[],this.bufferSize_=0,this.basePtsOffset_=NaN,this.mediaSource_=e,this.audioBufferEnd_=NaN,this.videoBufferEnd_=NaN,this.updating=!1,this.timestampOffset_=0,r=h.default.btoa(String.fromCharCode.apply(null,Array.prototype.slice.call(y.default.getFlvHeader())));var o=this.mediaSource_.player_.id().replace(/[^a-zA-Z0-9]/g,"_");this.flashEncodedHeaderName_="vjs_flashEncodedHeader_"+o+A(),this.flashEncodedDataName_="vjs_flashEncodedData_"+o+A(),h.default[this.flashEncodedHeaderName_]=function(){return delete h.default[n.flashEncodedHeaderName_],r},this.mediaSource_.swfObj.vjs_appendChunkReady(this.flashEncodedHeaderName_),this.transmuxer_=(0,w.default)(S.default,O()),this.transmuxer_.postMessage({action:"init",options:{}}),this.transmuxer_.onmessage=function(e){"data"===e.data.action&&n.receiveBuffer_(e.data.segment)},this.one("updateend",(function(){n.mediaSource_.tech_.trigger("loadedmetadata")})),Object.defineProperty(this,"timestampOffset",{get:function(){return this.timestampOffset_},set:function(e){"number"==typeof e&&e>=0&&(this.timestampOffset_=e,this.mediaSource_.swfObj.vjs_discontinuity(),this.basePtsOffset_=NaN,this.audioBufferEnd_=NaN,this.videoBufferEnd_=NaN,this.transmuxer_.postMessage({action:"reset"}))}}),Object.defineProperty(this,"buffered",{get:function(){if(!this.mediaSource_||!this.mediaSource_.swfObj||!("vjs_getProperty"in this.mediaSource_.swfObj))return m.default.createTimeRange();var e=this.mediaSource_.swfObj.vjs_getProperty("buffered");return e&&e.length&&(e[0][0]=L(e[0][0],3),e[0][1]=L(e[0][1],3)),m.default.createTimeRanges(e)}}),this.mediaSource_.player_.on("seeked",(function(){if((0,v.default)(0,1/0,n.metadataTrack_),n.inbandTextTracks_)for(var track in n.inbandTextTracks_)(0,v.default)(0,1/0,n.inbandTextTracks_[track])}));var l=this.onHlsReset_.bind(this);this.mediaSource_.player_.tech_.on("hls-reset",l),this.mediaSource_.player_.tech_.hls.on("dispose",(function(){n.transmuxer_.terminate(),n.mediaSource_.player_.tech_.off("hls-reset",l)}))}return f(t,e),o(t,[{key:"appendBuffer",value:function(e){var t=void 0;if(this.updating)throw(t=new Error("SourceBuffer.append() cannot be called while an update is in progress")).name="InvalidStateError",t.code=11,t;this.updating=!0,this.mediaSource_.readyState="open",this.trigger({type:"update"}),this.transmuxer_.postMessage({action:"push",data:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength},[e.buffer]),this.transmuxer_.postMessage({action:"flush"})}},{key:"abort",value:function(){this.buffer_=[],this.bufferSize_=0,this.mediaSource_.swfObj.vjs_abort(),this.updating&&(this.updating=!1,this.trigger({type:"updateend"}))}},{key:"remove",value:function(e,t){if((0,v.default)(e,t,this.metadataTrack_),this.inbandTextTracks_)for(var track in this.inbandTextTracks_)(0,v.default)(e,t,this.inbandTextTracks_[track]);this.trigger({type:"update"}),this.trigger({type:"updateend"})}},{key:"receiveBuffer_",value:function(e){var t=this;(0,_.default)(this,this.mediaSource_,e),(0,T.addTextTrackData)(this,e.captions,e.metadata),E((function(){var n=t.convertTagsToData_(e);0===t.buffer_.length&&E(t.processBuffer_.bind(t)),n&&(t.buffer_.push(n),t.bufferSize_+=n.byteLength)}))}},{key:"processBuffer_",value:function(){var e=this,t=k.default.BYTES_PER_CHUNK;if(this.buffer_.length){var n=this.buffer_[0].subarray(0,t);n.byteLength<t||this.buffer_[0].byteLength===t?this.buffer_.shift():this.buffer_[0]=this.buffer_[0].subarray(t),this.bufferSize_-=n.byteLength;for(var r=[],o=n.byteLength,i=0;i<o;i++)r.push(String.fromCharCode(n[i]));var d=h.default.btoa(r.join(""));h.default[this.flashEncodedDataName_]=function(){return E(e.processBuffer_.bind(e)),delete h.default[e.flashEncodedDataName_],d},this.mediaSource_.swfObj.vjs_appendChunkReady(this.flashEncodedDataName_)}else!1!==this.updating&&(this.updating=!1,this.trigger({type:"updateend"}))}},{key:"convertTagsToData_",value:function(e){var t=0,n=this.mediaSource_.tech_,r=0,o=void 0,d=e.tags.videoTags,l=e.tags.audioTags;if(isNaN(this.basePtsOffset_)&&(d.length||l.length)){var c=d[0]||{pts:1/0},f=l[0]||{pts:1/0};this.basePtsOffset_=Math.min(f.pts,c.pts)}n.seeking()&&(this.videoBufferEnd_=NaN,this.audioBufferEnd_=NaN),isNaN(this.videoBufferEnd_)?(n.buffered().length&&(r=n.buffered().end(0)-this.timestampOffset),n.seeking()&&(r=Math.max(r,n.currentTime()-this.timestampOffset)),r*=1e3,r+=this.basePtsOffset_):r=this.videoBufferEnd_+.1;var h=d.length;if(h&&d[h-1].pts>=r){for(;--h;){var m=d[h];if(!(m.pts>r)&&(m.keyFrame||m.metaDataTag))break}for(;h&&d[h-1].metaDataTag;)h--}var y=d.slice(h),v=void 0;for(v=isNaN(this.audioBufferEnd_)?r:this.audioBufferEnd_+.1,y.length&&(v=Math.min(v,y[0].pts)),h=0;h<l.length&&!(l[h].pts>=v);)h++;var _=l.slice(h);_.length&&(this.audioBufferEnd_=_[_.length-1].pts),y.length&&(this.videoBufferEnd_=y[y.length-1].pts);var T=this.getOrderedTags_(y,_);if(0!==T.length){if(T[0].pts<r&&n.seeking()){var S=1/30,w=n.currentTime()-(r-T[0].pts)/1e3;w<S&&(w=0);try{this.mediaSource_.swfObj.vjs_adjustCurrentTime(w)}catch(e){}}for(var i=0;i<T.length;i++)t+=T[i].bytes.byteLength;o=new Uint8Array(t),i=0;for(var k=0;i<T.length;i++)o.set(T[i].bytes,k),k+=T[i].bytes.byteLength;return o}}},{key:"getOrderedTags_",value:function(e,t){for(var n=void 0,r=[];e.length||t.length;)n=e.length?t.length&&t[0].dts<e[0].dts?t.shift():e.shift():t.shift(),r.push(n);return r}},{key:"onHlsReset_",value:function(){this.transmuxer_.postMessage({action:"resetCaptions"})}}]),t}(m.default.EventTarget);r.default=P,n.exports=r.default}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./add-text-track-data":64,"./create-text-tracks-if-necessary":66,"./flash-constants":67,"./flash-transmuxer-worker":70,"./remove-cues-from-track":72,"global/window":32,"mux.js/lib/flv":46,webwackify:76}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=o(e("global/window")),c=o(e("mux.js/lib/flv")),f=function(e){e.on("data",(function(e){l.default.postMessage({action:"data",segment:e})})),e.on("done",(function(data){l.default.postMessage({action:"done"})}))},h=function(){function e(t){d(this,e),this.options=t||{},this.init()}return r(e,[{key:"init",value:function(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new c.default.Transmuxer(this.options),f(this.transmuxer)}},{key:"push",value:function(data){var e=new Uint8Array(data.data,data.byteOffset,data.byteLength);this.transmuxer.push(e)}},{key:"reset",value:function(){this.init()}},{key:"flush",value:function(){this.transmuxer.flush()}},{key:"resetCaptions",value:function(){this.transmuxer.resetCaptions()}}]),e}(),m=function(e){e.onmessage=function(e){"init"===e.data.action&&e.data.options?this.messageHandlers=new h(e.data.options):(this.messageHandlers||(this.messageHandlers=new h),e.data&&e.data.action&&"init"!==e.data.action&&this.messageHandlers[e.data.action]&&this.messageHandlers[e.data.action](e.data))}};n.default=function(e){return new m(e)},t.exports=n.default},{"global/window":32,"mux.js/lib/flv":46}],71:[function(e,n,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=function(e,t,n){for(var r=!0;r;){var object=e,o=t,d=n;r=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,o);if(void 0!==desc){if("value"in desc)return desc.value;var l=desc.get;if(void 0===l)return;return l.call(d)}var c=Object.getPrototypeOf(object);if(null===c)return;e=c,t=o,n=d,r=!0,desc=c=void 0}};function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=l(e("global/window")),m=l(e("global/document")),y=l("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),v=l(e("./virtual-source-buffer")),_=e("./add-text-track-data"),T=e("./codec-utils"),S=function(e){function t(){var e=this;c(this,t),d(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var n=void 0;for(n in this.nativeMediaSource_=new h.default.MediaSource,this.nativeMediaSource_)n in t.prototype||"function"!=typeof this.nativeMediaSource_[n]||(this[n]=this.nativeMediaSource_[n].bind(this.nativeMediaSource_));this.duration_=NaN,Object.defineProperty(this,"duration",{get:function(){return this.duration_===1/0?this.duration_:this.nativeMediaSource_.duration},set:function(e){this.duration_=e,e===1/0||(this.nativeMediaSource_.duration=e)}}),Object.defineProperty(this,"seekable",{get:function(){return this.duration_===1/0?y.default.createTimeRanges([[0,this.nativeMediaSource_.duration]]):this.nativeMediaSource_.seekable}}),Object.defineProperty(this,"readyState",{get:function(){return this.nativeMediaSource_.readyState}}),Object.defineProperty(this,"activeSourceBuffers",{get:function(){return this.activeSourceBuffers_}}),this.sourceBuffers=[],this.activeSourceBuffers_=[],this.updateActiveSourceBuffers_=function(){if(e.activeSourceBuffers_.length=0,1===e.sourceBuffers.length){var t=e.sourceBuffers[0];return t.appendAudioInitSegment_=!0,t.audioDisabled_=!t.audioCodec_,void e.activeSourceBuffers_.push(t)}for(var n=!1,r=!0,i=0;i<e.player_.audioTracks().length;i++){var track=e.player_.audioTracks()[i];if(track.enabled&&"main"!==track.kind){n=!0,r=!1;break}}e.sourceBuffers.forEach((function(t){if(t.appendAudioInitSegment_=!0,t.videoCodec_&&t.audioCodec_)t.audioDisabled_=n;else if(t.videoCodec_&&!t.audioCodec_)t.audioDisabled_=!0,r=!1;else if(!t.videoCodec_&&t.audioCodec_&&(t.audioDisabled_=r,r))return;e.activeSourceBuffers_.push(t)}))},this.onPlayerMediachange_=function(){e.sourceBuffers.forEach((function(e){e.appendAudioInitSegment_=!0}))},this.onHlsReset_=function(){e.sourceBuffers.forEach((function(e){e.transmuxer_&&e.transmuxer_.postMessage({action:"resetCaptions"})}))},this.onHlsSegmentTimeMapping_=function(t){e.sourceBuffers.forEach((function(e){return e.timeMapping_=t.mapping}))},["sourceopen","sourceclose","sourceended"].forEach((function(e){this.nativeMediaSource_.addEventListener(e,this.trigger.bind(this))}),this),this.on("sourceopen",(function(t){var video=m.default.querySelector('[src="'+e.url_+'"]');video&&(e.player_=(0,y.default)(video.parentNode),e.player_.tech_.on("hls-reset",e.onHlsReset_),e.player_.tech_.on("hls-segment-time-mapping",e.onHlsSegmentTimeMapping_),e.player_.audioTracks&&e.player_.audioTracks()&&(e.player_.audioTracks().on("change",e.updateActiveSourceBuffers_),e.player_.audioTracks().on("addtrack",e.updateActiveSourceBuffers_),e.player_.audioTracks().on("removetrack",e.updateActiveSourceBuffers_)),e.player_.on("mediachange",e.onPlayerMediachange_))})),this.on("sourceended",(function(t){for(var n=(0,_.durationOfVideo)(e.duration),i=0;i<e.sourceBuffers.length;i++){var r=e.sourceBuffers[i],o=r.metadataTrack_&&r.metadataTrack_.cues;o&&o.length&&(o[o.length-1].endTime=n)}})),this.on("sourceclose",(function(e){this.sourceBuffers.forEach((function(e){e.transmuxer_&&e.transmuxer_.terminate()})),this.sourceBuffers.length=0,this.player_&&(this.player_.audioTracks&&this.player_.audioTracks()&&(this.player_.audioTracks().off("change",this.updateActiveSourceBuffers_),this.player_.audioTracks().off("addtrack",this.updateActiveSourceBuffers_),this.player_.audioTracks().off("removetrack",this.updateActiveSourceBuffers_)),this.player_.el_&&(this.player_.off("mediachange",this.onPlayerMediachange_),this.player_.tech_.off("hls-reset",this.onHlsReset_),this.player_.tech_.off("hls-segment-time-mapping",this.onHlsSegmentTimeMapping_)))}))}return f(t,e),o(t,[{key:"addSeekableRange_",value:function(e,t){var n=void 0;if(this.duration!==1/0)throw(n=new Error("MediaSource.addSeekableRange() can only be invoked when the duration is Infinity")).name="InvalidStateError",n.code=11,n;(t>this.nativeMediaSource_.duration||isNaN(this.nativeMediaSource_.duration))&&(this.nativeMediaSource_.duration=t)}},{key:"addSourceBuffer",value:function(e){var t=void 0,n=(0,T.parseContentType)(e);if(/^(video|audio)\/mp2t$/i.test(n.type)){var r=[];n.parameters&&n.parameters.codecs&&(r=n.parameters.codecs.split(","),r=(r=(0,T.translateLegacyCodecs)(r)).filter((function(e){return(0,T.isAudioCodec)(e)||(0,T.isVideoCodec)(e)}))),0===r.length&&(r=["avc1.4d400d","mp4a.40.2"]),t=new v.default(this,r),0!==this.sourceBuffers.length&&(this.sourceBuffers[0].createRealSourceBuffers_(),t.createRealSourceBuffers_(),this.sourceBuffers[0].audioDisabled_=!0)}else t=this.nativeMediaSource_.addSourceBuffer(e);return this.sourceBuffers.push(t),t}}]),t}(y.default.EventTarget);r.default=S,n.exports=r.default}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./add-text-track-data":64,"./codec-utils":65,"./virtual-source-buffer":75,"global/document":31,"global/window":32}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,track){var i=void 0,n=void 0;if(track&&track.cues)for(i=track.cues.length;i--;)(n=track.cues[i]).startTime<=t&&n.endTime>=e&&track.removeCue(n)};n.default=r,t.exports=n.default},{}],73:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=o(e("global/window")),c=o(e("mux.js/lib/mp4")),f=function(e){e.on("data",(function(e){var t=e.initSegment;e.initSegment={data:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength};var n=e.data;e.data=n.buffer,l.default.postMessage({action:"data",segment:e,byteOffset:n.byteOffset,byteLength:n.byteLength},[e.data])})),e.captionStream&&e.captionStream.on("data",(function(caption){l.default.postMessage({action:"caption",data:caption})})),e.on("done",(function(data){l.default.postMessage({action:"done"})})),e.on("gopInfo",(function(e){l.default.postMessage({action:"gopInfo",gopInfo:e})}))},h=function(){function e(t){d(this,e),this.options=t||{},this.init()}return r(e,[{key:"init",value:function(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new c.default.Transmuxer(this.options),f(this.transmuxer)}},{key:"push",value:function(data){var e=new Uint8Array(data.data,data.byteOffset,data.byteLength);this.transmuxer.push(e)}},{key:"reset",value:function(){this.init()}},{key:"setTimestampOffset",value:function(data){var e=data.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(9e4*e))}},{key:"setAudioAppendStart",value:function(data){this.transmuxer.setAudioAppendStart(Math.ceil(9e4*data.appendStart))}},{key:"flush",value:function(data){this.transmuxer.flush()}},{key:"resetCaptions",value:function(){this.transmuxer.resetCaptions()}},{key:"alignGopsWith",value:function(data){this.transmuxer.alignGopsWith(data.gopsToAlignWith.slice())}}]),e}(),m=function(e){e.onmessage=function(e){"init"===e.data.action&&e.data.options?this.messageHandlers=new h(e.data.options):(this.messageHandlers||(this.messageHandlers=new h),e.data&&e.data.action&&"init"!==e.data.action&&this.messageHandlers[e.data.action]&&this.messageHandlers[e.data.action](e.data))}};n.default=function(e){return new m(e)},t.exports=n.default},{"global/window":32,"mux.js/lib/mp4":55}],74:[function(e,n,r){(function(t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var o=n(e("global/window")),d=n(e("./flash-media-source")),l=n(e("./html-media-source")),c=n("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),f=0,h={mode:"auto"};c.default.mediaSources={};var m=function(e,t){var n=c.default.mediaSources[e];if(!n)throw new Error("Media Source not found (Video.js)");n.trigger({type:"sourceopen",swfId:t})},y=function(){return!!o.default.MediaSource&&!!o.default.MediaSource.isTypeSupported&&o.default.MediaSource.isTypeSupported('video/mp4;codecs="avc1.4d400d,mp4a.40.2"')},v=function(e){var t=c.default.mergeOptions(h,e);if(this.MediaSource={open:m,supportsNativeMediaSources:y},"html5"===t.mode||"auto"===t.mode&&y())return new l.default;if(c.default.getTech("Flash"))return new d.default;throw new Error("Cannot use Flash or Html5 to create a MediaSource for this video")};r.MediaSource=v,v.open=m,v.supportsNativeMediaSources=y;var _={createObjectURL:function(object){var e="blob:vjs-media-source/",t=void 0;return object instanceof l.default?(t=o.default.URL.createObjectURL(object.nativeMediaSource_),object.url_=t,t):object instanceof d.default?(t=e+f,f++,c.default.mediaSources[t]=object,t):(t=o.default.URL.createObjectURL(object),object.url_=t,t)}};r.URL=_,c.default.MediaSource=v,c.default.URL=_}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./flash-media-source":68,"./html-media-source":71,"global/window":32}],75:[function(e,n,r){(function(t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t,n){for(var r=!0;r;){var object=e,o=t,d=n;r=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,o);if(void 0!==desc){if("value"in desc)return desc.value;var l=desc.get;if(void 0===l)return;return l.call(d)}var c=Object.getPrototypeOf(object);if(null===c)return;e=c,t=o,n=d,r=!0,desc=c=void 0}};function d(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=d("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),h=d(e("./create-text-tracks-if-necessary")),m=d(e("./remove-cues-from-track")),y=e("./add-text-track-data"),v=d(e("webwackify")),_=d(e("./transmuxer-worker")),T=e("./codec-utils"),S=function(){var t=void 0;try{t=e.resolve("./transmuxer-worker")}catch(e){}return t},w=function(e,t){var n=e.addSourceBuffer(t),r=Object.create(null);r.updating=!1,r.realBuffer_=n;var o=function(e){"function"==typeof n[e]?r[e]=function(){return n[e].apply(n,arguments)}:void 0===r[e]&&Object.defineProperty(r,e,{get:function(){return n[e]},set:function(t){return n[e]=t}})};for(var d in n)o(d);return r},k=function(e,t,n){if(!t||!e.length)return[];var r=Math.ceil(9e4*(t.currentTime()-n+3)),i=void 0;for(i=0;i<e.length&&!(e[i].pts>r);i++);return e.slice(i)};r.gopsSafeToAlignWith=k;var O=function(e,t,n){if(!t.length)return e;if(n)return t.slice();for(var r=t[0].pts,i=0;i<e.length&&!(e[i].pts>=r);i++);return e.slice(0,i).concat(t)};r.updateGopBuffer=O;var E=function(e,t,n,r){for(var o=Math.ceil(9e4*(t-r)),d=Math.ceil(9e4*(n-r)),l=e.slice(),i=e.length;i--&&!(e[i].pts<=d););if(-1===i)return l;for(var c=i+1;c--&&!(e[c].pts<=o););return c=Math.max(c,0),l.splice(c,i-c+1),l};r.removeGopBuffer=E;var A=function(e){function t(e,n){var r=this;l(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,f.default.EventTarget),this.timestampOffset_=0,this.pendingBuffers_=[],this.bufferUpdating_=!1,this.mediaSource_=e,this.codecs_=n,this.audioCodec_=null,this.videoCodec_=null,this.audioDisabled_=!1,this.appendAudioInitSegment_=!0,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=f.default.browser.IE_VERSION>=11;var d={remux:!1,alignGopsAtEnd:this.safeAppend_};this.codecs_.forEach((function(e){(0,T.isAudioCodec)(e)?r.audioCodec_=e:(0,T.isVideoCodec)(e)&&(r.videoCodec_=e)})),this.transmuxer_=(0,v.default)(_.default,S()),this.transmuxer_.postMessage({action:"init",options:d}),this.transmuxer_.onmessage=function(e){return"data"===e.data.action?r.data_(e):"done"===e.data.action?r.done_(e):"gopInfo"===e.data.action?r.appendGopInfo_(e):void 0},Object.defineProperty(this,"timestampOffset",{get:function(){return this.timestampOffset_},set:function(e){"number"==typeof e&&e>=0&&(this.timestampOffset_=e,this.appendAudioInitSegment_=!0,this.gopBuffer_.length=0,this.timeMapping_=0,this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e}))}}),Object.defineProperty(this,"appendWindowStart",{get:function(){return(this.videoBuffer_||this.audioBuffer_).appendWindowStart},set:function(e){this.videoBuffer_&&(this.videoBuffer_.appendWindowStart=e),this.audioBuffer_&&(this.audioBuffer_.appendWindowStart=e)}}),Object.defineProperty(this,"updating",{get:function(){return!!(this.bufferUpdating_||!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.updating||this.videoBuffer_&&this.videoBuffer_.updating)}}),Object.defineProperty(this,"buffered",{get:function(){var e=null,t=null,n=0,r=[],o=[];if(!this.videoBuffer_&&!this.audioBuffer_)return f.default.createTimeRange();if(!this.videoBuffer_)return this.audioBuffer_.buffered;if(!this.audioBuffer_)return this.videoBuffer_.buffered;if(this.audioDisabled_)return this.videoBuffer_.buffered;if(0===this.videoBuffer_.buffered.length&&0===this.audioBuffer_.buffered.length)return f.default.createTimeRange();for(var d=this.videoBuffer_.buffered,l=this.audioBuffer_.buffered,c=d.length;c--;)r.push({time:d.start(c),type:"start"}),r.push({time:d.end(c),type:"end"});for(c=l.length;c--;)r.push({time:l.start(c),type:"start"}),r.push({time:l.end(c),type:"end"});for(r.sort((function(a,b){return a.time-b.time})),c=0;c<r.length;c++)"start"===r[c].type?2==++n&&(e=r[c].time):"end"===r[c].type&&1==--n&&(t=r[c].time),null!==e&&null!==t&&(o.push([e,t]),e=null,t=null);return f.default.createTimeRanges(o)}})}return c(t,e),n(t,[{key:"data_",value:function(e){var t=e.data.segment;t.data=new Uint8Array(t.data,e.data.byteOffset,e.data.byteLength),t.initSegment=new Uint8Array(t.initSegment.data,t.initSegment.byteOffset,t.initSegment.byteLength),(0,h.default)(this,this.mediaSource_,t),this.pendingBuffers_.push(t)}},{key:"done_",value:function(e){"closed"!==this.mediaSource_.readyState?this.processPendingSegments_():this.pendingBuffers_.length=0}},{key:"createRealSourceBuffers_",value:function(){var e=this,t=["audio","video"];t.forEach((function(n){if(e[n+"Codec_"]&&!e[n+"Buffer_"]){var r=null;if(e.mediaSource_[n+"Buffer_"])(r=e.mediaSource_[n+"Buffer_"]).updating=!1;else{var o=n+'/mp4;codecs="'+e[n+"Codec_"]+'"';r=w(e.mediaSource_.nativeMediaSource_,o),e.mediaSource_[n+"Buffer_"]=r}e[n+"Buffer_"]=r,["update","updatestart","updateend"].forEach((function(o){r.addEventListener(o,(function(){if("audio"!==n||!e.audioDisabled_)return"updateend"===o&&(e[n+"Buffer_"].updating=!1),t.every((function(t){return!("audio"!==t||!e.audioDisabled_)||n===t||!e[t+"Buffer_"]||!e[t+"Buffer_"].updating}))?e.trigger(o):void 0}))}))}}))}},{key:"appendBuffer",value:function(e){if(this.bufferUpdating_=!0,this.audioBuffer_&&this.audioBuffer_.buffered.length){var t=this.audioBuffer_.buffered;this.transmuxer_.postMessage({action:"setAudioAppendStart",appendStart:t.end(t.length-1)})}this.videoBuffer_&&this.transmuxer_.postMessage({action:"alignGopsWith",gopsToAlignWith:k(this.gopBuffer_,this.mediaSource_.player_,this.timeMapping_)}),this.transmuxer_.postMessage({action:"push",data:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength},[e.buffer]),this.transmuxer_.postMessage({action:"flush"})}},{key:"appendGopInfo_",value:function(e){this.gopBuffer_=O(this.gopBuffer_,e.data.gopInfo,this.safeAppend_)}},{key:"remove",value:function(e,t){if(this.videoBuffer_&&(this.videoBuffer_.updating=!0,this.videoBuffer_.remove(e,t),this.gopBuffer_=E(this.gopBuffer_,e,t,this.timeMapping_)),!this.audioDisabled_&&this.audioBuffer_&&(this.audioBuffer_.updating=!0,this.audioBuffer_.remove(e,t)),(0,m.default)(e,t,this.metadataTrack_),this.inbandTextTracks_)for(var track in this.inbandTextTracks_)(0,m.default)(e,t,this.inbandTextTracks_[track])}},{key:"processPendingSegments_",value:function(){var e={video:{segments:[],bytes:0},audio:{segments:[],bytes:0},captions:[],metadata:[]};e=this.pendingBuffers_.reduce((function(e,t){var n=t.type,data=t.data,r=t.initSegment;return e[n].segments.push(data),e[n].bytes+=data.byteLength,e[n].initSegment=r,t.captions&&(e.captions=e.captions.concat(t.captions)),t.info&&(e[n].info=t.info),t.metadata&&(e.metadata=e.metadata.concat(t.metadata)),e}),e),this.videoBuffer_||this.audioBuffer_||(0===e.video.bytes&&(this.videoCodec_=null),0===e.audio.bytes&&(this.audioCodec_=null),this.createRealSourceBuffers_()),e.audio.info&&this.mediaSource_.trigger({type:"audioinfo",info:e.audio.info}),e.video.info&&this.mediaSource_.trigger({type:"videoinfo",info:e.video.info}),this.appendAudioInitSegment_&&(!this.audioDisabled_&&this.audioBuffer_&&(e.audio.segments.unshift(e.audio.initSegment),e.audio.bytes+=e.audio.initSegment.byteLength),this.appendAudioInitSegment_=!1);var t=!1;this.videoBuffer_&&e.video.bytes?(e.video.segments.unshift(e.video.initSegment),e.video.bytes+=e.video.initSegment.byteLength,this.concatAndAppendSegments_(e.video,this.videoBuffer_),(0,y.addTextTrackData)(this,e.captions,e.metadata)):!this.videoBuffer_||!this.audioDisabled_&&this.audioBuffer_||(t=!0),!this.audioDisabled_&&this.audioBuffer_&&this.concatAndAppendSegments_(e.audio,this.audioBuffer_),this.pendingBuffers_.length=0,t&&this.trigger("updateend"),this.bufferUpdating_=!1}},{key:"concatAndAppendSegments_",value:function(e,t){var n=0,r=void 0;if(e.bytes){r=new Uint8Array(e.bytes),e.segments.forEach((function(e){r.set(e,n),n+=e.byteLength}));try{t.updating=!0,t.appendBuffer(r)}catch(e){this.mediaSource_.player_&&this.mediaSource_.player_.error({code:-3,type:"APPEND_BUFFER_ERR",message:e.message,originalError:e})}}}},{key:"abort",value:function(){this.videoBuffer_&&this.videoBuffer_.abort(),!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"reset"}),this.pendingBuffers_.length=0,this.bufferUpdating_=!1}}]),t}(f.default.EventTarget);r.default=A}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./add-text-track-data":64,"./codec-utils":65,"./create-text-tracks-if-necessary":66,"./remove-cues-from-track":72,"./transmuxer-worker":73,webwackify:76}],76:[function(e,t,r){var o=arguments[3],d=arguments[4],l=arguments[5],c=JSON.stringify,f=!1;void 0===o&&(f=!0,o=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(object,e){return Object.prototype.hasOwnProperty.call(object,e)},n.p="",n(n.s=entryModule)},d=n.m);var h=function(e){for(var t,n=Object.keys(l),i=0;i<n.length;i++){var r=n[i],f=l[r].exports;if(f===e||f&&f.default===e){t=r;break}}if(!t){t=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var h={};for(i=0;i<n.length;i++)h[r=n[i]]=r;d[t]=["function(require,module,exports){"+e+"(self); }",h]}var m=Math.floor(Math.pow(16,8)*Math.random()).toString(16),y={};return y[t]=t,d[m]=["function(require,module,exports){var f = require("+c(t)+");(f.default ? f.default : f)(self);}",y],"("+o+")({"+Object.keys(d).map((function(e){return c(e)+":["+d[e][0]+","+c(d[e][1])+"]"})).join(",")+"},{},["+c(m)+"])"},m=function(e,t){var r,l="string"==typeof t;r=l?{}:[],Object.keys(d).forEach((function(e){d[e]&&(r[e]=d[e].toString())}));var f,h=n(t);if(!h||h!==e&&h.default!==e){var m=r[t];r[t]=m.substring(0,m.length-1)+"\n"+e.name+"();\n}"}return l?(t=c(t),f="{"+Object.keys(r).map((function(e){return c(e)+":"+r[e]})).join(",")+"}"):f="["+r.join(",")+"]","var fn = ("+o.toString().replace("entryModule",t)+")("+f+');\n(typeof fn === "function") && fn(self);'};t.exports=function(e,t){var n;n=f?m(e,t):h(e);var r=new Blob([n],{type:"text/javascript"}),o=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(r),d=new Worker(o);return d.objectURL=o,d}},{}],77:[function(e,n,r){(function(t){"use strict";var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t,n){for(var r=!0;r;){var object=e,o=t,d=n;r=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,o);if(void 0!==desc){if("value"in desc)return desc.value;var l=desc.get;if(void 0===l)return;return l.call(d)}var c=Object.getPrototypeOf(object);if(null===c)return;e=c,t=o,n=d,r=!0,desc=c=void 0}};function d(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=d(e("global/document")),h=d(e("./playlist-loader")),m=d(e("./playlist")),y=d(e("./xhr")),v=e("aes-decrypter"),_=d(e("./bin-utils")),T=e("videojs-contrib-media-sources"),S=d(e("m3u8-parser")),w=d("undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null),k=e("./master-playlist-controller"),O=d(e("./config")),E=d(e("./rendition-mixin")),A=d(e("global/window")),L=d(e("./playback-watcher")),P=d(e("./reload-source-on-error")),I=e("./playlist-selectors.js"),C={PlaylistLoader:h.default,Playlist:m.default,Decrypter:v.Decrypter,AsyncStream:v.AsyncStream,decrypt:v.decrypt,utils:_.default,STANDARD_PLAYLIST_SELECTOR:I.lastBandwidthSelector,INITIAL_PLAYLIST_SELECTOR:I.lowestBitrateCompatibleVariantSelector,comparePlaylistBandwidth:I.comparePlaylistBandwidth,comparePlaylistResolution:I.comparePlaylistResolution,xhr:(0,y.default)()},U=4194304;["GOAL_BUFFER_LENGTH","MAX_GOAL_BUFFER_LENGTH","GOAL_BUFFER_LENGTH_RATE","BUFFER_LOW_WATER_LINE","MAX_BUFFER_LOW_WATER_LINE","BUFFER_LOW_WATER_LINE_RATE","BANDWIDTH_VARIANCE"].forEach((function(e){Object.defineProperty(C,e,{get:function(){return w.default.log.warn("using Hls."+e+" is UNSAFE be sure you know what you are doing"),O.default[e]},set:function(t){w.default.log.warn("using Hls."+e+" is UNSAFE be sure you know what you are doing"),"number"!=typeof t||t<0?w.default.log.warn("value of Hls."+e+" must be greater than or equal to 0"):O.default[e]=t}})}));var video,M=function(e,t){for(var n=t.media(),r=-1,i=0;i<e.length;i++)if(e[i].id===n.uri){r=i;break}e.selectedIndex_=r,e.trigger({selectedIndex:r,type:"change"})},D=function(e,t){t.representations().forEach((function(t){e.addQualityLevel(t)})),M(e,t.playlists)};C.canPlaySource=function(){return w.default.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")},C.supportsNativeHls=(video=f.default.createElement("video"),!!w.default.getTech("Html5").isSupported()&&["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some((function(e){return/maybe|probably/i.test(video.canPlayType(e))}))),C.isSupported=function(){return w.default.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var x=function(e){function t(source,e,n){var r=this;if(l(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n.hls),e.options_&&e.options_.playerId){var d=(0,w.default)(e.options_.playerId);d.hasOwnProperty("hls")||Object.defineProperty(d,"hls",{get:function(){return w.default.log.warn("player.hls is deprecated. Use player.tech_.hls instead."),e.trigger({type:"usage",name:"hls-player-access"}),r}})}if(this.tech_=e,this.source_=source,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&(e.featuresNativeVideoTracks||e.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");this.on(f.default,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],(function(e){var t=f.default.fullscreenElement||f.default.webkitFullscreenElement||f.default.mozFullScreenElement||f.default.msFullscreenElement;t&&t.contains(r.tech_.el())&&r.masterPlaylistController_.fastQualityChange_()})),this.on(this.tech_,"seeking",(function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())})),this.on(this.tech_,"error",(function(){this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()})),this.on(this.tech_,"play",this.play)}return c(t,e),r(t,[{key:"setOptions_",value:function(){var e=this;this.options_.withCredentials=this.options_.withCredentials||!1,"number"!=typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300),"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=U),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===U,["withCredentials","bandwidth","handleManifestRedirects"].forEach((function(option){void 0!==e.source_[option]&&(e.options_[option]=e.source_[option])})),this.bandwidth=this.options_.bandwidth}},{key:"src",value:function(e){var t=this;e&&(this.setOptions_(),this.options_.url=this.source_.src,this.options_.tech=this.tech_,this.options_.externHls=C,this.masterPlaylistController_=new k.MasterPlaylistController(this.options_),this.playbackWatcher_=new L.default(w.default.mergeOptions(this.options_,{seekable:function(){return t.seekable()}})),this.masterPlaylistController_.on("error",(function(){w.default.players[t.tech_.options_.playerId].error(t.masterPlaylistController_.error)})),this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):C.STANDARD_PLAYLIST_SELECTOR.bind(this),this.masterPlaylistController_.selectInitialPlaylist=C.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(e){this.masterPlaylistController_.selectPlaylist=e.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=e,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=e,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){var e=1/(this.bandwidth||1),t=void 0;return t=this.throughput>0?1/this.throughput:0,Math.floor(1/(e+t))},set:function(){w.default.log.error('The "systemBandwidth" property is read-only')}}}),Object.defineProperties(this.stats,{bandwidth:{get:function(){return t.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return t.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return t.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return t.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return t.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return t.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return t.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return t.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.masterPlaylistController_.on("selectedinitialmedia",(function(){(0,E.default)(t)})),this.on(this.masterPlaylistController_,"progress",(function(){this.tech_.trigger("progress")})),this.on(this.masterPlaylistController_,"firstplay",(function(){this.ignoreNextSeekingEvent_=!0})),this.tech_.ready((function(){return t.setupQualityLevels_()})),this.tech_.el()&&this.tech_.src(w.default.URL.createObjectURL(this.masterPlaylistController_.mediaSource)))}},{key:"setupQualityLevels_",value:function(){var e=this,t=w.default.players[this.tech_.options_.playerId];t&&t.qualityLevels&&(this.qualityLevels_=t.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",(function(){D(e.qualityLevels_,e)})),this.playlists.on("mediachange",(function(){M(e.qualityLevels_,e.playlists)})))}},{key:"play",value:function(){this.masterPlaylistController_.play()}},{key:"setCurrentTime",value:function(e){this.masterPlaylistController_.setCurrentTime(e)}},{key:"duration",value:function(){return this.masterPlaylistController_.duration()}},{key:"seekable",value:function(){return this.masterPlaylistController_.seekable()}},{key:"dispose",value:function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),o(Object.getPrototypeOf(t.prototype),"dispose",this).call(this)}}]),t}(w.default.getComponent("Component")),R=function e(t){return{canHandleSource:function(n){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=w.default.mergeOptions(w.default.options,r);return(!o.hls||!o.hls.mode||o.hls.mode===t)&&e.canPlayType(n.type,o)},handleSource:function(source,e){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=w.default.mergeOptions(w.default.options,n,{hls:{mode:t}});return"flash"===t&&e.setTimeout((function(){e.trigger("loadstart")}),1),e.hls=new x(source,e,r),e.hls.xhr=(0,y.default)(),e.hls.src(source.src),e.hls},canPlayType:function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=w.default.mergeOptions(w.default.options,n);return e.canPlayType(t,r)?"maybe":""}}};R.canPlayType=function(e,t){if(w.default.browser.IE_VERSION&&w.default.browser.IE_VERSION<=10)return!1;var n=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i;return!(!t.hls.overrideNative&&C.supportsNativeHls)&&n.test(e)},void 0!==w.default.MediaSource&&void 0!==w.default.URL||(w.default.MediaSource=T.MediaSource,w.default.URL=T.URL);var B=w.default.getTech("Flash");T.MediaSource.supportsNativeMediaSources()&&w.default.getTech("Html5").registerSourceHandler(R("html5"),0),A.default.Uint8Array&&B&&B.registerSourceHandler(R("flash")),w.default.HlsHandler=x,w.default.HlsSourceHandler=R,w.default.Hls=C,w.default.use||w.default.registerComponent("Hls",C),w.default.m3u8=S.default,w.default.options.hls=w.default.options.hls||{},w.default.registerPlugin?w.default.registerPlugin("reloadSourceOnError",P.default):w.default.plugin("reloadSourceOnError",P.default),n.exports={Hls:C,HlsHandler:x,HlsSourceHandler:R}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./bin-utils":2,"./config":3,"./master-playlist-controller":5,"./playback-watcher":8,"./playlist":11,"./playlist-loader":9,"./playlist-selectors.js":10,"./reload-source-on-error":13,"./rendition-mixin":14,"./xhr":21,"aes-decrypter":25,"global/document":31,"global/window":32,"m3u8-parser":33,"videojs-contrib-media-sources":74}]},{},[77])(77)}).call(this,n(43))}}]);